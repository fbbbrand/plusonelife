<!DOCTYPE html>

<html lang="fr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>+1Life — Activités solidaires, ouvertes à tous</title>
<script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.js"></script>
<script src="supabase.js"></script>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@400;600;700;800;900&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">
<style>
  :root {
    --red: #E53935;
    --red-dark: #C62828;
    --red-glow: rgba(229,57,53,0.15);
    --orange: #349188;
    --orange-dark: #26706A;
    --orange-glow: rgba(52,145,136,0.15);
    --blue-accent: #3DB5D8;
    --bg: #F5F0E8;
    --dark: #F8F4EE;
    --dark2: #FFFFFF;
    --dark3: #FDFCFA;
    --white: #2A1808;
    --grey: #7A6050;
    --grey2: #4A3018;
    --gold: #F5A623;
    --blue: #3DB5D8;
    --font-display: 'Barlow Condensed', sans-serif;
    --font-body: 'DM Sans', sans-serif;
    --radius: 16px;
    --radius-sm: 10px;
    --shadow-sm: 0 1px 4px rgba(0,0,0,0.35), 0 1px 2px rgba(0,0,0,0.25);
    --shadow: 0 4px 20px rgba(0,0,0,0.45), 0 2px 8px rgba(0,0,0,0.3);
    --shadow-lg: 0 16px 48px rgba(0,0,0,0.6);
  }

  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  html { scroll-behavior: smooth; }

  body {
    font-family: var(--font-body);
    background: var(--bg);
    color: var(--white);
    overflow-x: hidden;
    -webkit-font-smoothing: antialiased;
  }

  /* ===================== NOISE OVERLAY ===================== */
  body::before {
    content: '';
    position: fixed;
    inset: 0;
    background-image: url("data:image/svg+xml,%3Csvg viewBox='0 0 256 256' xmlns='http://www.w3.org/2000/svg'%3E%3Cfilter id='noise'%3E%3CfeTurbulence type='fractalNoise' baseFrequency='0.9' numOctaves='4' stitchTiles='stitch'/%3E%3C/filter%3E%3Crect width='100%25' height='100%25' filter='url(%23noise)' opacity='0.04'/%3E%3C/svg%3E");
    pointer-events: none;
    z-index: 9999;
    opacity: 0.12;
  }

  /* ===================== SCROLLBAR ===================== */
  ::-webkit-scrollbar { width: 4px; }
  ::-webkit-scrollbar-track { background: var(--dark); }
  ::-webkit-scrollbar-thumb { background: var(--red); border-radius: 2px; }

  /* ===================== NAV ===================== */
  nav {
    position: fixed;
    top: 0;
    left: 0;
    right: 0;
    z-index: 1000;
    padding: 0 5%;
    height: 72px;
    display: flex;
    align-items: center;
    justify-content: space-between;
    transition: background 0.3s, backdrop-filter 0.3s, border-bottom 0.3s;
  }

  nav.scrolled {
    background: rgba(20, 17, 9, 0.92);
    backdrop-filter: blur(24px);
    -webkit-backdrop-filter: blur(24px);
    border-bottom: 1px solid rgba(255,255,255,0.07);
    box-shadow: 0 1px 0 rgba(255,255,255,0.04);
  }

  nav.scrolled .nav-links a { color: rgba(255,255,255,0.75); }
  nav.scrolled .nav-links a:hover { color: #fff; }
  nav.scrolled .nav-mes-events { color: var(--orange) !important; }
  nav.scrolled .hamburger span { background: #fff; }

  .logo {
    display: flex;
    align-items: center;
    gap: 10px;
    text-decoration: none;
    flex-shrink: 0;
  }

  .logo-img {
    height: 46px;
    width: auto;
    display: block;
    object-fit: contain;
  }

  .nav-links {
    display: flex;
    align-items: center;
    gap: 36px;
    list-style: none;
  }

  .nav-links a {
    font-family: var(--font-body);
    font-size: 14px;
    font-weight: 500;
    color: var(--grey2);
    text-decoration: none;
    transition: color 0.2s;
    letter-spacing: 0.3px;
  }

  .nav-links a:hover { color: var(--white); }
  .nav-mes-events {
    color: var(--orange) !important;
    font-weight: 600 !important;
    display: flex;
    align-items: center;
    gap: 5px;
  }
  .nav-mes-events:hover { opacity: 0.8; }

  .btn {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    padding: 12px 24px;
    border-radius: 50px;
    font-family: var(--font-body);
    font-size: 14px;
    font-weight: 600;
    text-decoration: none;
    cursor: pointer;
    border: none;
    transition: all 0.25s cubic-bezier(0.4,0,0.2,1);
    white-space: nowrap;
  }

  .btn-primary {
    background: var(--orange);
    color: #fff;
    box-shadow: 0 2px 8px rgba(52,145,136,0.25), 0 1px 2px rgba(52,145,136,0.15);
  }

  .btn-primary:hover {
    background: var(--orange-dark);
    transform: translateY(-2px);
    box-shadow: 0 8px 24px rgba(52,145,136,0.35);
  }

  .btn-outline {
    background: rgba(0,0,0,0.04);
    color: var(--white);
    border: 1.5px solid rgba(0,0,0,0.14);
  }

  .btn-outline:hover {
    background: rgba(0,0,0,0.08);
    border-color: rgba(0,0,0,0.22);
    transform: translateY(-2px);
  }

  .btn-large {
    padding: 16px 36px;
    font-size: 16px;
    border-radius: 50px;
  }

  .hamburger {
    display: none;
    flex-direction: column;
    gap: 5px;
    cursor: pointer;
    padding: 4px;
    background: none;
    border: none;
  }

  .hamburger span {
    display: block;
    width: 24px;
    height: 2px;
    background: var(--white);
    border-radius: 2px;
    transition: all 0.3s;
  }

  .mobile-menu {
    display: none;
    position: fixed;
    inset: 0;
    background: #1A1714;
    z-index: 999;
    flex-direction: column;
    align-items: center;
    justify-content: center;
    gap: 32px;
  }

  .mobile-menu.open { display: flex; }

  .mobile-menu a {
    font-family: var(--font-display);
    font-size: 40px;
    font-weight: 800;
    color: #F5F0E8;
    text-decoration: none;
    transition: color 0.2s;
    text-transform: uppercase;
    letter-spacing: 1px;
  }

  .mobile-menu a:hover { color: var(--orange); }

  .close-menu {
    position: absolute;
    top: 24px;
    right: 24px;
    background: none;
    border: none;
    color: #F5F0E8;
    font-size: 28px;
    cursor: pointer;
  }

  /* ===================== HERO ===================== */
  .hero {
    min-height: 100vh;
    display: flex;
    flex-direction: column;
    justify-content: center;
    padding: 120px 5% 80px;
    position: relative;
    overflow: hidden;
  }

  .hero-mosaic {
    position: absolute;
    inset: 0;
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    grid-template-rows: repeat(2, 1fr);
    gap: 3px;
    z-index: 0;
    opacity: 0.62;
    filter: saturate(0.75) brightness(1.0);
  }

  .hero-mosaic-photo {
    background-size: cover;
    background-position: center;
  }

  .hero-bg {
    position: absolute;
    inset: 0;
    z-index: 1;
    background: linear-gradient(
      135deg,
      rgba(245,240,232,0.52) 0%,
      rgba(245,238,225,0.42) 45%,
      rgba(245,233,210,0.35) 70%,
      rgba(245,240,232,0.50) 100%
    );
  }

  .hero-content {
    position: relative;
    z-index: 2;
    max-width: 800px;
  }

  .hero-badge {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    background: rgba(192,104,48, 0.18);
    border: 1px solid rgba(192,104,48, 0.42);
    border-radius: 50px;
    padding: 6px 16px;
    font-size: 13px;
    font-weight: 500;
    color: var(--white);
    margin-bottom: 28px;
  }

  .hero-badge::before {
    content: '';
    width: 6px;
    height: 6px;
    background: var(--orange);
    border-radius: 50%;
    animation: pulse 2s infinite;
  }

  @keyframes pulse {
    0%, 100% { opacity: 1; transform: scale(1); }
    50% { opacity: 0.5; transform: scale(1.4); }
  }

  h1 {
    font-family: var(--font-display);
    font-size: clamp(64px, 10vw, 128px);
    font-weight: 900;
    line-height: 0.95;
    letter-spacing: -1px;
    text-transform: uppercase;
    margin-bottom: 28px;
  }

  h1 .accent { color: var(--orange); }

  .hero-sub {
    font-size: clamp(16px, 2vw, 20px);
    font-weight: 400;
    color: var(--grey2);
    max-width: 520px;
    line-height: 1.6;
    margin-bottom: 44px;
  }

  .hero-ctas {
    display: flex;
    gap: 16px;
    flex-wrap: wrap;
  }

  .hero-visual {
    position: absolute;
    right: 5%;
    top: 50%;
    transform: translateY(-50%);
    width: min(45%, 500px);
    display: flex;
    flex-direction: column;
    gap: 16px;
    opacity: 0.9;
    z-index: 2;
  }

  .event-card-preview {
    background: var(--dark2);
    border: 1px solid rgba(255,255,255,0.09);
    border-radius: var(--radius);
    padding: 20px;
    box-shadow: var(--shadow);
    transform: rotate(-2deg);
    transition: transform 0.3s;
  }

  .event-card-preview:hover { transform: rotate(0deg) scale(1.02); }

  .event-card-preview.card2 {
    transform: rotate(1.5deg) translateX(20px);
    margin-top: -10px;
  }

  .event-card-preview.card2:hover { transform: rotate(0deg) translateX(20px) scale(1.02); }

  .ecp-tag {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(52,145,136, 0.15);
    border-radius: 50px;
    padding: 4px 12px;
    font-size: 11px;
    font-weight: 600;
    color: var(--orange);
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 12px;
  }

  .ecp-title {
    font-family: var(--font-display);
    font-size: 22px;
    font-weight: 800;
    margin-bottom: 8px;
    text-transform: uppercase;
  }

  .ecp-info {
    display: flex;
    gap: 16px;
    font-size: 13px;
    color: var(--grey);
  }

  .ecp-info span { display: flex; align-items: center; gap: 5px; }

  .ecp-avatars {
    display: flex;
    margin-top: 14px;
    align-items: center;
    gap: 0;
  }

  .ecp-avatar {
    width: 30px;
    height: 30px;
    border-radius: 50%;
    border: 2px solid var(--bg);
    margin-right: -8px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 14px;
    background: var(--dark2);
  }

  .ecp-count {
    margin-left: 14px;
    font-size: 12px;
    color: var(--grey);
  }

  /* ===================== STATS BAR ===================== */
  .stats-bar {
    display: flex;
    gap: 0;
    background: rgba(52,145,136, 0.08);
    border: 1px solid rgba(52,145,136, 0.15);
    border-radius: var(--radius);
    margin-top: 60px;
    overflow: hidden;
    position: relative;
    z-index: 1;
  }

  .stat-item {
    flex: 1;
    padding: 24px 32px;
    text-align: center;
    position: relative;
  }

  .stat-item:not(:last-child)::after {
    content: '';
    position: absolute;
    right: 0;
    top: 20%;
    height: 60%;
    width: 1px;
    background: rgba(52,145,136, 0.15);
  }

  .stat-num {
    font-family: var(--font-display);
    font-size: 42px;
    font-weight: 900;
    color: var(--orange);
    line-height: 1;
    display: block;
  }

  .stat-label {
    font-size: 13px;
    color: var(--grey);
    margin-top: 6px;
    display: block;
    font-weight: 500;
  }

  /* ===================== SECTIONS ===================== */
  section { padding: 100px 5%; }

  .section-label {
    font-family: var(--font-display);
    font-size: 13px;
    font-weight: 700;
    letter-spacing: 3px;
    text-transform: uppercase;
    color: var(--orange);
    margin-bottom: 16px;
    display: flex;
    align-items: center;
    gap: 10px;
  }

  .section-label::before {
    content: '';
    display: block;
    width: 24px;
    height: 2px;
    background: var(--orange);
  }

  h2 {
    font-family: var(--font-display);
    font-size: clamp(40px, 6vw, 72px);
    font-weight: 900;
    line-height: 1;
    text-transform: uppercase;
    letter-spacing: -0.5px;
    margin-bottom: 20px;
    color: #C06830;
  }

  h2 .accent { color: var(--orange); }

  .section-sub {
    font-size: 17px;
    color: var(--grey2);
    max-width: 540px;
    line-height: 1.65;
    margin-bottom: 60px;
  }

  /* ===================== HOW IT WORKS ===================== */
  .how-section { background: var(--dark); }

  .steps-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
  }

  .step {
    background: var(--dark2);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: var(--radius);
    padding: 48px 36px;
    position: relative;
    transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
  }

  .step:hover {
    border-color: rgba(52,145,136,0.3);
    box-shadow: var(--shadow);
    transform: translateY(-3px);
  }

  .step-num {
    font-family: var(--font-display);
    font-size: 100px;
    font-weight: 900;
    color: rgba(52,145,136, 0.07);
    line-height: 1;
    position: absolute;
    top: 20px;
    right: 24px;
  }

  .step-icon {
    width: 56px;
    height: 56px;
    background: #FFFFFF;
    border: 1px solid rgba(52,145,136, 0.3);
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    color: var(--orange);
    margin-bottom: 24px;
  }

  .step h3 {
    font-family: var(--font-display);
    font-size: 28px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 12px;
  }

  .step p {
    font-size: 15px;
    color: var(--grey2);
    line-height: 1.6;
  }

  /* Activity carousel in step 1 */
  .activity-pills {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    margin-top: 20px;
  }

  .activity-pill {
    display: flex;
    align-items: center;
    gap: 6px;
    background: rgba(52,145,136, 0.08);
    border: 1px solid rgba(52,145,136, 0.15);
    border-radius: 50px;
    padding: 6px 14px;
    font-size: 12px;
    font-weight: 500;
    color: var(--grey2);
    transition: all 0.2s;
    cursor: default;
  }

  .activity-pill:hover {
    background: rgba(52,145,136, 0.15);
    color: var(--white);
    border-color: var(--orange);
    transform: translateY(-1px);
  }

  /* ===================== FEATURES ===================== */
  .features-section { background: var(--bg); }

  .features-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
  }

  .feature-card {
    background: var(--dark2);
    border: 1px solid rgba(17, 17, 17, 0.06);
    border-radius: var(--radius);
    padding: 36px 32px;
    position: relative;
    overflow: hidden;
    transition: all 0.3s cubic-bezier(0.4,0,0.2,1);
    cursor: default;
  }

  .feature-card::before {
    content: '';
    position: absolute;
    top: 0;
    left: 0;
    right: 0;
    height: 1px;
    background: linear-gradient(90deg, transparent, var(--orange), transparent);
    opacity: 0;
    transition: opacity 0.3s;
  }

  .feature-card:hover {
    transform: translateY(-4px);
    border-color: rgba(52,145,136, 0.2);
    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.1);
  }

  .feature-card:hover::before { opacity: 1; }

  .feature-icon {
    width: 48px;
    height: 48px;
    background: linear-gradient(135deg, rgba(52,145,136,0.15), rgba(52,145,136,0.05));
    border-radius: var(--radius-sm);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 20px;
    color: var(--orange);
    margin-bottom: 20px;
  }

  .feature-card h3 {
    font-family: var(--font-display);
    font-size: 20px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    margin-bottom: 10px;
  }

  .feature-card p {
    font-size: 14px;
    color: var(--grey);
    line-height: 1.65;
  }

  .feature-card.span2 { grid-column: span 2; }

  /* ===================== USER TYPES ===================== */
  .users-section { background: var(--dark); }

  .users-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
  }

  .user-card {
    border-radius: var(--radius);
    padding: 40px 32px;
    position: relative;
    overflow: hidden;
    transition: transform 0.3s;
  }

  .user-card:hover { transform: translateY(-6px); }

  .user-card.particulier {
    background: linear-gradient(145deg, var(--dark2), var(--dark3));
    border: 1px solid rgba(52,145,136, 0.2);
  }

  .user-card.association {
    background: linear-gradient(145deg, rgba(59, 130, 246, 0.08), rgba(59, 130, 246, 0.03));
    border: 1px solid rgba(59, 130, 246, 0.25);
  }

  .user-card.pro {
    background: linear-gradient(145deg, rgba(255, 107, 53, 0.08), rgba(255, 107, 53, 0.03));
    border: 1px solid rgba(255, 107, 53, 0.25);
  }

  .user-tag {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    border-radius: 50px;
    padding: 5px 14px;
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    margin-bottom: 24px;
  }

  .particulier .user-tag { background: rgba(52,145,136,0.12); color: var(--orange); }
  .association .user-tag { background: rgba(59,130,246,0.12); color: var(--blue); }
  .pro .user-tag { background: rgba(255,107,53,0.12); color: var(--orange); }

  .user-card h3 {
    font-family: var(--font-display);
    font-size: 32px;
    font-weight: 900;
    text-transform: uppercase;
    margin-bottom: 14px;
  }

  .user-card > p {
    font-size: 14px;
    color: var(--grey2);
    line-height: 1.65;
    margin-bottom: 28px;
  }

  .user-features {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 10px;
  }

  .user-features li {
    display: flex;
    align-items: center;
    gap: 10px;
    font-size: 14px;
    color: var(--grey2);
  }

  .user-features li::before {
    content: '';
    width: 18px;
    height: 18px;
    border-radius: 50%;
    flex-shrink: 0;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 9px;
  }

  .particulier .user-features li::before { background: rgba(52,145,136,0.15); content: '✓'; color: var(--orange); display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; }
  .association .user-features li::before { background: rgba(59,130,246,0.15); content: '✓'; color: var(--blue); display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; }
  .pro .user-features li::before { background: rgba(255,107,53,0.15); content: '✓'; color: var(--orange); display: flex; align-items: center; justify-content: center; font-size: 10px; font-weight: 700; }

  /* ===================== PRICING ===================== */
  .pricing-section { background: var(--bg); }

  .pricing-grid {
    display: grid;
    grid-template-columns: repeat(4, 1fr);
    gap: 16px;
    align-items: start;
  }

  .pricing-card {
    background: var(--dark2);
    border: 1px solid rgba(17, 17, 17, 0.07);
    border-radius: var(--radius);
    padding: 32px 28px;
    position: relative;
    transition: transform 0.3s;
  }

  .pricing-card:hover { transform: translateY(-4px); }

  .pricing-card.popular {
    background: linear-gradient(160deg, rgba(52,145,136,0.08) 0%, var(--dark2) 60%);
    border-color: var(--orange);
    transform: scale(1.04);
  }

  .pricing-card.popular:hover { transform: scale(1.04) translateY(-4px); }

  .popular-badge {
    position: absolute;
    top: -14px;
    left: 50%;
    transform: translateX(-50%);
    background: var(--orange);
    color: var(--bg);
    font-size: 11px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    padding: 5px 16px;
    border-radius: 50px;
    white-space: nowrap;
  }

  .plan-name {
    font-family: var(--font-display);
    font-size: 22px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 1px;
    margin-bottom: 8px;
  }

  .plan-price {
    font-family: var(--font-display);
    font-size: 48px;
    font-weight: 900;
    line-height: 1;
    margin: 20px 0 6px;
  }

  .plan-price .currency { font-size: 24px; vertical-align: top; margin-top: 8px; }
  .plan-price .period { font-size: 16px; font-weight: 400; color: var(--grey); font-family: var(--font-body); }

  .plan-price.tbd {
    font-size: 20px;
    color: var(--orange);
    font-family: var(--font-body);
    font-weight: 600;
  }

  .plan-divider {
    height: 1px;
    background: rgba(17,17,17,0.07);
    margin: 24px 0;
  }

  .plan-features {
    list-style: none;
    display: flex;
    flex-direction: column;
    gap: 12px;
    margin-bottom: 28px;
  }

  .plan-features li {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    font-size: 13.5px;
    color: var(--grey2);
    line-height: 1.4;
  }

  .plan-features li .check {
    color: var(--orange);
    flex-shrink: 0;
    margin-top: 1px;
    font-size: 12px;
  }

  .plan-features li .cross {
    color: rgba(17,17,17,0.2);
    flex-shrink: 0;
    margin-top: 1px;
    font-size: 12px;
  }

  .plan-features li.dimmed { color: rgba(17,17,17,0.25); }

  /* ===================== GAMIFICATION ===================== */
  .gamif-section { background: var(--dark); overflow: hidden; }

  .ranks-track {
    display: flex;
    gap: 0;
    margin: 48px 0;
    position: relative;
    overflow-x: auto;
    padding-bottom: 16px;
    scrollbar-width: none;
  }

  .ranks-track::-webkit-scrollbar { display: none; }

  .ranks-track::before {
    content: '';
    position: absolute;
    top: 34px;
    left: 40px;
    right: 40px;
    height: 2px;
    background: linear-gradient(90deg, transparent, rgba(52,145,136,0.3) 10%, rgba(52,145,136,0.3) 90%, transparent);
    z-index: 0;
  }

  .rank-item {
    display: flex;
    flex-direction: column;
    align-items: center;
    gap: 12px;
    flex: 0 0 100px;
    position: relative;
    z-index: 1;
    cursor: pointer;
    transition: transform 0.2s;
  }

  .rank-item:hover { transform: translateY(-4px); }

  .rank-shoe {
    width: 68px;
    height: 68px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 28px;
    position: relative;
    transition: all 0.3s;
    border: 2px solid transparent;
  }

  .rank-item:hover .rank-shoe {
    border-color: var(--orange);
    box-shadow: 0 0 20px var(--red-glow);
  }

  .rank-shoe.paper { background: linear-gradient(135deg, #e0d5c5, #c4b89a); }
  .rank-shoe.wood { background: linear-gradient(135deg, #8B6914, #5C4209); }
  .rank-shoe.bronze { background: linear-gradient(135deg, #CD7F32, #8C5210); }
  .rank-shoe.iron { background: linear-gradient(135deg, #8A8A9A, #5A5A6A); }
  .rank-shoe.silver { background: linear-gradient(135deg, #C0C0D0, #909090); }
  .rank-shoe.gold { background: linear-gradient(135deg, #FFD700, #B8860B); }
  .rank-shoe.platinum { background: linear-gradient(135deg, #e5e4e2, #9D9D9D); }
  .rank-shoe.diamond { background: linear-gradient(135deg, #b9f2ff, #4fd8f5, #b9f2ff); }
  .rank-shoe.emerald { background: linear-gradient(135deg, #E53935, #B71C1C); }
  .rank-shoe.plus1 { background: linear-gradient(135deg, var(--orange), #FF8A80); border: 2px solid var(--orange); box-shadow: 0 0 30px var(--red-glow); }

  .rank-name {
    font-family: var(--font-display);
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--grey);
    text-align: center;
    line-height: 1.2;
  }

  .rank-item.active .rank-name { color: var(--orange); }

  .points-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 20px;
    margin-top: 20px;
  }

  .points-card {
    background: var(--dark2);
    border: 1px solid rgba(17,17,17,0.07);
    border-radius: var(--radius);
    padding: 28px;
    text-align: center;
    transition: border-color 0.2s;
  }

  .points-card:hover { border-color: rgba(52,145,136,0.2); }

  .points-card .pts-value {
    font-family: var(--font-display);
    font-size: 60px;
    font-weight: 900;
    line-height: 1;
    color: var(--orange);
  }

  .points-card .pts-value .pts-sub { font-size: 24px; color: var(--grey); }
  .points-card h4 { font-family: var(--font-display); font-size: 18px; font-weight: 800; text-transform: uppercase; margin: 10px 0 6px; }
  .points-card p { font-size: 13px; color: var(--grey); }

  /* ===================== SAFETY ===================== */
  .safety-section { background: var(--bg); }

  .safety-grid {
    display: grid;
    grid-template-columns: 1fr 1fr;
    gap: 20px;
    align-items: start;
  }

  .safety-left h2 { margin-bottom: 16px; }

  .safety-items {
    display: flex;
    flex-direction: column;
    gap: 16px;
    margin-top: 32px;
  }

  .safety-item {
    display: flex;
    gap: 20px;
    align-items: flex-start;
    background: var(--dark2);
    border: 1px solid rgba(17,17,17,0.06);
    border-radius: var(--radius-sm);
    padding: 24px;
    transition: border-color 0.2s;
  }

  .safety-item:hover { border-color: rgba(52,145,136,0.15); }

  .safety-num {
    font-family: var(--font-display);
    font-size: 36px;
    font-weight: 900;
    color: rgba(52,145,136,0.15);
    line-height: 1;
    flex-shrink: 0;
  }

  .safety-text h4 {
    font-family: var(--font-display);
    font-size: 18px;
    font-weight: 800;
    text-transform: uppercase;
    margin-bottom: 6px;
  }

  .safety-text p { font-size: 14px; color: var(--grey); line-height: 1.6; }

  .safety-right {
    background: var(--dark2);
    border: 1px solid rgba(52,145,136,0.15);
    border-radius: var(--radius);
    padding: 40px;
    position: sticky;
    top: 100px;
  }

  .safety-bigstat {
    text-align: center;
    padding: 40px 20px;
    background: rgba(52,145,136,0.04);
    border-radius: var(--radius-sm);
    border: 1px solid rgba(52,145,136,0.1);
    margin-bottom: 24px;
  }

  .safety-bigstat .big {
    font-family: var(--font-display);
    font-size: 72px;
    font-weight: 900;
    color: var(--orange);
    line-height: 1;
    display: block;
  }

  .safety-bigstat p { font-size: 14px; color: var(--grey2); margin-top: 8px; }

  .safety-note {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 18px;
    background: rgba(52,145,136,0.05);
    border-radius: var(--radius-sm);
    border-left: 3px solid var(--orange);
    font-size: 14px;
    color: var(--grey2);
    line-height: 1.5;
  }

  .safety-note i { color: var(--orange); font-size: 18px; flex-shrink: 0; }

  /* ===================== CTA BANNER ===================== */
  .cta-section {
    background: var(--dark);
    padding: 100px 5%;
    position: relative;
    overflow: hidden;
  }

  .cta-section::before {
    content: '';
    position: absolute;
    inset: 0;
    background: radial-gradient(ellipse 60% 80% at 50% 50%, rgba(52,145,136,0.07) 0%, transparent 70%);
  }

  .cta-inner {
    position: relative;
    text-align: center;
    max-width: 700px;
    margin: 0 auto;
  }

  .cta-inner h2 { font-size: clamp(48px, 8vw, 96px); margin-bottom: 16px; }

  .cta-inner p {
    font-size: 18px;
    color: var(--grey2);
    margin-bottom: 48px;
    line-height: 1.6;
  }

  .cta-buttons {
    display: flex;
    gap: 16px;
    justify-content: center;
    flex-wrap: wrap;
  }

  /* ===================== FOOTER ===================== */
  footer {
    background: var(--dark2);
    border-top: 1px solid rgba(17,17,17,0.07);
    padding: 60px 5% 40px;
  }

  .footer-top {
    display: grid;
    grid-template-columns: 2fr 1fr 1fr 1fr;
    gap: 48px;
    margin-bottom: 48px;
  }

  .footer-brand p {
    font-size: 14px;
    color: var(--grey);
    line-height: 1.7;
    margin-top: 16px;
    max-width: 280px;
  }

  .footer-col h4 {
    font-family: var(--font-display);
    font-size: 14px;
    font-weight: 800;
    text-transform: uppercase;
    letter-spacing: 1.5px;
    color: var(--grey2);
    margin-bottom: 20px;
  }

  .footer-col ul { list-style: none; display: flex; flex-direction: column; gap: 12px; }

  .footer-col ul a {
    font-size: 14px;
    color: var(--grey);
    text-decoration: none;
    transition: color 0.2s;
  }

  .footer-col ul a:hover { color: var(--white); }

  .social-links {
    display: flex;
    gap: 12px;
    margin-top: 20px;
  }

  .social-link {
    width: 38px;
    height: 38px;
    background: rgba(17,17,17,0.05);
    border: 1px solid rgba(17,17,17,0.1);
    border-radius: 8px;
    display: flex;
    align-items: center;
    justify-content: center;
    color: var(--grey);
    text-decoration: none;
    font-size: 15px;
    transition: all 0.2s;
  }

  .social-link:hover {
    background: rgba(52,145,136,0.1);
    border-color: rgba(52,145,136,0.3);
    color: var(--orange);
  }

  .footer-bottom {
    display: flex;
    justify-content: space-between;
    align-items: center;
    padding-top: 32px;
    border-top: 1px solid rgba(17,17,17,0.06);
    flex-wrap: wrap;
    gap: 12px;
  }

  .footer-bottom p { font-size: 13px; color: var(--grey); }

  .footer-tagline {
    font-size: 13px;
    color: var(--grey);
    display: flex;
    align-items: center;
    gap: 6px;
  }

  .footer-tagline span { color: var(--orange); }

  /* ===================== ANIMATIONS ===================== */
  .fade-up {
    opacity: 0;
    transform: translateY(30px);
    transition: opacity 0.6s cubic-bezier(0.4,0,0.2,1), transform 0.6s cubic-bezier(0.4,0,0.2,1);
  }

  .fade-up.visible {
    opacity: 1;
    transform: translateY(0);
  }

  .fade-up:nth-child(1) { transition-delay: 0ms; }
  .fade-up:nth-child(2) { transition-delay: 80ms; }
  .fade-up:nth-child(3) { transition-delay: 160ms; }
  .fade-up:nth-child(4) { transition-delay: 240ms; }

  /* ===================== RESPONSIVE ===================== */
  @media (max-width: 1200px) {
    .hero-visual { display: none; }
    .pricing-grid { grid-template-columns: repeat(2, 1fr); }
    .pricing-card.popular { transform: none; }
    .pricing-card.popular:hover { transform: translateY(-4px); }
  }

  @media (max-width: 900px) {
    .nav-links, .nav-cta { display: none; }
    .hamburger { display: flex; }
    h1 { font-size: clamp(52px, 12vw, 80px); }
    .steps-grid { grid-template-columns: 1fr; }
    .features-grid { grid-template-columns: 1fr 1fr; }
    .feature-card.span2 { grid-column: span 1; }
    .users-grid { grid-template-columns: 1fr; }
    .points-grid { grid-template-columns: 1fr; }
    .safety-grid { grid-template-columns: 1fr; }
    .footer-top { grid-template-columns: 1fr 1fr; }
  }

  @media (max-width: 600px) {
    section { padding: 72px 5%; }
    .stats-bar { flex-direction: column; }
    .stat-item:not(:last-child)::after { display: none; }
    .features-grid { grid-template-columns: 1fr; }
    .pricing-grid { grid-template-columns: 1fr; }
    .footer-top { grid-template-columns: 1fr; }
    .footer-bottom { flex-direction: column; text-align: center; }
    .hero-ctas { flex-direction: column; }
    .hero-ctas .btn { width: 100%; justify-content: center; }
  }

  /* ===================== TOAST ===================== */
  #toast {
    position: fixed;
    bottom: 32px;
    left: 50%;
    transform: translateX(-50%) translateY(20px);
    background: #FFFFFF;
    color: var(--white);
    border: 1.5px solid rgba(192,104,48,0.35);
    border-left: 4px solid #C06830;
    border-radius: 12px;
    padding: 14px 22px;
    font-size: 14px;
    font-weight: 500;
    box-shadow: 0 8px 32px rgba(0,0,0,0.14);
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.25s, transform 0.25s;
    z-index: 9999;
    white-space: nowrap;
  }
  #toast.show {
    opacity: 1;
    transform: translateX(-50%) translateY(0);
    pointer-events: auto;
  }

  /* ===================== MODALS ===================== */
  .modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.82);
    backdrop-filter: blur(12px);
    z-index: 2000;
    display: flex;
    align-items: center;
    justify-content: center;
    padding: 20px;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.3s ease;
  }
  .modal-overlay.open {
    opacity: 1;
    pointer-events: all;
  }
  .modal-box {
    background: #FFFFFF;
    border: 1px solid rgba(0,0,0,0.08);
    border-radius: 24px;
    width: 100%;
    max-width: 560px;
    max-height: 90vh;
    overflow-y: auto;
    position: relative;
    box-shadow: var(--shadow-lg);
    transform: translateY(24px) scale(0.97);
    transition: transform 0.35s cubic-bezier(0.4,0,0.2,1);
    scrollbar-width: none;
  }
  .modal-box::-webkit-scrollbar { display: none; }
  .modal-overlay.open .modal-box {
    transform: translateY(0) scale(1);
  }
  .modal-box.wide { max-width: 720px; }
  .modal-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 28px 32px 0;
  }
  .modal-title {
    font-family: var(--font-display);
    font-size: 28px;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: 0.5px;
  }
  .modal-close {
    width: 36px; height: 36px;
    background: rgba(17,17,17,0.06);
    border: 1px solid rgba(17,17,17,0.1);
    border-radius: 50%;
    color: var(--grey2);
    font-size: 16px;
    cursor: pointer;
    display: flex; align-items: center; justify-content: center;
    transition: all 0.2s;
    flex-shrink: 0;
  }
  .modal-close:hover { background: rgba(17,17,17,0.12); color: var(--white); }
  .modal-body { padding: 24px 32px 32px; }

  /* Steps indicator */
  .modal-steps {
    display: flex;
    align-items: center;
    gap: 0;
    margin-bottom: 32px;
  }
  .modal-step-dot {
    width: 28px; height: 28px;
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-family: var(--font-display);
    font-size: 13px;
    font-weight: 800;
    border: 2px solid rgba(17,17,17,0.12);
    color: var(--grey);
    transition: all 0.3s;
    flex-shrink: 0;
  }
  .modal-step-dot.active { background: var(--orange); border-color: var(--orange); color: var(--bg); }
  .modal-step-dot.done { background: rgba(52,145,136,0.2); border-color: rgba(52,145,136,0.4); color: var(--orange); }
  .modal-step-line {
    flex: 1;
    height: 1px;
    background: rgba(17,17,17,0.08);
    transition: background 0.3s;
  }
  .modal-step-line.done { background: rgba(52,145,136,0.3); }

  /* Panes */
  .modal-pane { display: none; }
  .modal-pane.active { display: block; }

  /* Profile type cards */
  .profile-cards {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 12px;
    margin-bottom: 28px;
  }
  .profile-card {
    border: 2px solid rgba(17,17,17,0.08);
    border-radius: var(--radius-sm);
    padding: 20px 14px;
    text-align: center;
    cursor: pointer;
    transition: all 0.2s;
    background: var(--dark3);
  }
  .profile-card:hover { border-color: rgba(52,145,136,0.3); background: rgba(52,145,136,0.04); }
  .profile-card.selected { border-color: var(--orange); background: rgba(52,145,136,0.08); }
  .profile-card .pc-icon { font-size: 32px; margin-bottom: 10px; display: block; }
  .profile-card .pc-name {
    font-family: var(--font-display);
    font-size: 16px;
    font-weight: 800;
    text-transform: uppercase;
    margin-bottom: 4px;
  }
  .profile-card .pc-desc { font-size: 11px; color: var(--grey); line-height: 1.4; }

  /* Form fields */
  .form-group { margin-bottom: 18px; }
  .form-label {
    display: block;
    font-size: 13px;
    font-weight: 600;
    color: var(--grey2);
    margin-bottom: 7px;
    letter-spacing: 0.3px;
  }
  .form-input, .form-select, .form-textarea {
    width: 100%;
    background: var(--dark3);
    border: 1.5px solid rgba(0,0,0,0.14);
    border-radius: var(--radius-sm);
    padding: 12px 16px;
    color: var(--white);
    font-family: var(--font-body);
    font-size: 14px;
    outline: none;
    transition: border-color 0.2s, box-shadow 0.2s;
    appearance: none;
  }
  .form-input:focus, .form-select:focus, .form-textarea:focus {
    border-color: var(--orange);
    box-shadow: 0 0 0 3px rgba(52,145,136,0.15);
    background: var(--dark2);
  }
  .form-textarea { resize: vertical; min-height: 80px; }
  .form-row { display: grid; grid-template-columns: 1fr 1fr; gap: 14px; }
  .form-hint { font-size: 11px; color: var(--grey); margin-top: 5px; }

  /* Checkbox */
  .form-check {
    display: flex;
    align-items: flex-start;
    gap: 10px;
    font-size: 13px;
    color: var(--grey2);
    cursor: pointer;
    line-height: 1.5;
  }
  .form-check input[type=checkbox] {
    width: 17px; height: 17px;
    accent-color: var(--orange);
    flex-shrink: 0;
    margin-top: 2px;
    cursor: pointer;
  }

  /* Activity carousel in event modal */
  .activity-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 7px;
    margin-bottom: 20px;
    max-height: 230px;
    overflow-y: auto;
    padding-right: 4px;
    scrollbar-width: thin;
    scrollbar-color: rgba(52,145,136,0.3) transparent;
  }
  .activity-tile {
    border: 2px solid rgba(17,17,17,0.08);
    border-radius: 10px;
    padding: 9px 5px;
    text-align: center;
    cursor: pointer;
    background: var(--dark3);
    transition: all 0.2s;
  }
  .activity-tile:hover { border-color: rgba(52,145,136,0.3); transform: translateY(-1px); }
  .activity-tile.selected { border-color: var(--orange); background: rgba(52,145,136,0.08); }
  .activity-tile .at-icon { font-size: 20px; display: block; margin-bottom: 4px; }
  .activity-tile .at-name { font-size: 9.5px; font-weight: 600; color: var(--grey2); line-height: 1.2; }
  .activity-tile-autre { border-style: dashed; border-color: rgba(255,255,255,0.15); }
  .activity-tile-autre.selected { border-style: solid; border-color: var(--orange); }

  /* Level selector */
  .level-selector { display: flex; gap: 10px; margin-bottom: 4px; }
  .level-btn {
    flex: 1;
    padding: 10px 6px;
    border: 1.5px solid rgba(17,17,17,0.1);
    border-radius: 8px;
    background: var(--dark3);
    color: var(--grey2);
    font-family: var(--font-body);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    text-align: center;
    transition: all 0.2s;
  }
  .level-btn:hover { border-color: rgba(52,145,136,0.3); color: var(--white); }
  .level-btn.selected { border-color: var(--orange); background: rgba(52,145,136,0.1); color: var(--orange); }

  /* Toggle switch */
  .toggle-row {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding: 14px 16px;
    background: var(--dark3);
    border: 1px solid rgba(17,17,17,0.07);
    border-radius: var(--radius-sm);
    margin-bottom: 10px;
  }
  .toggle-row label { font-size: 14px; color: var(--grey2); display: flex; align-items: center; gap: 8px; }
  .toggle-switch {
    position: relative;
    width: 40px;
    height: 22px;
    flex-shrink: 0;
  }
  .toggle-switch input { opacity: 0; width: 0; height: 0; position: absolute; }
  .toggle-slider {
    position: absolute;
    inset: 0;
    background: rgba(17,17,17,0.12);
    border-radius: 50px;
    cursor: pointer;
    transition: background 0.2s;
  }
  .toggle-slider::before {
    content: '';
    position: absolute;
    width: 16px; height: 16px;
    background: var(--white);
    border-radius: 50%;
    top: 3px; left: 3px;
    transition: transform 0.2s;
  }
  .toggle-switch input:checked + .toggle-slider { background: var(--orange); }
  .toggle-switch input:checked + .toggle-slider::before { transform: translateX(18px); }

  /* Success screen */
  .success-screen {
    text-align: center;
    padding: 20px 0 10px;
  }
  .success-icon {
    width: 80px; height: 80px;
    background: rgba(52,145,136,0.12);
    border: 2px solid rgba(52,145,136,0.3);
    border-radius: 50%;
    display: flex; align-items: center; justify-content: center;
    font-size: 36px;
    margin: 0 auto 24px;
    animation: popIn 0.5s cubic-bezier(0.4,0,0.2,1);
  }
  @keyframes popIn {
    0% { transform: scale(0.4); opacity: 0; }
    70% { transform: scale(1.1); }
    100% { transform: scale(1); opacity: 1; }
  }
  .success-screen h3 {
    font-family: var(--font-display);
    font-size: 32px;
    font-weight: 900;
    text-transform: uppercase;
    margin-bottom: 12px;
  }
  .success-screen p { font-size: 15px; color: var(--grey2); line-height: 1.6; margin-bottom: 28px; }

  /* Modal footer buttons */
  .modal-footer {
    display: flex;
    gap: 12px;
    margin-top: 28px;
    justify-content: flex-end;
  }
  .modal-footer .btn { min-width: 130px; justify-content: center; }

  /* Event preview card */
  .event-preview-card {
    background: var(--dark3);
    border: 1px solid rgba(52,145,136,0.2);
    border-radius: var(--radius);
    padding: 24px;
    margin-bottom: 20px;
  }
  .epc-header { display: flex; align-items: center; gap: 12px; margin-bottom: 16px; }
  .epc-sport-badge {
    background: rgba(52,145,136,0.12);
    border: 1px solid rgba(52,145,136,0.2);
    border-radius: 8px;
    padding: 8px 12px;
    font-size: 22px;
  }
  .epc-info-row {
    display: flex;
    flex-wrap: wrap;
    gap: 12px;
    font-size: 13px;
    color: var(--grey2);
  }
  .epc-info-row span { display: flex; align-items: center; gap: 5px; }
  .epc-info-row i { color: var(--orange); }

  @media (max-width: 600px) {
    .modal-box { border-radius: 20px; }
    .modal-header { padding: 22px 20px 0; }
    .modal-body { padding: 20px 20px 28px; }
    .profile-cards { grid-template-columns: 1fr; }
    .activity-grid { grid-template-columns: repeat(3, 1fr); }
    .form-row { grid-template-columns: 1fr; }
    .modal-footer { flex-direction: column; }
    .modal-footer .btn { width: 100%; }
  }

  /* ===================== PAGES EXPLORER / MEMBRES ===================== */
  .page-view {
    min-height: 100vh;
    background: var(--bg);
    padding: 88px 5% 80px;
  }

  .page-back {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: var(--grey);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    background: none;
    border: none;
    padding: 8px 0;
    margin-bottom: 28px;
    transition: color 0.2s;
  }
  .page-back:hover { color: var(--white); }

  .page-title {
    font-family: var(--font-display);
    font-size: clamp(36px, 5vw, 60px);
    font-weight: 900;
    text-transform: uppercase;
    line-height: 1;
    margin-bottom: 8px;
  }

  .page-sub {
    font-size: 15px;
    color: var(--grey);
    margin-bottom: 36px;
    max-width: 480px;
    line-height: 1.6;
  }

  /* Filter bar */
  .filter-bar {
    display: flex;
    gap: 8px;
    flex-wrap: wrap;
    margin-bottom: 32px;
    padding-bottom: 24px;
    border-bottom: 1px solid rgba(255,255,255,0.07);
  }

  .filter-btn {
    padding: 7px 16px;
    border-radius: 50px;
    border: 1.5px solid rgba(255,255,255,0.1);
    background: transparent;
    color: var(--grey2);
    font-family: var(--font-body);
    font-size: 13px;
    font-weight: 500;
    cursor: pointer;
    transition: all 0.2s;
  }
  .filter-btn:hover { border-color: rgba(52,145,136,0.3); color: var(--white); }
  .filter-btn.active {
    background: var(--orange);
    border-color: var(--orange);
    color: #FDFAF5;
    box-shadow: 0 2px 8px rgba(52,145,136,0.3);
  }

  /* City filter */
  .city-filter-row {
    display: flex;
    align-items: center;
    gap: 10px;
    margin-bottom: 24px;
    color: var(--grey);
  }
  .city-filter-input {
    flex: 1;
    background: var(--dark2);
    border: 1.5px solid rgba(255,255,255,0.1);
    border-radius: 50px;
    color: var(--white);
    font-family: var(--font-body);
    font-size: 13px;
    padding: 8px 18px;
    outline: none;
    transition: border-color 0.2s;
  }
  .city-filter-input::placeholder { color: var(--grey); }
  .city-filter-input:focus { border-color: rgba(52,145,136,0.4); }
  .city-filter-clear {
    background: none;
    border: none;
    color: var(--grey);
    cursor: pointer;
    font-size: 14px;
    padding: 4px 6px;
    transition: color 0.2s;
  }
  .city-filter-clear:hover { color: var(--white); }

  /* Explorer main tabs */
  .explorer-main-tabs {
    display: flex;
    gap: 4px;
    margin-bottom: 24px;
    background: var(--dark2);
    padding: 4px;
    border-radius: 14px;
  }
  .explorer-main-tab {
    flex: 1;
    background: none;
    border: none;
    color: var(--grey);
    font-family: var(--font-body);
    font-size: 14px;
    font-weight: 500;
    padding: 10px 12px;
    border-radius: 10px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 6px;
  }
  .explorer-main-tab.active {
    background: var(--orange);
    color: #FDFAF5;
    box-shadow: 0 2px 8px rgba(52,145,136,0.3);
  }
  .explorer-main-tab:hover:not(.active) {
    color: var(--white);
    background: rgba(255,255,255,0.05);
  }

  /* Explorer panels */
  .explorer-panel { display: none; }
  .explorer-panel.active { display: block; }

  /* Mes events toolbar */
  .mes-events-toolbar {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 20px;
    gap: 12px;
  }
  .mes-events-count { font-size: 13px; color: var(--grey); }
  .mes-events-sort-wrap { display: flex; align-items: center; gap: 6px; }
  .mes-events-sort {
    background: var(--dark2);
    border: 1.5px solid rgba(255,255,255,0.1);
    border-radius: 8px;
    color: var(--white);
    font-family: var(--font-body);
    font-size: 13px;
    padding: 6px 10px;
    outline: none;
    cursor: pointer;
  }

  /* Mes events sections */
  .mes-section-header {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--grey);
    margin-bottom: 14px;
  }
  .mes-section-divider {
    display: flex;
    align-items: center;
    gap: 10px;
    cursor: pointer;
    user-select: none;
    margin: 24px 0 14px;
  }
  .mes-section-divider-label {
    font-size: 11px;
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
    color: var(--grey);
    white-space: nowrap;
  }
  .mes-section-divider-line { flex: 1; height: 1px; background: rgba(255,255,255,0.08); }
  .mes-section-divider-icon { font-size: 10px; color: var(--grey); transition: transform 0.2s; }
  .mes-section-divider.open .mes-section-divider-icon { transform: rotate(180deg); }

  /* Compact past event card */
  .mes-event-compact {
    display: flex;
    align-items: center;
    gap: 12px;
    background: var(--dark2);
    border: 1px solid rgba(255,255,255,0.06);
    border-radius: 12px;
    padding: 10px 12px;
    margin-bottom: 8px;
    opacity: 0.65;
    transition: opacity 0.2s;
  }
  .mes-event-compact:hover { opacity: 0.9; }
  .mes-event-upcoming { opacity: 1; border-color: rgba(52,145,136,0.18); }
  .mes-event-compact-img {
    width: 42px;
    height: 42px;
    border-radius: 8px;
    flex-shrink: 0;
    background-size: cover;
    background-position: center;
  }
  .mes-event-compact-body { flex: 1; min-width: 0; }
  .mes-event-compact-title {
    font-size: 13px;
    font-weight: 600;
    color: var(--white);
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .mes-event-compact-meta { font-size: 11px; color: var(--grey); margin-top: 2px; }
  .mes-event-compact-badge {
    font-size: 10px;
    padding: 3px 8px;
    border-radius: 20px;
    background: rgba(255,255,255,0.07);
    color: var(--grey2);
    flex-shrink: 0;
    white-space: nowrap;
  }

  /* Clickable participant count */
  .event-participant-count.clickable {
    background: none;
    border: none;
    color: var(--grey2);
    font-size: 13px;
    cursor: pointer;
    padding: 0;
    font-family: var(--font-body);
    display: flex;
    align-items: center;
    gap: 4px;
    transition: color 0.2s;
  }
  .event-participant-count.clickable:hover { color: var(--white); }

  /* Explorer grid */
  .explorer-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
    gap: 16px;
  }

  .mes-events-grid {
    display: grid;
    grid-template-columns: repeat(5, 1fr);
    gap: 12px;
  }

  /* Membres grid */
  .membres-grid {
    display: grid;
    grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
    gap: 14px;
  }

  .membre-card {
    background: var(--dark2);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: var(--radius);
    padding: 24px 16px;
    text-align: center;
    cursor: pointer;
    transition: all 0.25s;
  }
  .membre-card:hover {
    border-color: rgba(52,145,136,0.3);
    transform: translateY(-3px);
    box-shadow: var(--shadow);
  }

  .membre-avatar {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    margin: 0 auto 12px;
    overflow: hidden;
    border: 2px solid rgba(52,145,136,0.25);
    background: var(--dark3);
    display: flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-display);
    font-size: 26px;
    font-weight: 800;
    color: var(--orange);
  }
  .membre-avatar img { width: 100%; height: 100%; object-fit: cover; }

  .membre-name {
    font-family: var(--font-display);
    font-size: 19px;
    font-weight: 800;
    text-transform: uppercase;
    margin-bottom: 6px;
    line-height: 1.1;
  }

  .membre-meta {
    font-size: 12px;
    color: var(--grey);
    margin-bottom: 8px;
    display: flex;
    flex-direction: column;
    gap: 3px;
  }

  .membre-rank {
    display: inline-flex;
    align-items: center;
    gap: 4px;
    font-size: 11px;
    font-weight: 600;
    color: var(--grey2);
    background: rgba(255,255,255,0.05);
    border-radius: 50px;
    padding: 3px 10px;
    margin-top: 4px;
  }

  /* Creator button on event cards */
  .event-item-creator {
    margin-top: 14px;
    padding-top: 12px;
    border-top: 1px solid rgba(255,255,255,0.07);
  }

  .creator-btn {
    display: flex;
    align-items: center;
    gap: 8px;
    width: 100%;
    background: rgba(255,255,255,0.03);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: 8px;
    cursor: pointer;
    color: var(--grey);
    font-family: var(--font-body);
    font-size: 12px;
    font-weight: 500;
    padding: 7px 10px;
    transition: all 0.2s;
  }
  .creator-btn:hover { color: var(--white); background: rgba(255,255,255,0.06); border-color: rgba(52,145,136,0.25); }

  .creator-initial {
    width: 24px;
    height: 24px;
    border-radius: 50%;
    background: var(--dark3);
    border: 1px solid rgba(52,145,136,0.25);
    display: inline-flex;
    align-items: center;
    justify-content: center;
    font-family: var(--font-display);
    font-size: 12px;
    font-weight: 800;
    color: var(--orange);
    flex-shrink: 0;
  }

  /* Empty state */
  .empty-state {
    text-align: center;
    padding: 70px 20px;
    color: var(--grey);
    grid-column: 1 / -1;
  }
  .empty-state .empty-icon { font-size: 52px; margin-bottom: 16px; opacity: 0.5; display: block; }
  .empty-state p { font-size: 15px; line-height: 1.6; margin-bottom: 24px; color: var(--grey); }

  @media (max-width: 600px) {
    .page-view { padding: 78px 5% 60px; }
    .membres-grid { grid-template-columns: repeat(2, 1fr); }
  }

  /* ===================== SPORTS MARQUEE ===================== */
  .sports-strip-outer {
    overflow: hidden;
    padding: 20px 0;
    background: var(--dark);
    border-top: 1px solid rgba(26,23,20,0.06);
    border-bottom: 1px solid rgba(26,23,20,0.06);
    position: relative;
  }

  .sports-strip-outer::before,
  .sports-strip-outer::after {
    content: '';
    position: absolute;
    top: 0; bottom: 0;
    width: 120px;
    z-index: 2;
    pointer-events: none;
  }
  .sports-strip-outer::before { left: 0; background: linear-gradient(to right, var(--dark), transparent); }
  .sports-strip-outer::after  { right: 0; background: linear-gradient(to left,  var(--dark), transparent); }

  .sports-strip {
    display: flex;
    gap: 12px;
    width: max-content;
    animation: marquee 40s linear infinite;
  }

  @keyframes marquee {
    0%   { transform: translateX(0); }
    100% { transform: translateX(-50%); }
  }

  .sports-strip-outer:hover .sports-strip { animation-play-state: paused; }

  .sport-pill {
    position: relative;
    width: 150px;
    height: 96px;
    border-radius: 12px;
    overflow: hidden;
    flex-shrink: 0;
    background-size: cover;
    background-position: center;
    cursor: default;
  }
  .sport-pill::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(to top, rgba(0,0,0,0.72) 0%, rgba(0,0,0,0.08) 60%);
  }
  .sport-pill span {
    position: absolute;
    bottom: 10px;
    left: 0; right: 0;
    text-align: center;
    color: #fff;
    font-size: 12px;
    font-weight: 700;
    letter-spacing: 0.6px;
    text-transform: uppercase;
    z-index: 1;
    text-shadow: 0 1px 4px rgba(0,0,0,0.4);
  }

  /* ===================== EVENTS PREVIEW ===================== */
  .events-section {
    background: var(--bg);
    padding: 80px 5%;
  }

  .events-grid {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 16px;
    margin-top: 48px;
  }

  /* Event card image banner */
  .event-item-banner {
    height: 110px;
    background-size: cover;
    background-position: center;
    border-radius: var(--radius) var(--radius) 0 0;
    margin: -24px -24px 18px -24px;
    position: relative;
    overflow: hidden;
  }
  .event-item-banner::after {
    content: '';
    position: absolute;
    inset: 0;
    background: linear-gradient(to bottom, rgba(0,0,0,0.15) 0%, rgba(0,0,0,0.6) 100%);
  }
  .event-item-banner-tags {
    position: absolute;
    bottom: 10px;
    left: 12px;
    right: 12px;
    z-index: 1;
    display: flex;
    align-items: center;
    gap: 6px;
    flex-wrap: wrap;
  }
  .event-item-banner-tags .event-tag {
    background: rgba(0,0,0,0.55);
    border-color: rgba(255,255,255,0.2);
    color: #fff;
    backdrop-filter: blur(4px);
  }
  .event-item-banner-tags .event-level {
    background: rgba(0,0,0,0.45);
    backdrop-filter: blur(4px);
  }
  .event-item-past-badge {
    position: absolute;
    top: 10px;
    right: 10px;
    z-index: 1;
    background: rgba(0,0,0,0.65);
    color: var(--grey2);
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.8px;
    padding: 3px 10px;
    border-radius: 50px;
    backdrop-filter: blur(4px);
  }

  .event-item {
    background: var(--dark2);
    border: 1px solid rgba(255,255,255,0.07);
    border-radius: var(--radius);
    padding: 24px;
    transition: all 0.25s cubic-bezier(0.4,0,0.2,1);
    cursor: default;
  }

  .event-item:hover {
    border-color: rgba(52,145,136,0.3);
    box-shadow: var(--shadow);
    transform: translateY(-3px);
  }

  .event-item-sport, .event-tag {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    background: rgba(52,145,136,0.08);
    border: 1px solid rgba(52,145,136,0.14);
    border-radius: 50px;
    padding: 4px 12px;
    font-size: 11px;
    font-weight: 700;
    color: var(--orange);
    text-transform: uppercase;
    letter-spacing: 0.8px;
    margin-bottom: 0;
  }

  .event-item-top {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-bottom: 14px;
    flex-wrap: wrap;
  }

  .event-item-desc {
    font-size: 13px;
    color: var(--grey);
    line-height: 1.6;
    margin-top: 10px;
    display: -webkit-box;
    -webkit-line-clamp: 2;
    -webkit-box-orient: vertical;
    overflow: hidden;
  }

  .event-item-title {
    font-family: var(--font-display);
    font-size: 22px;
    font-weight: 800;
    text-transform: uppercase;
    line-height: 1.1;
    margin-bottom: 14px;
  }

  .event-item-meta {
    display: flex;
    flex-direction: column;
    gap: 7px;
    font-size: 13px;
    color: var(--grey);
    margin-bottom: 16px;
  }

  .event-item-meta span { display: flex; align-items: center; gap: 8px; }
  .event-item-meta i { color: var(--orange); width: 14px; text-align: center; flex-shrink: 0; }

  .event-item-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    padding-top: 14px;
    border-top: 1px solid rgba(255,255,255,0.07);
  }

  .event-level {
    display: inline-flex;
    align-items: center;
    gap: 5px;
    font-size: 12px;
    font-weight: 600;
    color: var(--grey2);
  }

  .event-spots {
    font-size: 12px;
    color: var(--grey);
    display: flex;
    align-items: center;
    gap: 5px;
  }

  .event-spots strong { color: var(--orange); }

  @media (max-width: 900px) {
    .events-grid { grid-template-columns: 1fr 1fr; }
  }
  @media (max-width: 580px) {
    .events-grid { grid-template-columns: 1fr; }
  }

  /* ===================== NAV PROFILE PILL ===================== */
  .nav-profile-pill {
    display: flex;
    align-items: center;
    gap: 8px;
    padding: 5px 14px 5px 5px;
    background: rgba(255,255,255,0.07);
    border: 1px solid rgba(255,255,255,0.1);
    border-radius: 50px;
    cursor: pointer;
    font-size: 14px;
    font-weight: 500;
    color: var(--white);
    transition: all 0.2s;
    white-space: nowrap;
  }

  .nav-profile-pill:hover {
    background: rgba(255,255,255,0.11);
    border-color: rgba(52,145,136,0.4);
    box-shadow: 0 2px 10px rgba(0,0,0,0.3);
  }

  .nav-avatar-initial {
    width: 28px;
    height: 28px;
    border-radius: 50%;
    background: var(--orange);
    color: #FDFAF5;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 12px;
    font-weight: 700;
    flex-shrink: 0;
    font-family: var(--font-display);
    letter-spacing: 0.5px;
  }

  #navAvatar {
    border-radius: 50%;
    border: 2px solid rgba(52,145,136,0.4);
    object-fit: cover;
    display: none;
  }

  .nav-create-btn {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 8px 16px;
    background: var(--orange);
    color: #FDFAF5;
    border: none;
    border-radius: 50px;
    font-family: var(--font-body);
    font-size: 13px;
    font-weight: 600;
    cursor: pointer;
    transition: all 0.2s;
    white-space: nowrap;
    box-shadow: 0 2px 6px rgba(52,145,136,0.2);
  }

  .nav-create-btn:hover {
    background: var(--orange-dark);
    transform: translateY(-1px);
    box-shadow: 0 4px 12px rgba(52,145,136,0.3);
  }

  /* ===================== VIEW SWITCHING ===================== */
  .view { display: none; }
  .view.active { display: block; }

  /* ===================== PROFILE VIEW ===================== */
  #view-profil {
    min-height: 100vh;
    background: var(--bg);
    padding: 72px 5% 24px;
  }

  .profile-view {
    max-width: 560px;
    margin: 0 auto;
    background: var(--dark2);
    border: 1px solid rgba(0,0,0,0.07);
    border-radius: 20px;
    padding: 24px 28px 20px;
    box-shadow: var(--shadow);
  }

  @media (max-width: 600px) {
    #view-profil { padding: 72px 16px 40px; }
    .profile-view { padding: 28px 20px 24px; }
  }

  .profile-back {
    display: inline-flex;
    align-items: center;
    gap: 8px;
    color: var(--grey2);
    font-size: 14px;
    font-weight: 500;
    cursor: pointer;
    background: none;
    border: none;
    padding: 8px 0;
    margin-bottom: 36px;
    transition: color 0.2s;
  }

  .profile-back:hover { color: var(--white); }

  .profile-header {
    display: flex;
    flex-direction: column;
    align-items: center;
    text-align: center;
    margin-bottom: 16px;
  }

  .profile-avatar-wrap {
    width: 64px;
    height: 64px;
    border-radius: 50%;
    border: 3px solid var(--orange);
    overflow: hidden;
    margin-bottom: 8px;
    background: var(--dark3);
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 26px;
  }

  .profile-avatar-wrap img {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .profile-name {
    font-family: var(--font-display);
    font-size: 24px;
    font-weight: 900;
    text-transform: uppercase;
    letter-spacing: -0.5px;
    margin-bottom: 6px;
  }

  .profile-meta {
    display: flex;
    gap: 20px;
    font-size: 14px;
    color: var(--grey);
    justify-content: center;
    flex-wrap: wrap;
  }

  .profile-stats {
    display: grid;
    grid-template-columns: repeat(3, 1fr);
    gap: 8px;
    margin-bottom: 16px;
  }

  .profile-stat {
    background: var(--dark3);
    border: 1px solid rgba(0,0,0,0.07);
    border-radius: var(--radius-sm);
    padding: 12px 8px;
    text-align: center;
  }

  .profile-stat-num {
    font-family: var(--font-display);
    font-size: 28px;
    font-weight: 900;
    color: var(--orange);
    line-height: 1;
    display: block;
    margin-bottom: 4px;
  }

  .profile-stat-label {
    font-size: 12px;
    color: var(--grey);
    font-weight: 500;
  }

  /* Rank progression */
  .rank-progress-block {
    background: var(--dark3);
    border: 1px solid rgba(0,0,0,0.07);
    border-radius: var(--radius-sm);
    padding: 12px 16px 10px;
    margin-bottom: 12px;
  }

  .rank-progress-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 14px;
  }

  .rank-current-label {
    font-size: 11px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 1px;
    color: var(--grey);
  }

  .rank-next-label {
    font-size: 12px;
    color: var(--grey);
  }
  .rank-next-label strong { color: var(--white); }

  .rank-bar-track {
    height: 8px;
    background: rgba(255,255,255,0.08);
    border-radius: 99px;
    overflow: hidden;
    margin-bottom: 8px;
  }

  .rank-bar-fill {
    height: 100%;
    background: linear-gradient(90deg, var(--orange-dark), var(--orange));
    border-radius: 99px;
    transition: width 0.8s cubic-bezier(0.4, 0, 0.2, 1);
    min-width: 4px;
  }

  .rank-bar-labels {
    display: flex;
    justify-content: space-between;
    font-size: 11px;
    color: var(--grey);
  }

  .rank-ladder {
    display: flex;
    flex-direction: column;
    gap: 0;
    margin-top: 8px;
    padding-top: 8px;
    border-top: 1px solid rgba(0,0,0,0.07);
    max-height: 120px;
    overflow-y: auto;
  }

  .rank-step {
    display: flex;
    align-items: center;
    gap: 12px;
    padding: 8px 10px;
    border-radius: 10px;
    transition: background 0.15s;
    opacity: 0.45;
  }

  .rank-step.done { opacity: 0.65; }

  .rank-step.current {
    background: rgba(52,145,136,0.1);
    border: 1px solid rgba(52,145,136,0.2);
    opacity: 1;
  }

  .rank-step.current .rank-step-name { color: var(--white); font-weight: 700; }

  .rank-step-icon { font-size: 18px; width: 24px; text-align: center; flex-shrink: 0; }

  .rank-step-info { flex: 1; }

  .rank-step-name {
    font-size: 13px;
    font-weight: 600;
    color: var(--grey2);
    line-height: 1.2;
  }

  .rank-step-pts {
    font-size: 11px;
    color: var(--grey);
  }

  .rank-step-badge {
    font-size: 10px;
    font-weight: 700;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--orange);
    background: rgba(52,145,136,0.12);
    border-radius: 50px;
    padding: 2px 8px;
    flex-shrink: 0;
  }

  .rank-step-check {
    color: rgba(52,145,136,0.5);
    font-size: 13px;
    flex-shrink: 0;
  }

  .profile-actions {
    display: flex;
    flex-direction: column;
    gap: 12px;
  }

  .profile-actions .btn {
    justify-content: center;
    width: 100%;
  }

  /* ===================== AVATAR PICKER ===================== */
  .profile-avatar-wrap {
    position: relative;
    cursor: pointer;
  }
  .avatar-edit-overlay {
    position: absolute;
    inset: 0;
    border-radius: 50%;
    background: rgba(0,0,0,0.55);
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    transition: opacity 0.18s;
    font-size: 18px;
    color: #fff;
  }
  .profile-avatar-wrap:hover .avatar-edit-overlay { opacity: 1; }

  .avatar-modal-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.55);
    backdrop-filter: blur(6px);
    z-index: 2100;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }
  .avatar-modal-overlay.open { opacity: 1; pointer-events: all; }
  .avatar-modal-box {
    background: var(--dark2);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: var(--radius);
    padding: 24px;
    max-width: 340px;
    width: 90%;
    box-shadow: var(--shadow-lg);
    transform: translateY(8px);
    transition: transform 0.2s;
  }
  .avatar-modal-overlay.open .avatar-modal-box { transform: translateY(0); }
  .avatar-modal-title {
    font-family: var(--font-display);
    font-size: 18px;
    font-weight: 700;
    margin-bottom: 16px;
    color: var(--white);
  }
  .avatar-picker-grid {
    display: flex;
    flex-wrap: wrap;
    gap: 8px;
    justify-content: center;
  }
  .avatar-option {
    width: 44px;
    height: 44px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-size: 24px;
    border-radius: 10px;
    border: 2px solid transparent;
    cursor: pointer;
    background: var(--dark3);
    transition: all 0.15s;
    user-select: none;
  }
  .avatar-option:hover { background: var(--dark); transform: scale(1.1); }
  .avatar-option.selected { border-color: var(--orange); background: rgba(52,145,136,0.12); transform: scale(1.1); }

  /* ===================== MODAL CONFIRM ===================== */
  .confirm-overlay {
    position: fixed;
    inset: 0;
    background: rgba(0,0,0,0.6);
    backdrop-filter: blur(6px);
    z-index: 2000;
    display: flex;
    align-items: center;
    justify-content: center;
    opacity: 0;
    pointer-events: none;
    transition: opacity 0.2s;
  }
  .confirm-overlay.open {
    opacity: 1;
    pointer-events: all;
  }
  .confirm-box {
    background: var(--dark2);
    border: 1px solid rgba(255,255,255,0.08);
    border-radius: var(--radius);
    padding: 28px 28px 24px;
    max-width: 360px;
    width: 90%;
    box-shadow: var(--shadow-lg);
    transform: translateY(8px);
    transition: transform 0.2s;
  }
  .confirm-overlay.open .confirm-box {
    transform: translateY(0);
  }
  .confirm-icon {
    font-size: 28px;
    margin-bottom: 12px;
  }
  .confirm-title {
    font-family: var(--font-display);
    font-size: 20px;
    font-weight: 700;
    color: var(--white);
    margin-bottom: 8px;
  }
  .confirm-text {
    font-size: 14px;
    color: var(--grey2);
    line-height: 1.5;
    margin-bottom: 24px;
  }
  .confirm-btns {
    display: flex;
    gap: 10px;
    justify-content: flex-end;
  }

  /* ===================== AUTH TABS ===================== */
  .auth-tabs {
    display: flex;
    gap: 0;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    margin-bottom: 24px;
  }
  .auth-tab {
    flex: 1;
    background: none;
    border: none;
    padding: 12px 16px;
    font-family: var(--font-body);
    font-size: 14px;
    font-weight: 500;
    color: var(--grey);
    cursor: pointer;
    border-bottom: 2px solid transparent;
    transition: color 0.2s, border-color 0.2s;
    margin-bottom: -1px;
  }
  .auth-tab.active {
    color: var(--white);
    border-bottom-color: var(--orange);
  }
  .auth-tab:hover:not(.active) {
    color: var(--grey2);
  }
  .login-separator {
    display: flex;
    align-items: center;
    gap: 12px;
    margin: 16px 0;
    color: var(--grey);
    font-size: 12px;
  }
  .login-separator::before, .login-separator::after {
    content: '';
    flex: 1;
    height: 1px;
    background: rgba(255,255,255,0.08);
  }
  #loginError {
    background: rgba(52,145,136,0.12);
    border: 1px solid rgba(52,145,136,0.3);
    border-radius: var(--radius-sm);
    padding: 10px 14px;
    font-size: 13px;
    color: #FF7A7A;
    margin-bottom: 12px;
    display: none;
  }

  /* ===================== EVENT ACTION BUTTONS ===================== */
  .event-item-footer {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-top: 12px;
    padding-top: 10px;
    border-top: 1px solid rgba(255,255,255,0.06);
    gap: 8px;
  }
  .event-participant-count {
    font-size: 12px;
    color: var(--grey);
    display: flex;
    align-items: center;
    gap: 4px;
  }
  .btn-join-event {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 7px 14px;
    border-radius: var(--radius-sm);
    font-size: 13px;
    font-family: var(--font-body);
    font-weight: 500;
    cursor: pointer;
    transition: all 0.18s;
    border: 1.5px solid var(--orange);
    background: transparent;
    color: var(--orange);
  }
  .btn-join-event:hover:not(:disabled) {
    background: var(--orange);
    color: #fff;
  }
  .btn-join-event:disabled {
    opacity: 0.45;
    cursor: not-allowed;
    border-color: var(--grey);
    color: var(--grey);
  }
  .btn-leave-event {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 7px 14px;
    border-radius: var(--radius-sm);
    font-size: 13px;
    font-family: var(--font-body);
    font-weight: 500;
    cursor: pointer;
    transition: all 0.18s;
    border: 1.5px solid rgba(255,255,255,0.12);
    background: transparent;
    color: var(--grey2);
  }
  .btn-leave-event:hover {
    border-color: rgba(255,255,255,0.2);
    color: var(--white);
  }
  .event-actions {
    display: flex;
    align-items: center;
    gap: 8px;
    margin-left: auto;
  }
  .creator-badge {
    font-size: 11px;
    font-weight: 600;
    padding: 3px 8px;
    border-radius: 20px;
    background: rgba(52,145,136,0.12);
    color: var(--orange);
    border: 1px solid rgba(52,145,136,0.2);
    letter-spacing: 0.02em;
  }
  .btn-delete-event {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    width: 30px;
    height: 30px;
    border-radius: 8px;
    border: 1.5px solid rgba(52,145,136,0.25);
    background: transparent;
    color: var(--orange);
    font-size: 13px;
    cursor: pointer;
    transition: all 0.18s;
    opacity: 0.6;
  }
  .btn-delete-event:hover {
    background: rgba(52,145,136,0.15);
    opacity: 1;
  }

  /* ---- Profile tabs ---- */
  .profile-tabs {
    display: flex;
    gap: 8px;
    margin: 28px 0 0;
    border-bottom: 1px solid rgba(255,255,255,0.08);
    padding-bottom: 0;
  }
  .profile-tab {
    background: none;
    border: none;
    border-bottom: 2px solid transparent;
    color: var(--grey);
    font-family: var(--font-body);
    font-size: 13px;
    font-weight: 600;
    padding: 10px 16px;
    cursor: pointer;
    transition: all 0.2s;
    display: flex;
    align-items: center;
    gap: 7px;
    margin-bottom: -1px;
  }
  .profile-tab:hover { color: var(--white); }
  .profile-tab.active { color: var(--orange); border-bottom-color: var(--orange); }
  .profile-tab-content { display: none; padding-top: 20px; }
  .profile-tab-content.active { display: block; }

  /* ---- Inscriptions list ---- */
  .inscription-item {
    display: flex;
    align-items: center;
    gap: 14px;
    padding: 14px 0;
    border-bottom: 1px solid rgba(255,255,255,0.06);
  }
  .inscription-item:last-child { border-bottom: none; }
  .inscription-date-block {
    min-width: 44px;
    text-align: center;
    background: var(--dark3);
    border-radius: 10px;
    padding: 8px 6px;
    flex-shrink: 0;
  }
  .inscription-date-day {
    font-family: var(--font-display);
    font-size: 22px;
    font-weight: 900;
    color: var(--orange);
    line-height: 1;
  }
  .inscription-date-month {
    font-size: 10px;
    text-transform: uppercase;
    letter-spacing: 0.5px;
    color: var(--grey);
  }
  .inscription-info { flex: 1; min-width: 0; }
  .inscription-titre {
    font-weight: 600;
    font-size: 14px;
    white-space: nowrap;
    overflow: hidden;
    text-overflow: ellipsis;
  }
  .inscription-meta {
    font-size: 12px;
    color: var(--grey);
    margin-top: 3px;
  }
  .inscription-sport {
    font-size: 11px;
    background: rgba(52,145,136,0.1);
    border: 1px solid rgba(52,145,136,0.2);
    color: var(--orange);
    border-radius: 50px;
    padding: 2px 10px;
    font-weight: 700;
    flex-shrink: 0;
  }

  /* ---- Reviews ---- */
  .avis-item {
    background: var(--dark3);
    border-radius: 12px;
    padding: 14px 16px;
    margin-bottom: 12px;
  }
  .avis-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
    margin-bottom: 8px;
  }
  .avis-stars { color: var(--gold); font-size: 14px; letter-spacing: 1px; }
  .avis-reviewer { font-size: 12px; color: var(--grey); }
  .avis-comment { font-size: 13px; color: var(--grey2); line-height: 1.5; }

  /* Star picker */
  .star-picker { display: flex; gap: 4px; margin-bottom: 4px; }
  .star-btn {
    background: none;
    border: none;
    font-size: 28px;
    color: rgba(255,255,255,0.15);
    cursor: pointer;
    transition: color 0.15s, transform 0.1s;
    padding: 0 2px;
    line-height: 1;
  }
  .star-btn:hover, .star-btn.active { color: var(--gold); transform: scale(1.15); }

  /* Repeat event button */
  .btn-repeat-event {
    display: inline-flex;
    align-items: center;
    gap: 6px;
    padding: 6px 14px;
    border-radius: 50px;
    border: 1.5px solid rgba(255,200,0,0.3);
    background: rgba(255,200,0,0.07);
    color: var(--gold);
    font-size: 12px;
    font-weight: 600;
    font-family: var(--font-body);
    cursor: pointer;
    transition: all 0.18s;
  }
  .btn-repeat-event:hover {
    background: rgba(255,200,0,0.15);
    border-color: rgba(255,200,0,0.5);
  }

  /* Past event card slightly dimmed */
  .event-item-past {
    opacity: 0.78;
  }
  .event-item-past:hover {
    opacity: 1;
  }

  /* ===================== PASTEL SECTIONS ===================== */
  .steps-section { background: #FFF5EC; }
  .ranks-section { background: #EDF6FB; }
  .points-section { background: #FFF5EC; }
  .safety-section { background: #F0F8EE !important; }
  footer { background: #EDF6FB !important; border-top: 1px solid rgba(61,181,216,0.15) !important; }
</style>
</head>
<body>

<!-- ===================== NAV ===================== -->
<nav id="mainNav">
  <a href="#" class="logo" onclick="event.preventDefault();showView('home')">
    <img src="logo.png" alt="+1life" class="logo-img">
  </a>
  <ul class="nav-links">
    <li><a href="#explorer" onclick="event.preventDefault();showExplorer()">Voir événements</a></li>
    <li><a href="#comment" onclick="event.preventDefault();showView('home');setTimeout(()=>document.getElementById('comment')?.scrollIntoView({behavior:'smooth'}),50)">Comment ça marche</a></li>
    <li id="navMesEvents" style="display:none;"><a href="#mes-events" class="nav-mes-events" onclick="event.preventDefault();showMesEvents()"><i class="fa-solid fa-star" style="font-size:11px;"></i> Mes events</a></li>
  </ul>
  <div id="navLoggedOut" class="nav-cta">
    <button onclick="openAuthModal('connexion')" class="btn btn-primary" style="padding:10px 22px;font-size:13px;gap:8px;">
      <i class="fa-solid fa-right-to-bracket"></i> Connexion
    </button>
  </div>
  <div id="navLoggedIn" class="nav-cta" style="display:none;align-items:center;gap:8px;">
    <button onclick="openModal('modalEvent')" class="nav-create-btn">
      <i class="fa-solid fa-plus"></i> Créer
    </button>
    <button onclick="showProfile()" class="nav-profile-pill">
      <img id="navAvatar" src="" width="28" height="28" alt="">
      <span class="nav-avatar-initial" id="navAvatarInitial">?</span>
      <span id="navPrenom"></span>
      <i class="fa-solid fa-chevron-down" style="font-size:10px;opacity:0.45;margin-left:2px;"></i>
    </button>
  </div>
  <button class="hamburger" id="hamburger" aria-label="Menu">
    <span></span><span></span><span></span>
  </button>
</nav>

<!-- Mobile Menu -->
<div class="mobile-menu" id="mobileMenu">
  <button class="close-menu" id="closeMenu"><i class="fa-solid fa-xmark"></i></button>
  <a href="#explorer" class="mobile-link" onclick="mobileMenu.classList.remove('open');document.body.style.overflow='';showExplorer()">Voir événements</a>
  <a href="#comment" class="mobile-link" onclick="mobileMenu.classList.remove('open');document.body.style.overflow='';showView('home');setTimeout(()=>document.getElementById('comment')?.scrollIntoView({behavior:'smooth'}),50)">Comment ça marche</a>
  <a href="#mes-events" class="mobile-link" id="mobileMesEvents" style="display:none;" onclick="mobileMenu.classList.remove('open');document.body.style.overflow='';showMesEvents()">⭐ Mes events</a>
  <button onclick="tryCreateEvent()" class="btn btn-primary btn-large" style="margin-top:16px;"><i class="fa-solid fa-plus"></i> Créer un événement</button>
</div>

<!-- ===================== VIEW HOME ===================== -->
<div id="view-home" class="view active">

<!-- ===================== HERO ===================== -->
<section class="hero" id="hero">
  <div class="hero-mosaic">
    <div class="hero-mosaic-photo" style="background-image:url('mosaique/width_1280.jfif')"></div>
    <div class="hero-mosaic-photo" style="background-image:url('mosaique/width_1600.jfif')"></div>
    <div class="hero-mosaic-photo" style="background-image:url('mosaique/width_660.jfif')"></div>
    <div class="hero-mosaic-photo" style="background-image:url('mosaique/width_660_1.jfif')"></div>
    <div class="hero-mosaic-photo" style="background-image:url('mosaique/width_800.jfif')"></div>
    <div class="hero-mosaic-photo" style="background-image:url('mosaique/width_948.jfif')"></div>
  </div>
  <div class="hero-bg"></div>
  <div class="hero-content">
<h1>Ton lieu.<br><span class="accent">Ton heure.</span><br>Ton rythme.</h1>
    <p class="hero-sub">Sportif, en rééducation, senior ou simplement isolé — crée ou rejoins une activité près de chez toi. Gratuit, sans engagement, ouvert à tous.</p>
    <div id="heroCtaLoggedOut" class="hero-ctas">
      <button onclick="tryCreateEvent()" class="btn btn-primary btn-large"><i class="fa-solid fa-plus"></i> Je crée un événement</button>
      <button onclick="openAuthModal('connexion')" class="btn btn-outline btn-large"><i class="fa-solid fa-right-to-bracket"></i> Connexion</button>
    </div>
    <div id="heroCtaLoggedIn" class="hero-ctas" style="display:none;">
      <button onclick="openModal('modalEvent')" class="btn btn-primary btn-large"><i class="fa-solid fa-plus"></i> Je crée un événement</button>
      <button onclick="showProfile()" class="btn btn-outline btn-large"><i class="fa-solid fa-user"></i> Mon profil</button>
    </div>
  </div>

  <!-- Carte event flottante (desktop) -->
  <div class="hero-visual">
    <div class="event-card-preview fade-up">
      <div class="ecp-tag"><i class="fa-solid fa-person-walking"></i> Marche</div>
      <div class="ecp-title">Balade matinale — Parc</div>
      <div class="ecp-info">
        <span><i class="fa-regular fa-clock"></i> Demain 9h00</span>
        <span><i class="fa-solid fa-heart"></i> Tous niveaux</span>
      </div>
      <div class="ecp-avatars">
        <div class="ecp-avatar" style="font-size:14px;">🧑</div>
        <div class="ecp-avatar" style="font-size:14px;">👩</div>
        <div class="ecp-avatar" style="font-size:14px;">🧔</div>
        <span class="ecp-count">+4 participants</span>
      </div>
    </div>
    <div class="event-card-preview card2 fade-up">
      <div class="ecp-tag"><i class="fa-solid fa-spa"></i> Yoga doux</div>
      <div class="ecp-title">Séance relaxation — Salle polyvalente</div>
      <div class="ecp-info">
        <span><i class="fa-regular fa-clock"></i> Sam 10h00</span>
        <span><i class="fa-solid fa-heart"></i> Tous niveaux</span>
      </div>
      <div class="ecp-avatars">
        <div class="ecp-avatar" style="font-size:14px;">👵</div>
        <div class="ecp-avatar" style="font-size:14px;">🧘</div>
        <span class="ecp-count">+6 participants</span>
      </div>
    </div>
  </div>
</section>

<!-- ===================== SPORTS MARQUEE ===================== -->
<div class="sports-strip-outer">
  <div class="sports-strip">
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?w=300&h=200&fit=crop&auto=format&q=70')"><span>Marche</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1551632811-561732d1e306?w=300&h=200&fit=crop&auto=format&q=70')"><span>Randonnée</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=300&h=200&fit=crop&auto=format&q=70')"><span>Longe Côte</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1556817411-31ae72fa3ea0?w=300&h=200&fit=crop&auto=format&q=70')"><span>Pétanque</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1575052814086-f385e2e2ad1b?w=300&h=200&fit=crop&auto=format&q=70')"><span>Yoga</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1545389336-cf090694435e?w=300&h=200&fit=crop&auto=format&q=70')"><span>Qigong</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1530549387789-4c1017266635?w=300&h=200&fit=crop&auto=format&q=70')"><span>Natation</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=300&h=200&fit=crop&auto=format&q=70')"><span>Vélo</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1552674605-db6ffd4facb5?w=300&h=200&fit=crop&auto=format&q=70')"><span>Running</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1575361204480-aadea25e6e68?w=300&h=200&fit=crop&auto=format&q=70')"><span>Football</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1542144612-1b1e99c5c4c5?w=300&h=200&fit=crop&auto=format&q=70')"><span>Tennis</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1626224583764-f87db24ac4ea?w=300&h=200&fit=crop&auto=format&q=70')"><span>Badminton</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1522163182402-834f871fd851?w=300&h=200&fit=crop&auto=format&q=70')"><span>Escalade</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=300&h=200&fit=crop&auto=format&q=70')"><span>Gym</span></div>
    <!-- répétition pour boucle infinie -->
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?w=300&h=200&fit=crop&auto=format&q=70')"><span>Marche</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1551632811-561732d1e306?w=300&h=200&fit=crop&auto=format&q=70')"><span>Randonnée</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=300&h=200&fit=crop&auto=format&q=70')"><span>Longe Côte</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1556817411-31ae72fa3ea0?w=300&h=200&fit=crop&auto=format&q=70')"><span>Pétanque</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1575052814086-f385e2e2ad1b?w=300&h=200&fit=crop&auto=format&q=70')"><span>Yoga</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1545389336-cf090694435e?w=300&h=200&fit=crop&auto=format&q=70')"><span>Qigong</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1530549387789-4c1017266635?w=300&h=200&fit=crop&auto=format&q=70')"><span>Natation</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=300&h=200&fit=crop&auto=format&q=70')"><span>Vélo</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1552674605-db6ffd4facb5?w=300&h=200&fit=crop&auto=format&q=70')"><span>Running</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1575361204480-aadea25e6e68?w=300&h=200&fit=crop&auto=format&q=70')"><span>Football</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1542144612-1b1e99c5c4c5?w=300&h=200&fit=crop&auto=format&q=70')"><span>Tennis</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1626224583764-f87db24ac4ea?w=300&h=200&fit=crop&auto=format&q=70')"><span>Badminton</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1522163182402-834f871fd851?w=300&h=200&fit=crop&auto=format&q=70')"><span>Escalade</span></div>
    <div class="sport-pill" style="background-image:url('https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=300&h=200&fit=crop&auto=format&q=70')"><span>Gym</span></div>
  </div>
</div>

<!-- ===================== HOW IT WORKS ===================== -->
<section class="how-section" id="comment">
  <div class="section-label">Le principe</div>
  <h2>Comment ça <span class="accent">marche</span></h2>
  <p class="section-sub">Trois étapes simples pour bouger ensemble — sportif, senior, en rééducation ou simplement en quête de lien social.</p>

  <div class="steps-grid">
    <div class="step fade-up">
      <div class="step-icon"><i class="fa-brands fa-google"></i></div>
      <h3>Connecte-toi</h3>
      <p>Crée ton compte en un clic avec Google. Ton profil est prêt en quelques secondes — aucune carte bancaire, aucun engagement.</p>
    </div>
    <div class="step fade-up">
      <div class="step-icon"><i class="fa-solid fa-location-dot"></i></div>
      <h3>Rejoins ou crée</h3>
      <p>Trouve une activité près de chez toi — marche, yoga, pétanque, rééducation douce — ou crée la tienne en 2 minutes, au lieu et à l'heure que tu souhaites.</p>
    </div>
    <div class="step fade-up">
      <div class="step-icon"><i class="fa-solid fa-heart"></i></div>
      <h3>Bouge & partage</h3>
      <p>Brise l'isolement, trouve de la motivation, partage le plaisir de bouger. Gagne des points à chaque participation — jusqu'au rang <strong style="color:var(--orange)">+1Life</strong>.</p>
    </div>
  </div>
</section>

<!-- ===================== EVENTS PREVIEW ===================== -->
<section class="events-section">
  <div class="section-label">En Bretagne</div>
  <h2>Ce qui se passe <span class="accent">près de toi</span></h2>
  <p class="section-sub">Les derniers événements publiés par la communauté — crée le tien en 2 minutes.</p>

  <div class="events-grid" id="homeEventsList">
    <div class="empty-state" style="grid-column:1/-1;padding:40px 20px;">
      <span class="empty-icon" style="font-size:32px;opacity:0.4">⏳</span>
      <p style="margin-bottom:0">Chargement…</p>
    </div>
  </div>

  <div style="text-align:center;margin-top:28px;">
    <button onclick="showExplorer()" class="btn btn-outline">Voir tous les événements <i class="fa-solid fa-arrow-right" style="margin-left:4px"></i></button>
  </div>
</section>

<!-- sections removed for launch -->
<div style="display:none"><div class="features-grid">
    <div class="feature-card span2 fade-up">
      <div class="feature-icon"><i class="fa-solid fa-images"></i></div>
      <h3>Carrousel d'activités intelligent</h3>
      <p>Sélectionne ton activité depuis un carrousel d'images prédéfinies avec niveau visuellement associé à chaque sport. Plus d'ambiguïté, plus de frustration due aux niveaux — l'image parle d'elle-même. Football débutant ≠ Football expert : chaque visuel est distinct.</p>
      <div style="display:flex; gap:10px; margin-top:20px; flex-wrap:wrap;">
        <div style="padding:8px 16px; background:rgba(52,145,136,0.08); border:1px solid rgba(52,145,136,0.15); border-radius:8px; font-size:13px; color:var(--grey2);">⚽ Débutant</div>
        <div style="padding:8px 16px; background:rgba(52,145,136,0.08); border:1px solid rgba(52,145,136,0.15); border-radius:8px; font-size:13px; color:var(--grey2);">⚽ Intermédiaire</div>
        <div style="padding:8px 16px; background:rgba(52,145,136,0.08); border:1px solid rgba(52,145,136,0.15); border-radius:8px; font-size:13px; color:var(--grey2);">⚽ Confirmé</div>
        <div style="padding:8px 16px; background:rgba(52,145,136,0.08); border:1px solid rgba(52,145,136,0.15); border-radius:8px; font-size:13px; color:var(--grey2);">🏃 Débutant</div>
        <div style="padding:8px 16px; background:rgba(52,145,136,0.08); border:1px solid rgba(52,145,136,0.15); border-radius:8px; font-size:13px; color:var(--grey2);">🚴 Intermédiaire</div>
        <div style="padding:8px 16px; background:rgba(52,145,136,0.12); border:1px solid rgba(52,145,136,0.3); border-radius:8px; font-size:13px; color:var(--orange);">+ 40 visuels</div>
      </div>
    </div>
    <div class="feature-card fade-up">
      <div class="feature-icon"><i class="fa-solid fa-map-location-dot"></i></div>
      <h3>Carte régionale</h3>
      <p>Sélectionne ta région sur la carte de France interactive pour accéder aux événements proches de toi. Rayon 10 km gratuit, illimité en abonné.</p>
    </div>
    <div class="feature-card fade-up">
      <div class="feature-icon"><i class="fa-solid fa-car-side"></i></div>
      <h3>Covoiturage intégré</h3>
      <p>Propose le covoiturage directement sur ton annonce. Les participants peuvent interagir pour partager leurs itinéraires. Pratique et éco-responsable.</p>
    </div>
    <div class="feature-card fade-up">
      <div class="feature-icon"><i class="fa-solid fa-camera"></i></div>
      <h3>Validation sociale</h3>
      <p>Valide chaque événement avec une photo de groupe. Une preuve sociale puissante pour les autres membres — et le déclencheur des points de participation.</p>
    </div>
    <div class="feature-card fade-up">
      <div class="feature-icon"><i class="fa-solid fa-route"></i></div>
      <h3>Randos partagées</h3>
      <p>Enregistre tes itinéraires de randonnée depuis ton téléphone et partage-les avec la communauté sur la carte. Découvre les parcours des autres membres.</p>
    </div>
    <div class="feature-card fade-up">
      <div class="feature-icon"><i class="fa-solid fa-user-group"></i></div>
      <h3>Espace profil complet</h3>
      <p>Historique des participations et créations, avis des membres, avancement dans les récompenses, barre de progression et code parrainage personnel.</p>
    </div>
  </div>
</section>

<!-- ===================== USER TYPES ===================== -->
<section class="users-section">
  <div class="section-label">Pour tout le monde</div>
  <h2>Un profil adapté à <span class="accent">chaque besoin</span></h2>
  <p class="section-sub">Particulier, association ou professionnel — +1Life s'adapte à ton usage.</p>

  <div class="users-grid">
    <div class="user-card particulier fade-up">
      <div class="user-tag"><i class="fa-solid fa-person-running"></i> Particulier</div>
      <h3>Joue quand tu veux</h3>
      <p>Tu veux jouer quand tu veux, où tu veux, avec qui tu veux. Sans abonnement en club, sans contrainte d'horaires imposés. La liberté totale.</p>
      <ul class="user-features">
        <li>Liberté totale de création</li>
        <li>Rayon 10km gratuit ou illimité (abonné)</li>
        <li>Points de participation à chaque event</li>
        <li>Profil et historique personnel</li>
        <li>Code parrainage exclusif</li>
      </ul>
    </div>
    <div class="user-card association fade-up">
      <div class="user-tag"><i class="fa-solid fa-people-group"></i> Association</div>
      <h3>Touche plus de monde</h3>
      <p>Mets en avant tes créneaux, touche de nouveaux adhérents et propose des events ponctuels hors des horaires habituels. Visibilité maximale.</p>
      <ul class="user-features">
        <li>Page association publique dédiée</li>
        <li>Logo + visuel personnalisé dans le carrousel</li>
        <li>Événements payants possibles</li>
        <li>Cadre de couleur distinctif dans les annonces</li>
        <li>Tout le pack Abonné inclus</li>
      </ul>
    </div>
    <div class="user-card pro fade-up">
      <div class="user-tag"><i class="fa-solid fa-briefcase"></i> Professionnel</div>
      <h3>Monétise ton expertise</h3>
      <p>Coach, salle de sport, moniteur... Exposez vos créneaux à une communauté de passionnés prête à pratiquer. Votre vitrine sport en ligne.</p>
      <ul class="user-features">
        <li>Page pro avec numéro SIRET</li>
        <li>Identité visuelle propre dans le carrousel</li>
        <li>Coaching et sessions monétisables</li>
        <li>Annonces prioritaires</li>
        <li>Tout le pack Association inclus</li>
      </ul>
    </div>
  </div>
</section>

<!-- ===================== PRICING ===================== -->
<section class="pricing-section" id="tarifs">
  <div class="section-label">Tarifs</div>
  <h2>Simple, <span class="accent">transparent</span></h2>
  <p class="section-sub">Commence gratuitement. Passe à l'abonné quand tu veux aller plus loin.</p>

  <div class="pricing-grid">
    <div class="pricing-card fade-up">
      <div class="plan-name">Gratuit</div>
      <p style="font-size:13px;color:var(--grey);margin-top:6px;">Pour commencer à bouger</p>
      <div class="plan-price"><span class="currency">€</span>0<span class="period">/mois</span></div>
      <div class="plan-divider"></div>
      <ul class="plan-features">
        <li><i class="fa-solid fa-check check"></i> Carte de France — rayon 10 km</li>
        <li><i class="fa-solid fa-check check"></i> Création d'events (10 km)</li>
        <li><i class="fa-solid fa-check check"></i> Points classiques</li>
        <li><i class="fa-solid fa-check check"></i> Espace profil perso</li>
        <li><i class="fa-solid fa-check check"></i> Boutique points</li>
        <li class="dimmed"><i class="fa-solid fa-xmark cross"></i> Découverte randos</li>
        <li class="dimmed"><i class="fa-solid fa-xmark cross"></i> Voir profils membres</li>
        <li class="dimmed"><i class="fa-solid fa-xmark cross"></i> Badges & cadres exclusifs</li>
        <li class="dimmed"><i class="fa-solid fa-xmark cross"></i> Points boostés</li>
      </ul>
      <button onclick="openAuthModal('inscription')" class="btn btn-outline" style="width:100%;justify-content:center;">Commencer</button>
    </div>

    <div class="pricing-card popular fade-up">
      <div class="popular-badge">⚡ Populaire</div>
      <div class="plan-name">Abonné</div>
      <p style="font-size:13px;color:var(--grey);margin-top:6px;">Pour aller plus loin</p>
      <div class="plan-price tbd">Bientôt disponible</div>
      <div style="font-size:12px;color:var(--grey);margin-top:4px;">Prix de lancement : ~4,99 €/mois</div>
      <div class="plan-divider"></div>
      <ul class="plan-features">
        <li><i class="fa-solid fa-check check"></i> Carte de France — accès complet</li>
        <li><i class="fa-solid fa-check check"></i> Création d'events illimitée</li>
        <li><i class="fa-solid fa-check check"></i> <strong style="color:var(--orange)">Points boostés x3</strong></li>
        <li><i class="fa-solid fa-check check"></i> Découverte randos</li>
        <li><i class="fa-solid fa-check check"></i> Voir profils membres</li>
        <li><i class="fa-solid fa-check check"></i> Badges & cadres exclusifs</li>
        <li><i class="fa-solid fa-check check"></i> Modification profil (badge, cadre)</li>
        <li><i class="fa-solid fa-check check"></i> Boutique points boostés</li>
        <li><i class="fa-solid fa-check check"></i> Parrainage 15 pts (vs 5 pts)</li>
      </ul>
      <button onclick="openAuthModal('inscription')" class="btn btn-primary" style="width:100%;justify-content:center;">Être notifié</button>
    </div>

    <div class="pricing-card fade-up">
      <div class="plan-name">Association</div>
      <p style="font-size:13px;color:var(--grey);margin-top:6px;">Pour les clubs et associations</p>
      <div class="plan-price tbd">Sur devis</div>
      <div style="font-size:12px;color:var(--grey);margin-top:4px;">Estimation : ~9,99 €/mois</div>
      <div class="plan-divider"></div>
      <ul class="plan-features">
        <li><i class="fa-solid fa-check check"></i> Tout le pack Abonné</li>
        <li><i class="fa-solid fa-check check"></i> Page association publique</li>
        <li><i class="fa-solid fa-check check"></i> Logo dans le carrousel</li>
        <li><i class="fa-solid fa-check check"></i> Visuel carrousel personnalisé</li>
        <li><i class="fa-solid fa-check check"></i> Events payants activés</li>
        <li><i class="fa-solid fa-check check"></i> Cadre distinctif sur annonces</li>
      </ul>
      <a href="#rejoindre" class="btn btn-outline" style="width:100%;justify-content:center;border-color:rgba(59,130,246,0.4);color:#3B82F6">Nous contacter</a>
    </div>

    <div class="pricing-card fade-up">
      <div class="plan-name">Pro</div>
      <p style="font-size:13px;color:var(--grey);margin-top:6px;">Pour les professionnels du sport</p>
      <div class="plan-price tbd">Sur devis</div>
      <div style="font-size:12px;color:var(--grey);margin-top:4px;">Estimation : ~14,99 €/mois</div>
      <div class="plan-divider"></div>
      <ul class="plan-features">
        <li><i class="fa-solid fa-check check"></i> Tout le pack Association</li>
        <li><i class="fa-solid fa-check check"></i> Page pro avec SIRET</li>
        <li><i class="fa-solid fa-check check"></i> Sessions coaching monétisables</li>
        <li><i class="fa-solid fa-check check"></i> Identité visuelle propre</li>
        <li><i class="fa-solid fa-check check"></i> Annonces prioritaires</li>
        <li><i class="fa-solid fa-check check"></i> Support dédié</li>
      </ul>
      <a href="#rejoindre" class="btn btn-outline" style="width:100%;justify-content:center;border-color:rgba(255,107,53,0.4);color:#FF6B35">Nous contacter</a>
    </div>
  </div>
</section>

<!-- ===================== GAMIFICATION ===================== -->
<section class="gamif-section">
  <div class="section-label">Récompenses</div>
  <h2>Monte en <span class="accent">rang</span></h2>
  <p class="section-sub">Chaque event participé ou créé te rapproche du rang ultime. La basket +1Life n'attend que toi.</p>

  <div class="ranks-track" id="ranksTrack">
    <div class="rank-item" data-rank="paper">
      <div class="rank-shoe paper">🩴</div>
      <div class="rank-name">Sandale<br><small style="color:rgba(17,17,17,0.3);font-size:10px">Départ</small></div>
    </div>
    <div class="rank-item" data-rank="wood">
      <div class="rank-shoe wood">🩴</div>
      <div class="rank-name">Claquette<br><small style="color:rgba(17,17,17,0.3);font-size:10px">10 pts</small></div>
    </div>
    <div class="rank-item" data-rank="bronze">
      <div class="rank-shoe bronze">👟</div>
      <div class="rank-name">Tongue<br><small style="color:rgba(17,17,17,0.3);font-size:10px">30 pts</small></div>
    </div>
    <div class="rank-item" data-rank="iron">
      <div class="rank-shoe iron">🥿</div>
      <div class="rank-name">Pantoufles<br><small style="color:rgba(17,17,17,0.3);font-size:10px">60 pts</small></div>
    </div>
    <div class="rank-item" data-rank="silver">
      <div class="rank-shoe silver">🐊</div>
      <div class="rank-name">Crocs<br><small style="color:rgba(17,17,17,0.3);font-size:10px">100 pts</small></div>
    </div>
    <div class="rank-item" data-rank="gold">
      <div class="rank-shoe gold">🪵</div>
      <div class="rank-name">Sabot<br><small style="color:rgba(17,17,17,0.3);font-size:10px">160 pts</small></div>
    </div>
    <div class="rank-item" data-rank="platinum">
      <div class="rank-shoe platinum">👞</div>
      <div class="rank-name">Chaussures<br><small style="color:rgba(17,17,17,0.3);font-size:10px">240 pts</small></div>
    </div>
    <div class="rank-item" data-rank="diamond">
      <div class="rank-shoe diamond">👟</div>
      <div class="rank-name">Basket<br><small style="color:rgba(17,17,17,0.3);font-size:10px">360 pts</small></div>
    </div>
    <div class="rank-item active" data-rank="plus1">
      <div class="rank-shoe plus1">❤️</div>
      <div class="rank-name" style="color:var(--orange)">+1Life<br><small style="color:var(--orange);font-size:10px">Rang ultime · 520 pts</small></div>
    </div>
  </div>

  <div class="points-grid">
    <div class="points-card">
      <div class="pts-value">1<span class="pts-sub"> pt</span></div>
      <h4>Participation</h4>
      <p>Chaque event auquel tu participes te rapporte 1 point. <strong style="color:var(--orange)">3 points pour les abonnés.</strong></p>
    </div>
    <div class="points-card">
      <div class="pts-value">3<span class="pts-sub"> pts</span></div>
      <h4>Création</h4>
      <p>Chaque event que tu crées et valides te rapporte 3 points. <strong style="color:var(--orange)">6 points pour les abonnés.</strong></p>
    </div>
    <div class="points-card">
      <div class="pts-value">5<span class="pts-sub"> pts</span></div>
      <h4>Parrainage</h4>
      <p>Partage ton code et gagne 5 points quand ton filleul participe. <strong style="color:var(--orange)">15 points pour les abonnés.</strong></p>
    </div>
  </div>

  <div style="margin-top:32px; padding:28px 32px; background:var(--dark2); border:1px solid rgba(52,145,136,0.12); border-radius:var(--radius); display:flex; align-items:center; gap:24px; flex-wrap:wrap;">
    <i class="fa-solid fa-shop" style="font-size:32px;color:var(--orange);flex-shrink:0;"></i>
    <div>
      <h4 style="font-family:var(--font-display);font-size:20px;font-weight:800;text-transform:uppercase;margin-bottom:6px;">Espace Boutique</h4>
      <p style="font-size:14px;color:var(--grey);line-height:1.6;">Utilise tes points dans la boutique +1Life pour commander du textile de la marque ou des bons de réduction chez nos futurs partenaires sportifs.</p>
    </div>
  </div>
</section>

<!-- ===================== SAFETY ===================== -->
<section class="safety-section">
  <div class="safety-grid">
    <div class="safety-left">
      <div class="section-label">Sécurité</div>
      <h2>Une communauté <span class="accent">safe</span></h2>
      <p class="section-sub">+1Life est uniquement orienté sport. Pas de dérive, pas de contenu hors-sujet — une modération pensée pour protéger chaque membre.</p>
      <div class="safety-items">
        <div class="safety-item fade-up">
          <div class="safety-num">01</div>
          <div class="safety-text">
            <h4>Signalement de membres</h4>
            <p>Après chaque event, consulte la liste des participants et signale tout comportement inapproprié en un clic.</p>
          </div>
        </div>
        <div class="safety-item fade-up">
          <div class="safety-num">02</div>
          <div class="safety-text">
            <h4>Système d'alertes progressif</h4>
            <p>Un signalement = un message d'avertissement. Plusieurs signalements de membres différents = suspension automatique du compte.</p>
          </div>
        </div>
        <div class="safety-item fade-up">
          <div class="safety-num">03</div>
          <div class="safety-text">
            <h4>Validation par photo de groupe</h4>
            <p>La validation de fin d'event par photo prouve qui était vraiment présent. Les points ne sont crédités qu'après validation — zéro fraude.</p>
          </div>
        </div>
        <div class="safety-item fade-up">
          <div class="safety-num">04</div>
          <div class="safety-text">
            <h4>100% orienté sport</h4>
            <p>La plateforme est strictement dédiée à l'activité physique pour éviter les dérives observées chez la concurrence.</p>
          </div>
        </div>
      </div>
    </div>
    <div class="safety-right">
      <div class="safety-bigstat">
        <span class="big">100%</span>
        <p>Dédié au sport — rien d'autre</p>
      </div>
      <div class="safety-note">
        <i class="fa-solid fa-shield-halved"></i>
        <p>"Contrairement à d'autres plateformes, +1Life ne sera jamais un site de rencontre. Le sport est notre unique raison d'être."</p>
      </div>
      <div style="margin-top:20px; display:flex; flex-direction:column; gap:12px;">
        <div style="display:flex;align-items:center;gap:12px;padding:14px;background:rgba(52,145,136,0.04);border-radius:8px;border:1px solid rgba(52,145,136,0.08);">
          <i class="fa-solid fa-circle-check" style="color:var(--orange);font-size:16px;"></i>
          <span style="font-size:13px;color:var(--grey2);">Modération active des annonces</span>
        </div>
        <div style="display:flex;align-items:center;gap:12px;padding:14px;background:rgba(52,145,136,0.04);border-radius:8px;border:1px solid rgba(52,145,136,0.08);">
          <i class="fa-solid fa-circle-check" style="color:var(--orange);font-size:16px;"></i>
          <span style="font-size:13px;color:var(--grey2);">Commentaires, pas de tchat privé</span>
        </div>
        <div style="display:flex;align-items:center;gap:12px;padding:14px;background:rgba(52,145,136,0.04);border-radius:8px;border:1px solid rgba(52,145,136,0.08);">
          <i class="fa-solid fa-circle-check" style="color:var(--orange);font-size:16px;"></i>
          <span style="font-size:13px;color:var(--grey2);">Bannissement définitif si récidive</span>
        </div>
      </div>
    </div>
  </div>
</div><!-- end hidden sections -->

<!-- ===================== CTA ===================== -->
<section class="cta-section" id="rejoindre">
  <div class="cta-inner">
    <div class="section-label" style="justify-content:center;">Rejoins-nous</div>
    <h2>Prêt à <span class="accent">bouger ?</span></h2>
    <p>Rejoins la communauté sportive bretonne. Crée un compte en 10 secondes, ton premier event en 2 minutes.</p>
    <div id="ctaLoggedOut" class="cta-buttons">
      <button onclick="openAuthModal('connexion')" class="btn btn-primary btn-large"><i class="fa-solid fa-right-to-bracket"></i> Connexion</button>
      <button onclick="tryCreateEvent()" class="btn btn-outline btn-large"><i class="fa-solid fa-plus"></i> Créer un événement</button>
    </div>
    <div id="ctaLoggedIn" class="cta-buttons" style="display:none;">
      <button onclick="openModal('modalEvent')" class="btn btn-primary btn-large"><i class="fa-solid fa-plus"></i> Créer un événement</button>
      <button onclick="showProfile()" class="btn btn-outline btn-large"><i class="fa-solid fa-user"></i> Mon profil</button>
    </div>
    <p style="margin-top:24px;font-size:13px;color:var(--grey);">Gratuit pour commencer · Aucune carte de crédit requise · Sans engagement</p>
  </div>
</section>

</div> <!-- /view-home -->

<!-- ===================== VIEW PROFIL ===================== -->
<div id="view-profil" class="view">
  <div class="profile-view">
    <button class="profile-back" onclick="showView('home')">
      <i class="fa-solid fa-arrow-left"></i> Retour
    </button>

    <div class="profile-header">
      <div class="profile-avatar-wrap" id="profileAvatarWrap" onclick="openAvatarPicker()">
        <span id="profileAvatarEmoji">🏃</span>
        <div class="avatar-edit-overlay"><i class="fa-solid fa-pen"></i></div>
      </div>
      <div class="profile-name" id="profileName">—</div>
      <div class="profile-meta">
        <span id="profileType"></span>
        <span id="profileVille"></span>
      </div>
    </div>

    <div class="profile-stats">
      <div class="profile-stat">
        <span class="profile-stat-num" id="profileEvents">0</span>
        <span class="profile-stat-label">Events créés</span>
      </div>
      <div class="profile-stat">
        <span class="profile-stat-num" id="profilePoints">0</span>
        <span class="profile-stat-label">Points</span>
      </div>
      <div class="profile-stat">
        <span class="profile-stat-num" id="profileRankIcon">🩴</span>
        <span class="profile-stat-label" id="profileRankName">Sandalette</span>
      </div>
    </div>

    <!-- Rank progression -->
    <div class="rank-progress-block">
      <div class="rank-progress-header">
        <span class="rank-current-label">Progression</span>
        <span class="rank-next-label" id="rankNextLabel">—</span>
      </div>
      <div class="rank-bar-track">
        <div class="rank-bar-fill" id="rankBarFill" style="width:0%"></div>
      </div>
      <div class="rank-bar-labels">
        <span id="rankBarCurrent">0 pts</span>
        <span id="rankBarNext">—</span>
      </div>
      <div class="rank-ladder" id="rankLadder"></div>
    </div>

    <div class="profile-actions">
      <button onclick="openModal('modalEvent')" class="btn btn-primary btn-large">
        <i class="fa-solid fa-plus"></i> Créer un événement
      </button>
      <button onclick="openAuthModal('inscription')" class="btn btn-outline btn-large">
        <i class="fa-solid fa-pen"></i> Modifier mon profil
      </button>
      <button onclick="logoutUser()" style="margin-top:8px;background:none;border:none;font-size:13px;color:var(--grey);cursor:pointer;padding:8px 0;transition:color 0.2s;" onmouseover="this.style.color='var(--orange)'" onmouseout="this.style.color='var(--grey)'">
        <i class="fa-solid fa-right-from-bracket"></i> Se déconnecter
      </button>
    </div>

    <!-- Profile tabs -->
    <div class="profile-tabs">
      <button class="profile-tab active" data-tab="inscriptions" onclick="showProfileTab('inscriptions')">
        <i class="fa-solid fa-calendar-check"></i> Mes inscriptions
      </button>
      <button class="profile-tab" data-tab="avis" onclick="showProfileTab('avis')">
        <i class="fa-solid fa-star"></i> Avis reçus
      </button>
    </div>

    <!-- Tab: Mes inscriptions -->
    <div id="profileTabInscriptions" class="profile-tab-content active">
      <div id="inscriptionsList">
        <div class="empty-state" style="padding:24px 0"><span class="empty-icon" style="font-size:28px">📅</span><p>Chargement…</p></div>
      </div>
    </div>

    <!-- Tab: Avis reçus -->
    <div id="profileTabAvis" class="profile-tab-content">
      <div id="avisList">
        <div class="empty-state" style="padding:24px 0"><span class="empty-icon" style="font-size:28px">⭐</span><p>Chargement…</p></div>
      </div>
    </div>

  </div>
</div> <!-- /view-profil -->

<!-- ===================== VIEW EXPLORER ===================== -->
<div id="view-explorer" class="view">
  <div class="page-view">
    <button class="page-back" onclick="showView('home')">
      <i class="fa-solid fa-arrow-left"></i> Accueil
    </button>
    <h1 class="page-title">Événements</h1>
    <div class="filter-bar" id="explorerFilters">
      <button class="filter-btn active" data-filter="tous" onclick="filterExplorer('tous')">Tous</button>
      <button class="filter-btn" data-filter="Marche" onclick="filterExplorer('Marche')">🚶 Marche</button>
      <button class="filter-btn" data-filter="Randonnée" onclick="filterExplorer('Randonnée')">⛰️ Rando</button>
      <button class="filter-btn" data-filter="Pétanque" onclick="filterExplorer('Pétanque')">🎳 Pétanque</button>
      <button class="filter-btn" data-filter="Yoga" onclick="filterExplorer('Yoga')">🧘 Yoga</button>
      <button class="filter-btn" data-filter="Natation" onclick="filterExplorer('Natation')">🏊 Natation</button>
      <button class="filter-btn" data-filter="Vélo" onclick="filterExplorer('Vélo')">🚴 Vélo</button>
      <button class="filter-btn" data-filter="Running" onclick="filterExplorer('Running')">🏃 Running</button>
      <button class="filter-btn" data-filter="Football" onclick="filterExplorer('Football')">⚽ Football</button>
    </div>
    <div class="city-filter-row">
      <i class="fa-solid fa-location-dot"></i>
      <input type="text" id="cityFilterInput" class="city-filter-input" placeholder="Filtrer par ville…" oninput="filterByCity(this.value)">
      <button class="city-filter-clear" id="cityFilterClear" onclick="clearCityFilter()" style="display:none"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <div class="explorer-grid" id="explorerList">
      <div class="empty-state"><span class="empty-icon">🔍</span><p>Chargement…</p></div>
    </div>
  </div>
</div> <!-- /view-explorer -->

<!-- ===================== VIEW MES EVENTS ===================== -->
<div id="view-mes-events" class="view">
  <div class="page-view">
    <button class="page-back" onclick="showView('home')">
      <i class="fa-solid fa-arrow-left"></i> Accueil
    </button>
    <h1 class="page-title">Mes events</h1>
    <div class="mes-events-toolbar">
      <span class="mes-events-count" id="mesEventsCount"></span>
      <div class="mes-events-sort-wrap">
        <i class="fa-solid fa-arrow-up-wide-short" style="color:var(--grey);font-size:12px;"></i>
        <select id="mesEventsSortSelect" class="mes-events-sort" onchange="renderMesEvents()">
          <option value="date-asc">Date ↑</option>
          <option value="date-desc">Date ↓</option>
          <option value="sport">Par sport</option>
        </select>
      </div>
    </div>
    <div id="mesEventsList">
      <div class="empty-state"><span class="empty-icon">⏳</span><p>Chargement…</p></div>
    </div>
  </div>
</div> <!-- /view-mes-events -->

<!-- ===================== MODAL CREATEUR ===================== -->
<div class="modal-overlay" id="modalCreateur">
  <div class="modal-box" style="max-width:400px;">
    <div class="modal-header">
      <div class="modal-title">Profil du créateur</div>
      <button class="modal-close" onclick="closeModal('modalCreateur')"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <div class="modal-body" id="createurContent" style="text-align:center;padding:24px 24px 32px;">
      <div style="font-size:32px;opacity:0.4">⏳</div>
    </div>
  </div>
</div>

<!-- ===================== MODAL PARTICIPANTS ===================== -->
<div class="modal-overlay" id="modalParticipants">
  <div class="modal-box" style="max-width:400px;">
    <div class="modal-header">
      <div class="modal-title">Participants</div>
      <button class="modal-close" onclick="closeModal('modalParticipants')"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <div class="modal-body" id="participantsContent" style="padding:16px 24px 28px;">
      <div style="font-size:32px;opacity:0.4;text-align:center;padding:24px 0">⏳</div>
    </div>
  </div>
</div>

<!-- ===================== MODAL AVIS ===================== -->
<div class="modal-overlay" id="modalAvis">
  <div class="modal-box" style="max-width:420px;">
    <div class="modal-header">
      <div class="modal-title">Laisser un avis</div>
      <button class="modal-close" onclick="closeModal('modalAvis')"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <div class="modal-body" style="padding:20px 24px 28px;">
      <input type="hidden" id="avisReviewedId">
      <p style="font-size:13px;color:var(--grey2);margin-bottom:18px;" id="avisTargetName"></p>
      <div class="form-group">
        <label class="form-label">Note</label>
        <div class="star-picker" id="starPicker">
          <button class="star-btn" data-val="1" onclick="selectStar(1)">★</button>
          <button class="star-btn" data-val="2" onclick="selectStar(2)">★</button>
          <button class="star-btn" data-val="3" onclick="selectStar(3)">★</button>
          <button class="star-btn" data-val="4" onclick="selectStar(4)">★</button>
          <button class="star-btn" data-val="5" onclick="selectStar(5)">★</button>
        </div>
      </div>
      <div class="form-group">
        <label class="form-label">Commentaire <span style="color:var(--grey);font-weight:400">(optionnel)</span></label>
        <textarea class="form-textarea" id="avisComment" placeholder="Super session, organisation parfaite…" style="min-height:90px;"></textarea>
      </div>
      <div id="avisError" style="color:var(--orange);font-size:13px;margin-bottom:10px;display:none;"></div>
      <button class="btn btn-primary" style="width:100%;justify-content:center;" onclick="submitAvis()">
        <i class="fa-solid fa-paper-plane"></i> Envoyer l'avis
      </button>
    </div>
  </div>
</div>

<!-- ===================== MODAL INSCRIPTION ===================== -->
<div class="modal-overlay" id="modalInscription">
  <div class="modal-box">
    <div class="modal-header">
      <div class="modal-title">Accès +1Life</div>
      <button class="modal-close" id="closeInscription"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <div class="modal-body">

      <!-- Auth tabs -->
      <div class="auth-tabs">
        <button class="auth-tab active" id="tabConnexion" onclick="switchAuthTab('connexion')">Connexion</button>
        <button class="auth-tab" id="tabInscription" onclick="switchAuthTab('inscription')">Inscription</button>
      </div>

      <!-- ===== ONGLET CONNEXION ===== -->
      <div id="authConnexion">
        <div id="loginError" style="display:none;background:rgba(52,145,136,0.12);border:1px solid rgba(52,145,136,0.3);border-radius:10px;padding:10px 14px;font-size:13px;color:#FF7A7A;margin-bottom:12px;"></div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="loginEmail" placeholder="thomas@email.com">
        </div>
        <div class="form-group">
          <label class="form-label">Mot de passe</label>
          <input type="password" class="form-input" id="loginPassword" placeholder="Ton mot de passe">
        </div>
        <div class="modal-footer" style="margin-top:8px;">
          <button class="btn btn-primary" style="width:100%;justify-content:center;" onclick="loginWithEmail()">Se connecter <i class="fa-solid fa-arrow-right"></i></button>
        </div>
        <div class="login-separator">— ou —</div>
        <button onclick="loginWithGoogle()" class="btn btn-outline" style="width:100%;justify-content:center;gap:8px;">
          <i class="fa-brands fa-google"></i> Connexion avec Google
        </button>
        <p style="text-align:center;margin-top:16px;font-size:13px;color:var(--grey);">Pas encore de compte ? <a href="#" onclick="event.preventDefault();switchAuthTab('inscription')" style="color:var(--orange);">Créer un compte</a></p>
      </div>

      <!-- ===== ONGLET INSCRIPTION ===== -->
      <div id="authInscription" style="display:none;">

      <!-- Steps indicator -->
      <div class="modal-steps" id="inscSteps">
        <div class="modal-step-dot active" id="isd1">1</div>
        <div class="modal-step-line" id="isl1"></div>
        <div class="modal-step-dot" id="isd2">2</div>
        <div class="modal-step-line" id="isl2"></div>
        <div class="modal-step-dot" id="isd3">3</div>
      </div>

      <!-- Pane 1 : Choisir son profil -->
      <div class="modal-pane active" id="iPane1">
        <p style="font-size:14px;color:var(--grey2);margin-bottom:20px;">Quel type de compte souhaites-tu créer ?</p>
        <div class="profile-cards">
          <div class="profile-card selected" data-profile="particulier" onclick="selectProfile(this)">
            <span class="pc-icon">🏃</span>
            <div class="pc-name">Particulier</div>
            <div class="pc-desc">Je veux rejoindre ou créer des events sportifs</div>
          </div>
          <div class="profile-card" data-profile="association" onclick="selectProfile(this)">
            <span class="pc-icon">🤝</span>
            <div class="pc-name">Association</div>
            <div class="pc-desc">Je représente un club ou une association sportive</div>
          </div>
          <div class="profile-card" data-profile="pro" onclick="selectProfile(this)">
            <span class="pc-icon">💼</span>
            <div class="pc-name">Professionnel</div>
            <div class="pc-desc">Coach, moniteur, salle de sport...</div>
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" onclick="inscNext(2)">Continuer <i class="fa-solid fa-arrow-right"></i></button>
        </div>
      </div>

      <!-- Pane 2 : Formulaire -->
      <div class="modal-pane" id="iPane2">
        <!-- Champs communs -->
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Prénom</label>
            <input type="text" class="form-input" id="inscPrenom" placeholder="Thomas">
          </div>
          <div class="form-group">
            <label class="form-label">Nom</label>
            <input type="text" class="form-input" id="inscNom" placeholder="Dupont">
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Email</label>
          <input type="email" class="form-input" id="inscEmail" placeholder="thomas@email.com">
        </div>
        <div class="form-group">
          <label class="form-label">Mot de passe</label>
          <input type="password" class="form-input" id="inscPassword" placeholder="6 caractères minimum">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Date de naissance</label>
            <input type="date" class="form-input" id="inscDate">
          </div>
          <div class="form-group">
            <label class="form-label">Ville</label>
            <input type="text" class="form-input" id="inscVille" placeholder="Lyon">
          </div>
        </div>

        <!-- Champs spécifiques association/pro -->
        <div id="fieldAssoPro" style="display:none;">
          <div class="form-group">
            <label class="form-label">Nom de la structure</label>
            <input type="text" class="form-input" id="inscStructure" placeholder="Ex : ASM Lyon, Coach Elite...">
          </div>
          <div class="form-group" id="fieldSiret" style="display:none;">
            <label class="form-label">Numéro SIRET <span style="color:var(--grey);font-weight:400;">(recommandé)</span></label>
            <input type="text" class="form-input" id="inscSiret" placeholder="000 000 000 00000">
            <div class="form-hint">Permet de valider votre statut professionnel.</div>
          </div>
          <div class="form-group">
            <label class="form-label">Description de votre activité</label>
            <textarea class="form-textarea" id="inscDesc" placeholder="Décrivez votre association ou votre activité professionnelle..."></textarea>
          </div>
        </div>

        <div class="form-group" style="margin-top:8px;">
          <label class="form-check">
            <input type="checkbox" checked>
            J'accepte les <a href="#" style="color:var(--orange);" onclick="event.preventDefault();event.stopPropagation();openModal('modalCGU')">CGU</a> et la <a href="#" style="color:var(--orange);" onclick="event.preventDefault();event.stopPropagation();openModal('modalConfidentialite')">politique de confidentialité</a> de +1Life.
          </label>
        </div>
        <div id="inscError" style="display:none;background:rgba(52,145,136,0.12);border:1px solid rgba(52,145,136,0.3);border-radius:10px;padding:10px 14px;font-size:13px;color:#FF7A7A;margin-top:8px;"></div>
        <div class="modal-footer">
          <button class="btn btn-outline" onclick="inscNext(1)"><i class="fa-solid fa-arrow-left"></i> Retour</button>
          <button class="btn btn-primary" onclick="submitInscription()">Créer mon compte <i class="fa-solid fa-check"></i></button>
        </div>
      </div>

      <!-- Pane 3 : Succès -->
      <div class="modal-pane" id="iPane3">
        <div class="success-screen">
          <div class="success-icon">👟</div>
          <h3>Bienvenue sur +1Life !</h3>
          <p>Ton compte a bien été créé. Tu peux maintenant rejoindre des activités près de chez toi ou en créer une toi-même.</p>
          <div style="background:var(--dark3);border:1px solid rgba(52,145,136,0.15);border-radius:12px;padding:16px 20px;font-size:13px;color:var(--grey2);margin-bottom:24px;text-align:left;">
            <div style="display:flex;align-items:center;gap:8px;margin-bottom:8px;color:var(--orange);font-weight:600;">
              <i class="fa-solid fa-gift"></i> Bonus de bienvenue
            </div>
            Tu starts avec <strong style="color:var(--white);">5 points</strong> offerts. Ton premier event t'en rapportera encore plus !
          </div>
          <button class="btn btn-primary btn-large" onclick="closeModal('modalInscription'); openModal('modalEvent');">
            <i class="fa-solid fa-plus"></i> Créer mon premier event
          </button>
          <div style="margin-top:12px;">
            <button class="btn btn-outline" style="font-size:13px;" onclick="closeModal('modalInscription')">Explorer les events existants</button>
          </div>
        </div>
      </div>

      </div><!-- /authInscription -->
    </div>
  </div>
</div>

<!-- ===================== MODAL CRÉATION D'ÉVÉNEMENT ===================== -->
<div class="modal-overlay" id="modalEvent">
  <div class="modal-box wide">
    <div class="modal-header">
      <div class="modal-title">Créer un événement</div>
      <button class="modal-close" id="closeEvent"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <div class="modal-body">

      <!-- Steps indicator -->
      <div class="modal-steps">
        <div class="modal-step-dot active" id="evd1">1</div>
        <div class="modal-step-line" id="evl1"></div>
        <div class="modal-step-dot" id="evd2">2</div>
        <div class="modal-step-line" id="evl2"></div>
        <div class="modal-step-dot" id="evd3">3</div>
      </div>

      <!-- Pane 1 : Choisir l'activité -->
      <div class="modal-pane active" id="evPane1">
        <p style="font-size:14px;color:var(--grey2);margin-bottom:16px;">Sélectionne l'activité que tu souhaites pratiquer</p>
        <div class="activity-grid" id="activityGrid">
          <div class="activity-tile selected" data-sport="Marche" data-icon="🚶" onclick="selectActivity(this)"><span class="at-icon">🚶</span><div class="at-name">Marche</div></div>
          <div class="activity-tile" data-sport="Marche lente" data-icon="🐢" onclick="selectActivity(this)"><span class="at-icon">🐢</span><div class="at-name">Marche lente</div></div>
          <div class="activity-tile" data-sport="Marche rapide" data-icon="💨" onclick="selectActivity(this)"><span class="at-icon">💨</span><div class="at-name">Marche rapide</div></div>
          <div class="activity-tile" data-sport="Marche nordique" data-icon="🎿" onclick="selectActivity(this)"><span class="at-icon">🎿</span><div class="at-name">Marche nordique</div></div>
          <div class="activity-tile" data-sport="Randonnée" data-icon="⛰️" onclick="selectActivity(this)"><span class="at-icon">⛰️</span><div class="at-name">Randonnée</div></div>
          <div class="activity-tile" data-sport="Pétanque" data-icon="🎳" onclick="selectActivity(this)"><span class="at-icon">🎳</span><div class="at-name">Pétanque</div></div>
          <div class="activity-tile" data-sport="Longe Côte" data-icon="🌊" onclick="selectActivity(this)"><span class="at-icon">🌊</span><div class="at-name">Longe Côte</div></div>
          <div class="activity-tile" data-sport="Gym" data-icon="🏋️" onclick="selectActivity(this)"><span class="at-icon">🏋️</span><div class="at-name">Gym</div></div>
          <div class="activity-tile" data-sport="Yoga" data-icon="🧘" onclick="selectActivity(this)"><span class="at-icon">🧘</span><div class="at-name">Yoga</div></div>
          <div class="activity-tile" data-sport="Qigong" data-icon="🌿" onclick="selectActivity(this)"><span class="at-icon">🌿</span><div class="at-name">Qigong</div></div>
          <div class="activity-tile" data-sport="Natation" data-icon="🏊" onclick="selectActivity(this)"><span class="at-icon">🏊</span><div class="at-name">Natation</div></div>
          <div class="activity-tile" data-sport="Vélo" data-icon="🚴" onclick="selectActivity(this)"><span class="at-icon">🚴</span><div class="at-name">Vélo</div></div>
          <div class="activity-tile" data-sport="Running" data-icon="🏃" onclick="selectActivity(this)"><span class="at-icon">🏃</span><div class="at-name">Running</div></div>
          <div class="activity-tile" data-sport="Football" data-icon="⚽" onclick="selectActivity(this)"><span class="at-icon">⚽</span><div class="at-name">Football</div></div>
          <div class="activity-tile" data-sport="Tennis" data-icon="🎾" onclick="selectActivity(this)"><span class="at-icon">🎾</span><div class="at-name">Tennis</div></div>
          <div class="activity-tile" data-sport="Badminton" data-icon="🏸" onclick="selectActivity(this)"><span class="at-icon">🏸</span><div class="at-name">Badminton</div></div>
          <div class="activity-tile" data-sport="Escalade" data-icon="🧗" onclick="selectActivity(this)"><span class="at-icon">🧗</span><div class="at-name">Escalade</div></div>
          <div class="activity-tile" data-sport="Padel" data-icon="🏓" onclick="selectActivity(this)"><span class="at-icon">🏓</span><div class="at-name">Padel</div></div>
          <div class="activity-tile activity-tile-autre" data-sport="__autre__" data-icon="✏️" onclick="selectActivityAutre(this)"><span class="at-icon">✏️</span><div class="at-name">Autre</div></div>
        </div>
        <div id="autreActivityWrap" style="display:none;margin-top:12px;">
          <div class="form-group" style="margin-bottom:0;">
            <label class="form-label">Nom de l'activité</label>
            <input type="text" class="form-input" id="autreActivityInput" placeholder="Ex : Kitesurf, Frisbee, Danse…" maxlength="40" oninput="updateAutreActivity(this.value)">
          </div>
        </div>
        <div class="modal-footer">
          <button class="btn btn-primary" onclick="evNext(2)">Suivant <i class="fa-solid fa-arrow-right"></i></button>
        </div>
      </div>

      <!-- Pane 2 : Détails de l'événement -->
      <div class="modal-pane" id="evPane2">
        <div class="form-group">
          <label class="form-label">Titre de l'événement</label>
          <input type="text" class="form-input" id="evTitle" placeholder="Ex : Match 5v5 amical — Lyon 3e">
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Date</label>
            <input type="date" class="form-input" id="evDate">
          </div>
          <div class="form-group">
            <label class="form-label">Heure</label>
            <input type="time" class="form-input" id="evTime" value="18:30">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Ville</label>
            <input type="text" class="form-input" id="evVille" placeholder="Rennes, Brest, Nantes…">
          </div>
          <div class="form-group">
            <label class="form-label">Lieu / Adresse</label>
            <input type="text" class="form-input" id="evLocation" placeholder="Stade Blaizot, rue des…">
          </div>
        </div>
        <div class="form-row">
          <div class="form-group">
            <label class="form-label">Nombre de participants</label>
            <select class="form-select" id="evParticipants">
              <option value="illimité">Illimité</option>
              <option value="5">5 max</option>
              <option value="10" selected>10 max</option>
              <option value="15">15 max</option>
              <option value="20">20 max</option>
              <option value="30">30 max</option>
            </select>
          </div>
          <div class="form-group">
            <label class="form-label">Récurrence</label>
            <select class="form-select" id="evRecurrence">
              <option value="unique">Événement unique</option>
              <option value="hebdo">Chaque semaine</option>
              <option value="mensuel">Chaque mois</option>
            </select>
          </div>
        </div>
        <div class="form-group">
          <label class="form-label">Description <span style="color:var(--grey);font-weight:400;">(optionnel)</span></label>
          <textarea class="form-textarea" id="evDesc" placeholder="Décris l'événement : type de jeu, équipement à apporter, point de RDV précis..."></textarea>
        </div>
        <div class="toggle-row">
          <label><i class="fa-solid fa-car-side" style="color:var(--orange);"></i> Proposer du covoiturage</label>
          <label class="toggle-switch"><input type="checkbox" id="evCarpool"><span class="toggle-slider"></span></label>
        </div>
        <div class="toggle-row">
          <label><i class="fa-solid fa-rotate" style="color:var(--orange);"></i> Événement récurrent</label>
          <label class="toggle-switch"><input type="checkbox" id="evRecur"><span class="toggle-slider"></span></label>
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" onclick="evNext(1)"><i class="fa-solid fa-arrow-left"></i> Retour</button>
          <button class="btn btn-primary" onclick="evNext(3)">Aperçu <i class="fa-solid fa-eye"></i></button>
        </div>
      </div>

      <!-- Pane 3 : Aperçu et validation -->
      <div class="modal-pane" id="evPane3">
        <p style="font-size:14px;color:var(--grey2);margin-bottom:20px;">Voici l'aperçu de ton annonce avant publication :</p>
        <div class="event-preview-card">
          <div class="epc-header">
            <div class="epc-sport-badge" id="prevIcon">⚽</div>
            <div>
              <div id="prevTitle" style="font-family:var(--font-display);font-size:22px;font-weight:800;text-transform:uppercase;margin-bottom:4px;">Match 5v5 — Lyon 3e</div>
              <div id="prevLevel" style="font-size:12px;color:var(--orange);font-weight:600;">🚶 Marche</div>
            </div>
          </div>
          <div class="epc-info-row">
            <span><i class="fa-regular fa-calendar"></i> <span id="prevDate">—</span></span>
            <span><i class="fa-regular fa-clock"></i> <span id="prevTime">—</span></span>
            <span><i class="fa-solid fa-location-dot"></i> <span id="prevLocation">—</span></span>
            <span><i class="fa-solid fa-users"></i> <span id="prevParticipants">10 max</span></span>
          </div>
          <div id="prevDesc" style="margin-top:14px;font-size:13px;color:var(--grey2);line-height:1.6;display:none;"></div>
          <div id="prevCarpool" style="margin-top:12px;display:none;">
            <span style="font-size:12px;background:rgba(52,145,136,0.1);border:1px solid rgba(52,145,136,0.2);border-radius:50px;padding:4px 12px;color:var(--orange);">🚗 Covoiturage disponible</span>
          </div>
        </div>
        <div style="background:rgba(52,145,136,0.05);border:1px solid rgba(52,145,136,0.12);border-radius:10px;padding:14px 16px;font-size:13px;color:var(--grey2);margin-bottom:8px;">
          <i class="fa-solid fa-star" style="color:var(--orange);margin-right:6px;"></i>
          La publication rapportera <strong style="color:var(--white);">+3 points</strong> une fois l'événement validé.
        </div>
        <div class="modal-footer">
          <button class="btn btn-outline" onclick="evNext(2)"><i class="fa-solid fa-arrow-left"></i> Modifier</button>
          <button class="btn btn-primary" onclick="publishEvent()"><i class="fa-solid fa-rocket"></i> Publier l'événement</button>
        </div>
      </div>

    </div>
  </div>
</div>

<!-- ===================== FOOTER ===================== -->
<footer style="background:var(--dark2);border-top:1px solid rgba(17,17,17,0.07);padding:40px 5%;">
  <div style="display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:20px;margin-bottom:24px;">
    <a href="#" class="logo" onclick="event.preventDefault();showView('home')">
      <img src="logo.png" alt="+1life" class="logo-img">
    </a>
    <p style="font-size:13px;color:var(--grey);">Site sportif social et solidaire · Ouvert à tous <i class="fa-solid fa-heart" style="color:var(--orange);margin-left:4px;"></i></p>
  </div>
  <div style="display:flex;justify-content:space-between;align-items:center;padding-top:20px;border-top:1px solid rgba(17,17,17,0.06);flex-wrap:wrap;gap:12px;">
    <p style="font-size:13px;color:var(--grey);">© 2026 +1Life. Tous droits réservés.</p>
    <div style="display:flex;gap:20px;">
      <a href="#" style="font-size:13px;color:var(--grey);text-decoration:none;" onclick="event.preventDefault();openModal('modalMentions')">Mentions légales</a>
      <a href="#" style="font-size:13px;color:var(--grey);text-decoration:none;" onclick="event.preventDefault();openModal('modalCGU')">CGU</a>
      <a href="#" style="font-size:13px;color:var(--grey);text-decoration:none;" onclick="event.preventDefault();openModal('modalConfidentialite')">Confidentialité</a>
    </div>
  </div>
</footer>

<!-- ===================== JS ===================== -->
<script>
  // ---- RANKS ----
  const RANKS = [
    { name: 'Sandale',     min: 0,   icon: '🩴', cls: 'paper'    },
    { name: 'Claquette',   min: 10,  icon: '🩴', cls: 'wood'     },
    { name: 'Tongue',      min: 30,  icon: '👟', cls: 'bronze'   },
    { name: 'Pantoufles',  min: 60,  icon: '🥿', cls: 'iron'     },
    { name: 'Crocs',       min: 100, icon: '🐊', cls: 'silver'   },
    { name: 'Sabot',       min: 160, icon: '🪵', cls: 'gold'     },
    { name: 'Chaussures',  min: 240, icon: '👞', cls: 'platinum' },
    { name: 'Basket',      min: 360, icon: '👟', cls: 'diamond'  },
    { name: '+1Life',      min: 520, icon: '❤️', cls: 'plus1'    },
  ]

  function getRank(points) {
    let rank = RANKS[0]
    for (const r of RANKS) {
      if (points >= r.min) rank = r
      else break
    }
    return rank
  }

  // ---- AVATARS ----
  const AVATARS = [
    '🏃','🏊','🚴','⛹️','🤸','🏋️','🤾','🏄','⛷️','🤺',
    '🥊','🏌️','🤽','🧗','🏂','🤿','🥋','🧘','🏇','🎯',
    '💪','🔥','⚡','🦁','🐯','🦊','🐺','🦅','🌊','🎽',
  ]

  function buildAvatarPicker(currentAvatar) {
    const grid = document.getElementById('avatarPickerGrid')
    if (!grid) return
    grid.innerHTML = AVATARS.map(em => `
      <div class="avatar-option${em === currentAvatar ? ' selected' : ''}"
           onclick="saveAvatar('${em}')" title="${em}">${em}</div>
    `).join('')
  }

  function openAvatarPicker() {
    if (!_currentUserId) { openAuthModal('connexion'); return }
    const emojiEl = document.getElementById('profileAvatarEmoji')
    const currentEmoji = emojiEl ? emojiEl.textContent.trim() : ''
    buildAvatarPicker(currentEmoji)
    document.getElementById('avatarModalOverlay').classList.add('open')
  }

  function closeAvatarPicker() {
    const overlay = document.getElementById('avatarModalOverlay')
    if (overlay) overlay.classList.remove('open')
  }

  async function saveAvatar(emoji) {
    if (!_currentUserId) return
    await supabase.from('profiles').update({ avatar: emoji }).eq('id', _currentUserId)
    // Mise à jour visuelle immédiate (gère photo Google et emoji)
    const wrap = document.getElementById('profileAvatarWrap')
    if (wrap) {
      wrap.innerHTML = `<span id="profileAvatarEmoji" style="font-size:56px;line-height:1;">${emoji}</span><div class="avatar-edit-overlay"><i class="fa-solid fa-pen"></i></div>`
    }
    const navInitial = document.getElementById('navAvatarInitial')
    if (navInitial) { navInitial.textContent = emoji; navInitial.style.display = 'flex' }
    const navAvatar = document.getElementById('navAvatar')
    if (navAvatar) navAvatar.style.display = 'none'
    buildAvatarPicker(emoji)
    closeAvatarPicker()
  }

  // ---- VIEW SWITCHING ----
  function showView(name) {
    document.querySelectorAll('.view').forEach(v => v.classList.remove('active'))
    const target = document.getElementById('view-' + name)
    if (target) target.classList.add('active')
    window.scrollTo(0, 0)
    if (name === 'home') history.pushState(null, '', location.pathname)
    else history.pushState(null, '', '#' + name)
  }

  function showProfile() {
    showView('profil')
    loadProfileData()
  }

  async function loadProfileData() {
    const { data: { session } } = await supabase.auth.getSession()
    if (!session) { showView('home'); return }

    const user = session.user
    const meta = user.user_metadata || {}

    // Fetch profile from DB
    const { data: profile } = await supabase.from('profiles').select('*').eq('id', user.id).single()

    // Avatar : custom emoji en priorité, sinon photo Google, sinon emoji par défaut
    const customAvatar = profile?.avatar || null
    const wrap = document.getElementById('profileAvatarWrap')
    const overlay = `<div class="avatar-edit-overlay"><i class="fa-solid fa-pen"></i></div>`
    if (customAvatar) {
      wrap.innerHTML = `<span id="profileAvatarEmoji" style="font-size:56px;line-height:1;">${customAvatar}</span>${overlay}`
      const navInitial = document.getElementById('navAvatarInitial')
      if (navInitial) { navInitial.textContent = customAvatar; navInitial.style.display = 'flex' }
      const navAvatar = document.getElementById('navAvatar')
      if (navAvatar) navAvatar.style.display = 'none'
    } else {
      const avatarUrl = safeImgUrl(meta.avatar_url || meta.picture || '')
      if (avatarUrl) {
        const img = document.createElement('img')
        img.src = avatarUrl; img.alt = 'avatar'
        wrap.innerHTML = overlay; wrap.insertAdjacentElement('afterbegin', img)
      } else {
        wrap.innerHTML = `<span id="profileAvatarEmoji" style="font-size:56px;line-height:1;">🏃</span>${overlay}`
      }
    }
    buildAvatarPicker(customAvatar || '')

    const prenom = profile?.prenom || meta.given_name || meta.full_name?.split(' ')[0] || ''
    const nom = profile?.nom || meta.family_name || ''
    document.getElementById('profileName').textContent = (prenom + ' ' + (nom ? nom[0] + '.' : '')).trim() || user.email

    const typeMap = { particulier: '🏃 Particulier', association: '🤝 Association', pro: '💼 Pro' }
    document.getElementById('profileType').textContent = typeMap[profile?.type] || '🏃 Particulier'
    document.getElementById('profileVille').textContent = profile?.ville ? '📍 ' + profile.ville : ''

    // Fetch events count
    const { count } = await supabase.from('events').select('id', { count: 'exact', head: true }).eq('creator_id', user.id)
    const eventsCount = count || 0
    const { count: joinedCount } = await supabase
      .from('event_participants').select('event_id', { count: 'exact', head: true })
      .eq('user_id', user.id)
    const points = (eventsCount * 3) + (joinedCount || 0)
    const rank = getRank(points)

    document.getElementById('profileEvents').textContent = eventsCount
    document.getElementById('profilePoints').textContent = points
    document.getElementById('profileRankIcon').textContent = rank.icon
    document.getElementById('profileRankName').textContent = rank.name

    // ---- Rank progression ----
    const rankIdx = RANKS.indexOf(rank)
    const nextRank = RANKS[rankIdx + 1] || null

    if (nextRank) {
      const rangeTotal = nextRank.min - rank.min
      const rangeEarned = points - rank.min
      const pct = Math.min(100, Math.round((rangeEarned / rangeTotal) * 100))
      document.getElementById('rankBarFill').style.width = pct + '%'
      document.getElementById('rankNextLabel').innerHTML = `<strong>${nextRank.name}</strong> dans ${nextRank.min - points} pts`
      document.getElementById('rankBarCurrent').textContent = rank.name + ' · ' + points + ' pts'
      document.getElementById('rankBarNext').textContent = nextRank.min + ' pts'
    } else {
      // Max rank
      document.getElementById('rankBarFill').style.width = '100%'
      document.getElementById('rankNextLabel').textContent = 'Rang maximum !'
      document.getElementById('rankBarCurrent').textContent = points + ' pts'
      document.getElementById('rankBarNext').textContent = ''
    }

    // Rank ladder — show only prev / current / next
    const ladder = document.getElementById('rankLadder')
    const visible = [rankIdx - 1, rankIdx, rankIdx + 1].filter(i => i >= 0 && i < RANKS.length)
    ladder.innerHTML = visible.map(i => {
      const r = RANKS[i]
      const isCurrent = i === rankIdx
      const isDone = i < rankIdx
      const cls = isCurrent ? 'rank-step current' : isDone ? 'rank-step done' : 'rank-step'
      const badge = isCurrent ? '<span class="rank-step-badge">Ton rang</span>' : ''
      const check = isDone ? '<i class="fa-solid fa-check rank-step-check"></i>' : ''
      const ptsLabel = r.min === 0 ? 'Départ' : r.min + ' pts'
      return `<div class="${cls}">
        <span class="rank-step-icon">${r.icon}</span>
        <div class="rank-step-info">
          <div class="rank-step-name">${esc(r.name)}</div>
          <div class="rank-step-pts">${ptsLabel}</div>
        </div>
        ${badge}${check}
      </div>`
    }).join('')

    // Charger les onglets
    loadMyInscriptions()
    loadMyReviews()
  }

  // ---- SECURITY: HTML escape helper ----
  function esc(str) {
    if (str == null) return ''
    return String(str)
      .replace(/&/g, '&amp;')
      .replace(/</g, '&lt;')
      .replace(/>/g, '&gt;')
      .replace(/"/g, '&quot;')
      .replace(/'/g, '&#x27;')
  }

  // ---- SECURITY: validate URL is safe (https only, known image hosts) ----
  function safeImgUrl(url) {
    if (!url || typeof url !== 'string') return ''
    try {
      const u = new URL(url)
      if (u.protocol !== 'https:') return ''
      return url
    } catch { return '' }
  }

  // ---- SECURITY: sanitize & trim text input before sending to Supabase ----
  function sanitizeInput(val, maxLen = 200) {
    if (val == null) return ''
    return String(val).trim().slice(0, maxLen)
  }

  // ---- HOME EVENTS ----
  // ---- Fetch creator names in batch (separate query, no FK join needed) ----
  async function fetchCreatorNames(creatorIds) {
    if (!creatorIds.length) return {}
    const unique = [...new Set(creatorIds)]
    const { data } = await supabase
      .from('profiles')
      .select('id, prenom, nom')
      .in('id', unique)
    const map = {}
    if (data) data.forEach(p => { map[p.id] = p })
    return map
  }

  async function loadHomeEvents() {
    const grid = document.getElementById('homeEventsList')
    if (!grid) return

    if (!_currentUserId) {
      grid.innerHTML = `<div class="empty-state" style="grid-column:1/-1;padding:40px 20px;">
        <span class="empty-icon" style="font-size:32px;">🔒</span>
        <p style="margin-bottom:12px">Connecte-toi pour voir les événements près de chez toi.</p>
        <button onclick="openAuthModal('connexion')" class="btn btn-primary btn-small"><i class="fa-solid fa-right-to-bracket"></i> Se connecter</button>
      </div>`
      return
    }

    const { data: rawHome, error } = await supabase
      .from('events')
      .select('id, titre, activite, niveau, date_heure, lieu, ville, max_participants, description, creator_id')
      .order('date_heure', { ascending: true })
      .limit(20)

    const _now = new Date()
    const events = rawHome?.filter(ev => !ev.date_heure || new Date(ev.date_heure) >= _now).slice(0, 3) || []

    if (error || !events.length) {
      grid.innerHTML = `<div class="empty-state" style="grid-column:1/-1;padding:40px 20px;">
        <span class="empty-icon" style="font-size:32px;opacity:0.4">🌊</span>
        <p style="margin-bottom:12px">Aucun événement pour le moment.<br>Sois le premier !</p>
        <button onclick="openModal('modalEvent')" class="btn btn-primary btn-small">Créer un event</button>
      </div>`
      return
    }

    const eventIds = events.map(e => e.id)
    const { data: parts } = await supabase
      .from('event_participants').select('event_id').in('event_id', eventIds)
    const countMap = {}
    parts?.forEach(p => { countMap[p.event_id] = (countMap[p.event_id] || 0) + 1 })

    let joinedSet = new Set()
    if (_currentUserId) {
      const { data: mine } = await supabase
        .from('event_participants').select('event_id')
        .eq('user_id', _currentUserId).in('event_id', eventIds)
      mine?.forEach(p => joinedSet.add(p.event_id))
    }

    const annotated = events.map(ev => ({
      ...ev,
      _creator: null,
      _participantCount: countMap[ev.id] || 0,
      _isJoined: joinedSet.has(ev.id),
      _isCreator: ev.creator_id === _currentUserId,
    }))
    grid.innerHTML = annotated.map(ev => buildEventCard(ev, {}, false)).join('')
  }

  // ---- EXPLORER ----
  var _currentUserId = null
  let _allEvents = []

  function showExplorer() {
    showView('explorer')
    loadExplorer()
  }

  async function showMesEvents() {
    if (!_currentUserId) { openAuthModal('connexion'); return }
    showView('mes-events')
    if (!_allEvents.length) await loadExplorer()
    renderMesEvents()
  }

  async function loadExplorer() {
    const grid = document.getElementById('explorerList')

    if (!_currentUserId) {
      grid.innerHTML = `<div class="empty-state" style="padding:60px 20px;">
        <span class="empty-icon" style="font-size:40px;">🔒</span>
        <p style="margin-bottom:16px;font-size:15px;">Connecte-toi pour explorer les activités près de chez toi.</p>
        <button onclick="openAuthModal('connexion')" class="btn btn-primary"><i class="fa-solid fa-right-to-bracket"></i> Se connecter</button>
        <p style="margin-top:12px;font-size:13px;color:var(--grey);">Pas de compte ? <a href="#" onclick="event.preventDefault();openAuthModal('inscription')" style="color:var(--orange);">Inscription gratuite</a></p>
      </div>`
      return
    }

    grid.innerHTML = '<div class="empty-state"><span class="empty-icon">🔍</span><p>Chargement…</p></div>'

    const { data: rawEvents, error } = await supabase
      .from('events')
      .select('id, titre, activite, niveau, date_heure, lieu, ville, max_participants, description, creator_id')
      .order('date_heure', { ascending: true })
      .limit(100)

    if (error || !rawEvents) {
      grid.innerHTML = '<div class="empty-state"><span class="empty-icon">😕</span><p>Impossible de charger les événements.</p></div>'
      return
    }

    // Fetch creator names separately (no FK join required)
    const creatorIds = rawEvents.map(ev => ev.creator_id).filter(Boolean)
    const creatorsMap = await fetchCreatorNames(creatorIds)

    // Participant counts (batch)
    const eventIds = rawEvents.map(e => e.id)
    const { data: parts } = await supabase
      .from('event_participants').select('event_id').in('event_id', eventIds)
    const countMap = {}
    parts?.forEach(p => { countMap[p.event_id] = (countMap[p.event_id] || 0) + 1 })

    // Events rejoints par l'utilisateur courant
    let joinedSet = new Set()
    if (_currentUserId) {
      const { data: mine } = await supabase
        .from('event_participants').select('event_id')
        .eq('user_id', _currentUserId).in('event_id', eventIds)
      mine?.forEach(p => joinedSet.add(p.event_id))
    }

    const nowEx = new Date()
    _allEvents = rawEvents.map(ev => ({
      ...ev,
      _creator: creatorsMap[ev.creator_id] || null,
      _participantCount: countMap[ev.id] || 0,
      _isJoined: joinedSet.has(ev.id),
      _isCreator: ev.creator_id === _currentUserId,
      _isPast: ev.date_heure ? new Date(ev.date_heure) < nowEx : false,
    }))
    applyFilters()
  }

  const _sportImages = {
    'Marche':          'https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?w=600&h=220&fit=crop&auto=format&q=60',
    'Marche lente':    'https://images.unsplash.com/photo-1441974231531-c6227db76b6e?w=600&h=220&fit=crop&auto=format&q=60',
    'Marche rapide':   'https://images.unsplash.com/photo-1476480862126-209bfaa8edc8?w=600&h=220&fit=crop&auto=format&q=60&sat=-20&exp=5',
    'Marche nordique': 'https://images.unsplash.com/photo-1520209759809-a9bcb6cb3241?w=600&h=220&fit=crop&auto=format&q=60',
    'Randonnée':     'https://images.unsplash.com/photo-1551632811-561732d1e306?w=600&h=220&fit=crop&auto=format&q=60',
    'Pétanque':      'https://images.unsplash.com/photo-1556817411-31ae72fa3ea0?w=600&h=220&fit=crop&auto=format&q=60',
    'Longe Côte':    'https://images.unsplash.com/photo-1507525428034-b723cf961d3e?w=600&h=220&fit=crop&auto=format&q=60',
    'Gym':           'https://images.unsplash.com/photo-1534438327276-14e5300c3a48?w=600&h=220&fit=crop&auto=format&q=60',
    'Yoga':          'https://images.unsplash.com/photo-1575052814086-f385e2e2ad1b?w=600&h=220&fit=crop&auto=format&q=60',
    'Qigong':        'https://images.unsplash.com/photo-1545389336-cf090694435e?w=600&h=220&fit=crop&auto=format&q=60',
    'Natation':      'https://images.unsplash.com/photo-1530549387789-4c1017266635?w=600&h=220&fit=crop&auto=format&q=60',
    'Vélo':          'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=600&h=220&fit=crop&auto=format&q=60',
    'Cyclisme':      'https://images.unsplash.com/photo-1571068316344-75bc76f77890?w=600&h=220&fit=crop&auto=format&q=60',
    'Running':       'https://images.unsplash.com/photo-1552674605-db6ffd4facb5?w=600&h=220&fit=crop&auto=format&q=60',
    'Football':      'https://images.unsplash.com/photo-1575361204480-aadea25e6e68?w=600&h=220&fit=crop&auto=format&q=60',
    'Tennis':        'https://images.unsplash.com/photo-1554068865-24ceec697f4e?w=600&h=220&fit=crop&auto=format&q=60',
    'Badminton':     'https://images.unsplash.com/photo-1599474924187-334a4ae5ea3c?w=600&h=220&fit=crop&auto=format&q=60',
    'Escalade':      'https://images.unsplash.com/photo-1522163182402-834f871fd851?w=600&h=220&fit=crop&auto=format&q=60',
    'Padel':         'https://images.unsplash.com/photo-1554068865-24ceec697f4e?w=600&h=220&fit=crop&auto=format&q=60',
    'Basket':        'https://images.unsplash.com/photo-1546519638-68e109498ffc?w=600&h=220&fit=crop&auto=format&q=60',
    'Basketball':    'https://images.unsplash.com/photo-1546519638-68e109498ffc?w=600&h=220&fit=crop&auto=format&q=60',
    'Surf':          'https://images.unsplash.com/photo-1502680390469-be75c86b636f?w=600&h=220&fit=crop&auto=format&q=60',
  }
  const _sportDefaultImg = 'https://images.unsplash.com/photo-1571019613454-1cb2f99b2d8b?w=600&h=220&fit=crop&auto=format&q=60'

  function buildEventCard(ev, creatorsMap, showCreator = true) {
    const date = ev.date_heure
      ? new Date(ev.date_heure).toLocaleDateString('fr-FR', { weekday:'short', day:'numeric', month:'short', hour:'2-digit', minute:'2-digit' })
      : 'Date à confirmer'
    const emoji = levelEmoji(ev.niveau)
    const activite = esc(ev.activite || 'Sport')
    const titre = esc(ev.titre || '')
    const lieu = esc(ev.lieu || '')
    const niveau = esc(ev.niveau || '')
    const description = esc(ev.description || '')
    const maxP = ev.max_participants ? parseInt(ev.max_participants, 10) : null
    const imgUrl = _sportImages[ev.activite] || _sportDefaultImg

    // Creator data is pre-fetched and attached as _creator
    const cp = ev._creator || creatorsMap[ev.creator_id] || null
    const creatorName = cp
      ? esc(((cp.prenom || '') + (cp.nom ? ' ' + cp.nom[0] + '.' : '')).trim())
      : ''

    // Participant count + action button
    const pCount = ev._participantCount || 0
    const isFull = maxP && pCount >= maxP
    let actionBtn = ''
    _repeatCache[ev.id] = ev
    if (ev._isPast && ev._isCreator) {
      // Event passé du créateur : proposer de le répéter
      actionBtn = `<div class="event-actions"><button class="btn-repeat-event" onclick="repeatEvent('${esc(ev.id)}')"><i class="fa-solid fa-rotate-right"></i> Répéter</button><button class="btn-delete-event" onclick="confirmDelete('${esc(ev.id)}')" title="Supprimer"><i class="fa-solid fa-trash"></i></button></div>`
    } else if (ev._isCreator) {
      actionBtn = `<div class="event-actions"><span class="creator-badge">Ton event</span><button class="btn-delete-event" onclick="confirmDelete('${esc(ev.id)}')" title="Supprimer"><i class="fa-solid fa-trash"></i></button></div>`
    } else if (ev._isJoined) {
      actionBtn = `<button class="btn-leave-event" onclick="leaveEvent('${esc(ev.id)}')"><i class="fa-solid fa-right-from-bracket"></i> Se désinscrire</button>`
    } else if (isFull) {
      actionBtn = `<button class="btn-join-event" disabled>Complet</button>`
    } else {
      actionBtn = `<button class="btn-join-event" onclick="joinEvent('${esc(ev.id)}')"><i class="fa-solid fa-plus"></i> Rejoindre</button>`
    }

    return `
    <div class="event-item${ev._isPast ? ' event-item-past' : ''}">
      <div class="event-item-banner" style="background-image:url('${imgUrl}')">
        ${ev._isPast ? '<span class="event-item-past-badge">Passé</span>' : ''}
        <div class="event-item-banner-tags">
          <span class="event-tag">${activite}</span>
          ${niveau ? `<span class="event-level">${emoji} ${niveau}</span>` : ''}
        </div>
      </div>
      <div class="event-item-title">${titre}</div>
      <div class="event-item-meta">
        <span><i class="fa-solid fa-calendar-days"></i> ${esc(date)}</span>
        ${ev.ville ? `<span><i class="fa-solid fa-city"></i> ${esc(ev.ville)}</span>` : lieu ? `<span><i class="fa-solid fa-location-dot"></i> ${lieu}</span>` : ''}
        ${maxP ? `<span><i class="fa-solid fa-users"></i> max ${maxP}</span>` : ''}
      </div>
      ${description ? `<p class="event-item-desc">${description}</p>` : ''}
      ${showCreator && ev.creator_id && creatorName ? `
      <div class="event-item-creator">
        <button class="creator-btn" onclick="showCreatorProfile('${esc(ev.creator_id)}')">
          <span class="creator-initial">${esc(creatorName[0]?.toUpperCase() || '?')}</span>
          <span>Par <strong>${creatorName}</strong></span>
          <span style="margin-left:auto;font-size:10px;color:var(--orange);opacity:0.7;display:flex;align-items:center;gap:3px;"><i class="fa-solid fa-user"></i> Voir profil</span>
        </button>
      </div>` : ''}
      <div class="event-item-footer">
        <button class="event-participant-count clickable" onclick="showEventParticipants('${esc(ev.id)}', ${esc(String(pCount))})"><i class="fa-solid fa-users"></i> ${pCount}${maxP ? ' / ' + maxP : ''} <i class="fa-solid fa-chevron-right" style="font-size:9px;opacity:0.5;margin-left:2px;"></i></button>
        ${actionBtn}
      </div>
    </div>`
  }

  async function joinEvent(eventId) {
    if (!_currentUserId) { openAuthModal('connexion'); return }
    const { error } = await supabase.from('event_participants')
      .insert({ event_id: eventId, user_id: _currentUserId })
    if (error) { alert('Erreur : ' + error.message); return }
    loadExplorer()
    loadHomeEvents()
  }

  async function leaveEvent(eventId) {
    if (!_currentUserId) return
    await supabase.from('event_participants')
      .delete().eq('event_id', eventId).eq('user_id', _currentUserId)
    loadExplorer()
    loadHomeEvents()
  }

  function repeatEvent(eventId) {
    const ev = _repeatCache[eventId]
    if (!ev) return
    // Ouvrir le modal de création
    openModal('modalEvent')
    // Attendre que le DOM du modal soit visible avant de pre-fill
    requestAnimationFrame(() => {
      // Sélectionner l'activité
      selectedSport = { name: ev.activite || 'Football', icon: (_sportImages[ev.activite] ? '' : '') }
      const actTile = document.querySelector(`.activity-tile[data-sport="${ev.activite}"]`)
      if (actTile) {
        document.querySelectorAll('.activity-tile').forEach(t => t.classList.remove('selected'))
        actTile.classList.add('selected')
        selectedSport = { name: actTile.dataset.sport, icon: actTile.dataset.icon }
      }
      // Pre-fill pane 2
      const titleEl = document.getElementById('evTitle')
      const locationEl = document.getElementById('evLocation')
      const villeEl = document.getElementById('evVille')
      const descEl = document.getElementById('evDesc')
      const partEl = document.getElementById('evParticipants')
      const carpoolEl = document.getElementById('evCarpool')
      if (titleEl) titleEl.value = ev.titre || ''
      if (locationEl) locationEl.value = ev.lieu || ''
      if (villeEl) villeEl.value = ev.ville || ''
      if (descEl) descEl.value = ev.description || ''
      if (partEl && ev.max_participants) partEl.value = String(ev.max_participants)
      if (carpoolEl) carpoolEl.checked = Boolean(ev.covoiturage)
      // Date et heure vides (à renseigner)
      const dateEl = document.getElementById('evDate')
      const timeEl = document.getElementById('evTime')
      if (dateEl) dateEl.value = ''
      if (timeEl) timeEl.value = '18:30'
      // Naviguer vers le pane 2 pour que l'utilisateur choisisse juste la nouvelle date
      evNext(2)
      // Signaler que la date est requise
      setTimeout(() => {
        if (dateEl) {
          dateEl.style.borderColor = 'rgba(52,145,136,0.6)'
          dateEl.placeholder = 'Nouvelle date requise'
          dateEl.focus()
        }
      }, 50)
    })
  }

  function confirmDelete(eventId) {
    // Récupérer les infos de l'event pour la notification
    const ev = _repeatCache[eventId] || _allEvents.find(e => e.id === eventId)
    const overlay = document.getElementById('confirmOverlay')
    overlay.classList.add('open')
    document.getElementById('confirmOkBtn').onclick = async () => {
      overlay.classList.remove('open')
      // Notifier les participants par email AVANT la suppression
      if (ev) notifyEventDeleted(eventId, ev.titre, ev.date_heure)
      const { error } = await supabase.from('events').delete().eq('id', eventId)
      if (error) { alert('Erreur : ' + error.message); return }
      loadExplorer()
      loadHomeEvents()
    }
  }

  function confirmCancel() {
    document.getElementById('confirmOverlay').classList.remove('open')
  }

  function renderExplorer(events) {
    const grid = document.getElementById('explorerList')
    if (!events.length) {
      grid.innerHTML = `<div class="empty-state"><span class="empty-icon">🌊</span><p>Aucun événement pour le moment.<br>Sois le premier à en créer un !</p><button onclick="openModal('modalEvent')" class="btn btn-primary">Créer un événement</button></div>`
      return
    }
    grid.innerHTML = events.map(ev => buildEventCard(ev, {}, true)).join('')
  }

  const _repeatCache = {}

  let _currentSportFilter = 'tous'
  let _currentCityFilter = ''

  function applyFilters() {
    let filtered = _allEvents.filter(ev => !ev._isPast)
    if (_currentSportFilter !== 'tous') {
      filtered = filtered.filter(ev => ev.activite && ev.activite.toLowerCase().includes(_currentSportFilter.toLowerCase()))
    }
    if (_currentCityFilter.trim()) {
      const city = _currentCityFilter.trim().toLowerCase()
      filtered = filtered.filter(ev => (ev.ville || ev.lieu || '').toLowerCase().includes(city))
    }
    renderExplorer(filtered)
  }

  function switchExplorerTab(tab) {
    document.querySelectorAll('.explorer-main-tab').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.tab === tab)
    })
    document.getElementById('explorerPanelTous').classList.toggle('active', tab === 'tous')
    document.getElementById('explorerPanelMes').classList.toggle('active', tab === 'mes')
    if (tab === 'mes') renderMesEvents()
  }

  function renderMesEvents() {
    const container = document.getElementById('mesEventsList')
    const countEl = document.getElementById('mesEventsCount')
    if (!_currentUserId) {
      container.innerHTML = `<div class="empty-state"><span class="empty-icon">🔒</span><p>Connecte-toi pour voir tes événements.</p></div>`
      if (countEl) countEl.textContent = ''
      return
    }

    const sortVal = document.getElementById('mesEventsSortSelect')?.value || 'date-asc'
    const myEvents = _allEvents.filter(ev => ev._isCreator || ev._isJoined)
    const upcoming = myEvents.filter(ev => !ev._isPast)
    const past = myEvents.filter(ev => ev._isPast)

    const sortFn = (a, b) => {
      if (sortVal === 'date-asc')  return new Date(a.date_heure) - new Date(b.date_heure)
      if (sortVal === 'date-desc') return new Date(b.date_heure) - new Date(a.date_heure)
      if (sortVal === 'sport')     return (a.activite || '').localeCompare(b.activite || '')
      return 0
    }
    upcoming.sort(sortFn)
    past.sort(sortFn)

    const total = myEvents.length
    if (countEl) countEl.textContent = total ? `${total} événement${total > 1 ? 's' : ''}` : ''

    if (!total) {
      container.innerHTML = `<div class="empty-state"><span class="empty-icon">🎯</span><p>Tu n'as pas encore créé ou rejoint d'événement.</p><button onclick="openModal('modalEvent')" class="btn btn-primary"><i class="fa-solid fa-plus"></i> Créer un événement</button></div>`
      return
    }

    // Remember if past section was open
    const pastWasOpen = !!document.querySelector('.mes-section-divider.open')

    let html = ''

    // À venir — full cards, grid 5 par ligne
    if (upcoming.length) {
      html += `<div class="mes-section-header">À venir · ${upcoming.length}</div>`
      html += `<div class="mes-events-grid">${upcoming.map(ev => buildEventCard(ev, {}, true)).join('')}</div>`
    }

    // Passés — compact, collapsible
    if (past.length) {
      const open = pastWasOpen || !upcoming.length
      html += `<div class="mes-section-divider${open ? ' open' : ''}" onclick="togglePastSection(this)">
        <span class="mes-section-divider-label">Passés · ${past.length}</span>
        <div class="mes-section-divider-line"></div>
        <i class="fa-solid fa-chevron-down mes-section-divider-icon"></i>
      </div>
      <div id="mesPastList" style="display:${open ? 'block' : 'none'}">
        ${past.map(ev => buildCompactCard(ev)).join('')}
      </div>`
    }

    container.innerHTML = html
  }

  function togglePastSection(el) {
    const wasOpen = el.classList.contains('open')
    el.classList.toggle('open', !wasOpen)
    const list = document.getElementById('mesPastList')
    if (list) list.style.display = wasOpen ? 'none' : 'block'
  }

  function buildCompactCard(ev, upcoming = false) {
    const imgUrl = _sportImages[ev.activite] || _sportDefaultImg
    const title = esc(ev.titre || '')
    const activite = esc(ev.activite || 'Sport')
    const date = ev.date_heure
      ? new Date(ev.date_heure).toLocaleDateString('fr-FR', { weekday: upcoming ? 'short' : undefined, day: 'numeric', month: 'short', hour: upcoming ? '2-digit' : undefined, minute: upcoming ? '2-digit' : undefined })
      : ''
    const badge = ev._isCreator ? 'Créé' : 'Rejoint'
    const actionBtn = upcoming
      ? (ev._isCreator
          ? `<button class="btn-delete-event" onclick="confirmDelete('${esc(ev.id)}')" title="Supprimer" style="flex-shrink:0;"><i class="fa-solid fa-trash"></i></button>`
          : `<button class="btn-leave-event" style="font-size:11px;padding:4px 10px;flex-shrink:0;" onclick="leaveEvent('${esc(ev.id)}')"><i class="fa-solid fa-right-from-bracket"></i></button>`)
      : (ev._isCreator
          ? `<button class="btn-repeat-event" style="font-size:11px;padding:4px 10px;flex-shrink:0;" onclick="repeatEvent('${esc(ev.id)}')"><i class="fa-solid fa-rotate-right"></i></button>`
          : '')
    return `<div class="mes-event-compact${upcoming ? ' mes-event-upcoming' : ''}">
      <div class="mes-event-compact-img" style="background-image:url('${imgUrl}')"></div>
      <div class="mes-event-compact-body">
        <div class="mes-event-compact-title">${title}</div>
        <div class="mes-event-compact-meta">${esc(date)}${date ? ' · ' : ''}${activite}</div>
      </div>
      <span class="mes-event-compact-badge">${badge}</span>
      ${actionBtn}
    </div>`
  }

  function filterExplorer(sport) {
    _currentSportFilter = sport
    document.querySelectorAll('#explorerFilters .filter-btn').forEach(btn => {
      btn.classList.toggle('active', btn.dataset.filter === sport)
    })
    applyFilters()
  }

  function filterByCity(value) {
    _currentCityFilter = value
    const clearBtn = document.getElementById('cityFilterClear')
    if (clearBtn) clearBtn.style.display = value.trim() ? 'block' : 'none'
    applyFilters()
  }

  function clearCityFilter() {
    _currentCityFilter = ''
    const inp = document.getElementById('cityFilterInput')
    if (inp) inp.value = ''
    const clearBtn = document.getElementById('cityFilterClear')
    if (clearBtn) clearBtn.style.display = 'none'
    applyFilters()
  }

  async function showEventParticipants(eventId, count) {
    if (!/^[0-9a-f-]{36}$/i.test(eventId)) return
    openModal('modalParticipants')
    const content = document.getElementById('participantsContent')
    if (!count || count == 0) {
      content.innerHTML = '<p style="text-align:center;color:var(--grey);padding:20px 0">Aucun participant pour le moment.</p>'
      return
    }
    content.innerHTML = '<div style="font-size:32px;opacity:0.4;text-align:center;padding:24px 0">⏳</div>'

    const { data: participants, error } = await supabase
      .from('event_participants')
      .select('user_id, joined_at')
      .eq('event_id', eventId)
      .order('joined_at', { ascending: true })

    if (error || !participants || !participants.length) {
      content.innerHTML = '<p style="text-align:center;color:var(--grey);padding:20px 0">Aucun participant pour le moment.</p>'
      return
    }

    const userIds = participants.map(p => p.user_id).filter(Boolean)
    const { data: profiles } = await supabase
      .from('profiles')
      .select('id, prenom, nom, ville')
      .in('id', userIds)

    const profileMap = {}
    profiles?.forEach(p => { profileMap[p.id] = p })

    const rows = participants.map(p => {
      const prof = profileMap[p.user_id] || {}
      const prenom = esc(prof.prenom || '?')
      const nom = prof.nom ? esc(prof.nom[0] + '.') : ''
      const ville = prof.ville ? esc(prof.ville) : ''
      const initial = (prof.prenom || '?')[0].toUpperCase()
      const date = new Date(p.joined_at).toLocaleDateString('fr-FR', { day:'numeric', month:'short' })
      return `<div style="display:flex;align-items:center;gap:12px;padding:10px 0;border-bottom:1px solid rgba(255,255,255,0.06);">
        <div style="width:38px;height:38px;border-radius:50%;background:var(--dark3);border:1.5px solid rgba(52,145,136,0.25);display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-size:16px;font-weight:800;color:var(--orange);flex-shrink:0">${esc(initial)}</div>
        <div style="flex:1;min-width:0">
          <div style="font-weight:600;font-size:14px">${prenom} ${nom}</div>
          ${ville ? `<div style="font-size:12px;color:var(--grey)">📍 ${ville}</div>` : ''}
        </div>
        <div style="font-size:11px;color:var(--grey);white-space:nowrap">${esc(date)}</div>
      </div>`
    }).join('')

    content.innerHTML = `
      <p style="font-size:13px;color:var(--grey);margin-bottom:4px">${participants.length} participant${participants.length > 1 ? 's' : ''} inscrit${participants.length > 1 ? 's' : ''}</p>
      ${rows}`
  }

  function levelEmoji(niveau) {
    if (!niveau) return ''
    const map = { débutant: '🟢', intermédiaire: '🟡', avancé: '🔴', expert: '⚫' }
    return map[String(niveau).toLowerCase()] || '⚪'
  }

  // ---- CREATOR PROFILE MODAL ----
  async function showCreatorProfile(creatorId) {
    // Validate that creatorId looks like a UUID (basic check)
    if (!/^[0-9a-f-]{36}$/i.test(creatorId)) return

    openModal('modalCreateur')
    const content = document.getElementById('createurContent')
    content.innerHTML = '<div style="font-size:32px;opacity:0.4;padding:24px 0">⏳</div>'

    const { data: profile, error } = await supabase
      .from('profiles')
      .select('prenom, nom, type, ville')
      .eq('id', creatorId)
      .single()

    const { count } = await supabase
      .from('events')
      .select('id', { count: 'exact', head: true })
      .eq('creator_id', creatorId)

    if (error || !profile) {
      content.innerHTML = '<p style="color:var(--grey);padding:16px 0">Profil introuvable.</p>'
      return
    }

    const prenom = esc(profile.prenom || '?')
    const nom = profile.nom ? esc(profile.nom[0] + '.') : ''
    const initial = (profile.prenom || '?')[0].toUpperCase()
    const typeMap = { particulier: '🏃 Particulier', association: '🤝 Association', pro: '💼 Pro' }
    const typeLabel = esc(typeMap[profile.type] || '🏃 Particulier')
    const ville = profile.ville ? esc(profile.ville) : ''
    const evCount = count || 0
    const points = evCount * 3
    const rank = getRank(points)

    // Fetch reviews for this creator
    const { data: reviews } = await supabase
      .from('reviews')
      .select('rating, comment, reviewer_id, created_at')
      .eq('reviewed_id', creatorId)
      .order('created_at', { ascending: false })

    const avgRating = reviews?.length
      ? (reviews.reduce((s, r) => s + r.rating, 0) / reviews.length).toFixed(1)
      : null
    const starsHtml = avgRating
      ? `<div style="font-size:13px;color:var(--gold);margin-bottom:4px;">${'★'.repeat(Math.round(avgRating))}${'☆'.repeat(5-Math.round(avgRating))} <span style="color:var(--grey);font-size:12px;">${avgRating} (${reviews.length} avis)</span></div>`
      : ''

    // Vérifier si l'utilisateur a participé à un event PASSÉ de ce créateur
    let canReview = false
    if (_currentUserId && _currentUserId !== creatorId) {
      const { data: pastEvIds } = await supabase
        .from('events').select('id')
        .eq('creator_id', creatorId)
        .lt('date_heure', new Date().toISOString()) // uniquement les events passés
      if (pastEvIds?.length) {
        const ids = pastEvIds.map(e => e.id)
        const { count: partCount } = await supabase
          .from('event_participants').select('event_id', { count: 'exact', head: true })
          .in('event_id', ids).eq('user_id', _currentUserId)
        canReview = (partCount || 0) > 0
      }
    }
    const reviewsHtml = reviews?.length ? reviews.slice(0, 3).map(r => `
      <div style="background:var(--dark3);border-radius:10px;padding:10px 12px;margin-top:8px;text-align:left;">
        <div style="color:var(--gold);font-size:12px;margin-bottom:4px;">${'★'.repeat(r.rating)}${'☆'.repeat(5-r.rating)}</div>
        ${r.comment ? `<div style="font-size:12px;color:var(--grey2);line-height:1.5;">${esc(r.comment)}</div>` : ''}
      </div>`).join('') : ''

    content.innerHTML = `
      <div style="width:72px;height:72px;border-radius:50%;background:var(--dark3);border:2px solid rgba(52,145,136,0.3);display:flex;align-items:center;justify-content:center;font-family:var(--font-display);font-size:30px;font-weight:800;color:var(--orange);margin:0 auto 16px;">${esc(initial)}</div>
      <div style="font-family:var(--font-display);font-size:26px;font-weight:800;text-transform:uppercase;margin-bottom:6px;">${prenom} ${nom}</div>
      <div style="font-size:13px;color:var(--grey);margin-bottom:${ville ? '4px' : '8px'}">${typeLabel}</div>
      ${ville ? `<div style="font-size:13px;color:var(--grey);margin-bottom:8px;">📍 ${ville}</div>` : ''}
      ${starsHtml}
      <div style="display:flex;gap:16px;justify-content:center;margin:12px 0 16px;">
        <div style="text-align:center;">
          <div style="font-family:var(--font-display);font-size:28px;font-weight:900;color:var(--white);">${evCount}</div>
          <div style="font-size:11px;color:var(--grey);text-transform:uppercase;letter-spacing:0.5px;">Events</div>
        </div>
        <div style="text-align:center;">
          <div style="font-family:var(--font-display);font-size:28px;font-weight:900;color:var(--white);">${points}</div>
          <div style="font-size:11px;color:var(--grey);text-transform:uppercase;letter-spacing:0.5px;">Points</div>
        </div>
        <div style="text-align:center;">
          <div style="font-family:var(--font-display);font-size:28px;font-weight:900;">${rank.icon}</div>
          <div style="font-size:11px;color:var(--grey);text-transform:uppercase;letter-spacing:0.5px;">${esc(rank.name)}</div>
        </div>
      </div>
      ${_currentUserId && _currentUserId !== creatorId ? (
        canReview
          ? `<button class="btn btn-outline" style="width:100%;justify-content:center;margin-bottom:12px;font-size:13px;" onclick="openLeaveReview('${esc(creatorId)}','${esc(prenom + ' ' + nom)}')"><i class="fa-solid fa-star" style="color:var(--gold)"></i> Laisser un avis</button>`
          : `<div style="font-size:12px;color:var(--grey);text-align:center;margin-bottom:12px;padding:8px 12px;background:var(--dark3);border-radius:8px;"><i class="fa-solid fa-lock" style="margin-right:6px;"></i>Participe (et attends la fin) d'un event de ${prenom} pour laisser un avis.</div>`
      ) : ''}
      ${reviewsHtml}`
  }

  // ---- Profile tabs ----
  function showProfileTab(tab) {
    document.querySelectorAll('.profile-tab').forEach(t => t.classList.toggle('active', t.dataset.tab === tab))
    document.querySelectorAll('.profile-tab-content').forEach(c => c.classList.remove('active'))
    const el = document.getElementById('profileTab' + tab.charAt(0).toUpperCase() + tab.slice(1))
    if (el) el.classList.add('active')
  }

  // ---- Mes inscriptions (calendrier) ----
  async function loadMyInscriptions() {
    const el = document.getElementById('inscriptionsList')
    if (!el || !_currentUserId) return
    el.innerHTML = '<div class="empty-state" style="padding:20px 0"><span class="empty-icon" style="font-size:24px">⏳</span><p>Chargement…</p></div>'

    const { data: joined } = await supabase
      .from('event_participants')
      .select('event_id')
      .eq('user_id', _currentUserId)

    if (!joined?.length) {
      el.innerHTML = '<div class="empty-state" style="padding:20px 0"><span class="empty-icon" style="font-size:24px">📅</span><p>Tu n\'es inscrit à aucun événement à venir.</p></div>'
      return
    }

    const ids = joined.map(j => j.event_id)
    const { data: events } = await supabase
      .from('events')
      .select('id, titre, activite, date_heure, lieu, ville')
      .in('id', ids)
      .gte('date_heure', new Date().toISOString())
      .order('date_heure', { ascending: true })

    if (!events?.length) {
      el.innerHTML = '<div class="empty-state" style="padding:20px 0"><span class="empty-icon" style="font-size:24px">✅</span><p>Aucun événement à venir pour le moment.</p></div>'
      return
    }

    el.innerHTML = events.map(ev => {
      const d = new Date(ev.date_heure)
      const day = d.toLocaleDateString('fr-FR', { day: '2-digit' })
      const month = d.toLocaleDateString('fr-FR', { month: 'short' })
      const time = d.toLocaleTimeString('fr-FR', { hour: '2-digit', minute: '2-digit' })
      const lieu = esc(ev.ville || ev.lieu || '')
      return `<div class="inscription-item">
        <div class="inscription-date-block">
          <div class="inscription-date-day">${day}</div>
          <div class="inscription-date-month">${month}</div>
        </div>
        <div class="inscription-info">
          <div class="inscription-titre">${esc(ev.titre || ev.activite)}</div>
          <div class="inscription-meta"><i class="fa-solid fa-clock" style="color:var(--orange);font-size:10px;margin-right:4px;"></i>${time}${lieu ? ` &nbsp;·&nbsp; <i class="fa-solid fa-location-dot" style="color:var(--orange);font-size:10px;margin-right:2px;"></i>${lieu}` : ''}</div>
        </div>
        <span class="inscription-sport">${esc(ev.activite || '')}</span>
      </div>`
    }).join('')
  }

  // ---- Avis (reviews) ----
  async function loadMyReviews() {
    const el = document.getElementById('avisList')
    if (!el || !_currentUserId) return
    el.innerHTML = '<div class="empty-state" style="padding:20px 0"><span class="empty-icon" style="font-size:24px">⏳</span></div>'

    const { data: reviews } = await supabase
      .from('reviews')
      .select('id, rating, comment, reviewer_id, created_at')
      .eq('reviewed_id', _currentUserId)
      .order('created_at', { ascending: false })

    if (!reviews?.length) {
      el.innerHTML = '<div class="empty-state" style="padding:20px 0"><span class="empty-icon" style="font-size:24px">⭐</span><p>Aucun avis pour l\'instant.</p></div>'
      return
    }

    // Fetch reviewer names
    const rIds = [...new Set(reviews.map(r => r.reviewer_id).filter(Boolean))]
    const { data: reviewers } = await supabase.from('profiles').select('id, prenom, nom').in('id', rIds)
    const rMap = {}
    reviewers?.forEach(p => { rMap[p.id] = esc(((p.prenom || '') + (p.nom ? ' ' + p.nom[0] + '.' : '')).trim()) })

    const avg = (reviews.reduce((s, r) => s + r.rating, 0) / reviews.length).toFixed(1)

    el.innerHTML = `
      <div style="text-align:center;padding:12px 0 20px;border-bottom:1px solid rgba(255,255,255,0.07);margin-bottom:16px;">
        <div style="font-family:var(--font-display);font-size:44px;font-weight:900;color:var(--white);line-height:1;">${avg}</div>
        <div style="color:var(--gold);font-size:18px;margin:4px 0;">${'★'.repeat(Math.round(avg))}${'☆'.repeat(5-Math.round(avg))}</div>
        <div style="font-size:12px;color:var(--grey);">${reviews.length} avis</div>
      </div>
      ${reviews.map(r => `
        <div class="avis-item">
          <div class="avis-header">
            <span class="avis-stars">${'★'.repeat(r.rating)}${'☆'.repeat(5-r.rating)}</span>
            <span class="avis-reviewer">${rMap[r.reviewer_id] || 'Anonyme'} · ${new Date(r.created_at).toLocaleDateString('fr-FR', {day:'numeric',month:'short'})}</span>
          </div>
          ${r.comment ? `<div class="avis-comment">${esc(r.comment)}</div>` : ''}
        </div>`).join('')}`
  }

  let _selectedStar = 0
  function selectStar(val) {
    _selectedStar = val
    document.querySelectorAll('.star-btn').forEach((b, i) => {
      b.classList.toggle('active', i < val)
    })
  }

  function openLeaveReview(reviewedId, name) {
    closeModal('modalCreateur')
    document.getElementById('avisReviewedId').value = reviewedId
    document.getElementById('avisTargetName').textContent = `Tu laisses un avis pour ${name}`
    document.getElementById('avisComment').value = ''
    document.getElementById('avisError').style.display = 'none'
    _selectedStar = 0
    document.querySelectorAll('.star-btn').forEach(b => b.classList.remove('active'))
    openModal('modalAvis')
  }

  async function submitAvis() {
    if (!_currentUserId) { openAuthModal('connexion'); return }
    const reviewedId = document.getElementById('avisReviewedId').value
    const comment = document.getElementById('avisComment').value.trim().slice(0, 500)
    const errEl = document.getElementById('avisError')
    if (!_selectedStar) { errEl.textContent = 'Choisis une note entre 1 et 5 étoiles.'; errEl.style.display = 'block'; return }
    if (!reviewedId) return
    const { error } = await supabase.from('reviews').upsert({
      reviewer_id: _currentUserId,
      reviewed_id: reviewedId,
      rating: _selectedStar,
      comment: comment || null,
    }, { onConflict: 'reviewer_id,reviewed_id' })
    if (error) { errEl.textContent = 'Erreur : ' + error.message; errEl.style.display = 'block'; return }
    closeModal('modalAvis')
  }

  // ---- Email notifications (via Supabase Edge Function) ----
  async function notifyEventDeleted(eventId, titre, dateHeure) {
    try {
      const { data: { session } } = await supabase.auth.getSession()
      if (!session) return
      const supabaseUrl = supabase.supabaseUrl || window._supabaseUrl
      if (!supabaseUrl) return
      fetch(supabaseUrl + '/functions/v1/send-notification', {
        method: 'POST',
        headers: { 'Content-Type': 'application/json', 'Authorization': 'Bearer ' + session.access_token },
        body: JSON.stringify({ type: 'event_deleted', event_id: eventId, titre, date_heure: dateHeure }),
      }).catch(() => {}) // Best-effort, don't block UI
    } catch (_) {}
  }

  // ---- Handle hash on load ----
  window.addEventListener('hashchange', () => {
    const hash = location.hash.replace('#', '')
    if (hash === 'profil') showProfile()
    else if (hash === 'explorer') showExplorer()
    else showView('home')
  })
  if (location.hash === '#profil') showProfile()
  else if (location.hash === '#explorer') showExplorer()

  // ---- NAV scroll ----
  const nav = document.getElementById('mainNav');
  window.addEventListener('scroll', () => {
    nav.classList.toggle('scrolled', window.scrollY > 40);
  });

  // ---- Mobile menu ----
  const hamburger = document.getElementById('hamburger');
  const mobileMenu = document.getElementById('mobileMenu');
  const closeMenu = document.getElementById('closeMenu');

  hamburger.addEventListener('click', () => { mobileMenu.classList.add('open'); document.body.style.overflow = 'hidden'; });
  closeMenu.addEventListener('click', () => { mobileMenu.classList.remove('open'); document.body.style.overflow = ''; });

  // ---- Fade up on scroll ----
  const fadeObserver = new IntersectionObserver((entries) => {
    entries.forEach(entry => {
      if (entry.isIntersecting) {
        entry.target.classList.add('visible');
        fadeObserver.unobserve(entry.target);
      }
    });
  }, { threshold: 0.1, rootMargin: '0px 0px -40px 0px' });

  document.querySelectorAll('.fade-up').forEach(el => fadeObserver.observe(el));

  // ---- Smooth scroll ----
  document.querySelectorAll('a[href^="#"]').forEach(anchor => {
    anchor.addEventListener('click', function (e) {
      const href = this.getAttribute('href');
      if (href === '#') return;
      const target = document.querySelector(href);
      if (target) {
        e.preventDefault();
        target.scrollIntoView({ behavior: 'smooth', block: 'start' });
      }
    });
  });

  // ===================== TOAST =====================
  let _toastTimer
  function showToast(msg) {
    const t = document.getElementById('toast')
    t.textContent = msg
    t.classList.add('show')
    clearTimeout(_toastTimer)
    _toastTimer = setTimeout(() => t.classList.remove('show'), 3500)
  }

  function tryCreateEvent() {
    if (!_currentUserId) {
      showToast('👤 Crée un compte pour publier un événement')
      return
    }
    openModal('modalEvent')
  }

  // ===================== MODALS =====================
  function openModal(id, preselect) {
    const overlay = document.getElementById(id);
    overlay.classList.add('open');
    document.body.style.overflow = 'hidden';
    if (id === 'modalInscription' && preselect) {
      document.querySelectorAll('.profile-card').forEach(c => c.classList.remove('selected'));
      const card = document.querySelector(`.profile-card[data-profile="${preselect}"]`);
      if (card) card.classList.add('selected');
      updateAssoPro();
    }
    // Set today as default date
    if (id === 'modalEvent') {
      const today = new Date().toISOString().split('T')[0];
      const dateInput = document.getElementById('evDate');
      if (dateInput && !dateInput.value) dateInput.value = today;
    }
  }

  function closeModal(id) {
    document.getElementById(id).classList.remove('open');
    document.body.style.overflow = '';
  }

  // Close on overlay click
  document.getElementById('modalInscription').addEventListener('click', function(e) {
    if (e.target === this) closeModal('modalInscription');
  });
  document.getElementById('modalEvent').addEventListener('click', function(e) {
    if (e.target === this) closeModal('modalEvent');
  });
  document.getElementById('modalCreateur').addEventListener('click', function(e) {
    if (e.target === this) closeModal('modalCreateur');
  });

  document.getElementById('closeInscription').addEventListener('click', () => closeModal('modalInscription'));
  document.getElementById('closeEvent').addEventListener('click', () => closeModal('modalEvent'));

  // Close on Escape
  document.addEventListener('keydown', e => {
    if (e.key === 'Escape') {
      closeModal('modalInscription');
      closeModal('modalEvent');
      closeModal('modalCreateur');
    }
  });

  // ---- INSCRIPTION steps ----
  let inscStep = 1;
  function inscNext(step, skipValidation = false) {
    // Simple validation pane 2 (seulement si déclenché directement par le bouton)
    if (step === 3 && !skipValidation) {
      const email = document.getElementById('inscEmail');
      const pwd   = document.getElementById('inscPassword');
      if (!email || !email.value.includes('@')) { if (email) { email.focus(); email.style.borderColor = '#FF6B35'; } return; }
      email.style.borderColor = '';
      if (!pwd || pwd.value.length < 6) { if (pwd) { pwd.focus(); pwd.style.borderColor = '#FF6B35'; } return; }
      pwd.style.borderColor = '';
    }
    inscStep = step;
    document.querySelectorAll('#modalInscription .modal-pane').forEach(p => p.classList.remove('active'));
    document.getElementById('iPane' + step).classList.add('active');
    // Update step dots
    [1,2,3].forEach(i => {
      const dot = document.getElementById('isd' + i);
      dot.classList.remove('active','done');
      if (i < step) dot.classList.add('done');
      else if (i === step) dot.classList.add('active');
    });
    [1,2].forEach(i => {
      const line = document.getElementById('isl' + i);
      line.classList.toggle('done', i < step);
    });
  }

  function selectProfile(el) {
    document.querySelectorAll('.profile-card').forEach(c => c.classList.remove('selected'));
    el.classList.add('selected');
    updateAssoPro();
  }

  function updateAssoPro() {
    const selected = document.querySelector('.profile-card.selected');
    const profile = selected ? selected.getAttribute('data-profile') : 'particulier';
    const fieldAssoPro = document.getElementById('fieldAssoPro');
    const fieldSiret = document.getElementById('fieldSiret');
    fieldAssoPro.style.display = (profile === 'association' || profile === 'pro') ? 'block' : 'none';
    fieldSiret.style.display = (profile === 'pro') ? 'block' : 'none';
  }

  // ---- EVENT steps ----
  let evStep = 1;
  let selectedSport = { name: 'Marche', icon: '🚶' };

  function evNext(step) {
    if (step === 3) buildPreview();
    evStep = step;
    document.querySelectorAll('#modalEvent .modal-pane').forEach(p => p.classList.remove('active'));
    document.getElementById('evPane' + step).classList.add('active');
    [1,2,3].forEach(i => {
      const dot = document.getElementById('evd' + i);
      dot.classList.remove('active','done');
      if (i < step) dot.classList.add('done');
      else if (i === step) dot.classList.add('active');
    });
    [1,2].forEach(i => {
      const line = document.getElementById('evl' + i);
      line.classList.toggle('done', i < step);
    });
  }

  function selectActivity(el) {
    document.querySelectorAll('.activity-tile').forEach(t => t.classList.remove('selected'));
    el.classList.add('selected');
    selectedSport = { name: el.getAttribute('data-sport'), icon: el.getAttribute('data-icon') };
    // Masquer le champ "Autre" si on sélectionne une autre activité
    const wrap = document.getElementById('autreActivityWrap')
    if (wrap) wrap.style.display = 'none'
  }

  function selectActivityAutre(el) {
    document.querySelectorAll('.activity-tile').forEach(t => t.classList.remove('selected'));
    el.classList.add('selected');
    const wrap = document.getElementById('autreActivityWrap')
    if (wrap) wrap.style.display = 'block'
    const input = document.getElementById('autreActivityInput')
    if (input) { input.focus(); updateAutreActivity(input.value) }
  }

  function updateAutreActivity(val) {
    const name = val.trim().slice(0, 40)
    selectedSport = { name: name || 'Autre', icon: '✏️' }
  }

  function selectLevel(el, level) {
    document.querySelectorAll('.level-btn').forEach(b => b.classList.remove('selected'));
    el.classList.add('selected');
    selectedLevel = level;
  }

  function buildPreview() {
    const title = document.getElementById('evTitle').value || selectedSport.name + ' — mon event';
    const date = document.getElementById('evDate').value;
    const time = document.getElementById('evTime').value;
    const location = document.getElementById('evLocation').value || 'Lieu à définir';
    const participants = document.getElementById('evParticipants').value;
    const desc = document.getElementById('evDesc').value;
    const carpool = document.getElementById('evCarpool').checked;

    document.getElementById('prevIcon').textContent = selectedSport.icon;
    document.getElementById('prevTitle').textContent = title;
    document.getElementById('prevLevel').textContent = selectedSport.icon + ' ' + selectedSport.name;

    if (date) {
      const d = new Date(date);
      document.getElementById('prevDate').textContent = d.toLocaleDateString('fr-FR', {weekday:'short', day:'numeric', month:'long'});
    }
    document.getElementById('prevTime').textContent = time || '—';
    document.getElementById('prevLocation').textContent = location;
    document.getElementById('prevParticipants').textContent = participants === 'illimité' ? 'Illimité' : participants + ' participants max';

    const descEl = document.getElementById('prevDesc');
    if (desc) { descEl.textContent = desc; descEl.style.display = 'block'; } else { descEl.style.display = 'none'; }

    const carpoolEl = document.getElementById('prevCarpool');
    carpoolEl.style.display = carpool ? 'block' : 'none';
  }

  function publishEvent() {
    // Remplace le pane 3 par un écran succès
    document.getElementById('evPane3').innerHTML = `
      <div class="success-screen">
        <div class="success-icon">${selectedSport.icon}</div>
        <h3>Event publié !</h3>
        <p>Ton événement <strong style="color:var(--white);">${selectedSport.name}</strong> est maintenant en ligne. Les membres peuvent le rejoindre.</p>
        <div style="background:var(--dark3);border:1px solid rgba(52,145,136,0.15);border-radius:12px;padding:14px 18px;font-size:13px;color:var(--grey2);margin-bottom:24px;text-align:left;">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;color:var(--orange);font-weight:600;">
            <i class="fa-solid fa-trophy"></i> +3 points à la clé
          </div>
          Valide l'event après avec une photo de groupe pour recevoir tes points de création.
        </div>
        <button class="btn btn-primary btn-large" onclick="closeModal('modalEvent')">
          <i class="fa-solid fa-check"></i> Parfait !
        </button>
      </div>`;
  }
</script>

<!-- ===================== SUPABASE AUTH + FORMS ===================== -->
<script>
  // ---- Ouvrir le modal auth sur le bon onglet ----
  function openAuthModal(tab = 'connexion') {
    switchAuthTab(tab)
    openModal('modalInscription')
  }

  function switchAuthTab(tab) {
    const isConnexion = tab === 'connexion'
    document.getElementById('authConnexion').style.display = isConnexion ? 'block' : 'none'
    document.getElementById('authInscription').style.display = isConnexion ? 'none' : 'block'
    document.getElementById('tabConnexion').classList.toggle('active', isConnexion)
    document.getElementById('tabInscription').classList.toggle('active', !isConnexion)
    const titleEl = document.querySelector('#modalInscription .modal-title')
    if (titleEl) titleEl.textContent = isConnexion ? 'Connexion' : 'Créer un compte'
  }

  // ---- Connexion email/mot de passe ----
  async function loginWithEmail() {
    const email = document.getElementById('loginEmail').value.trim()
    const password = document.getElementById('loginPassword').value
    const errEl = document.getElementById('loginError')
    errEl.style.display = 'none'
    if (!email || !password) {
      errEl.textContent = 'Remplis l\'email et le mot de passe.'
      errEl.style.display = 'block'
      return
    }
    const { error } = await supabase.auth.signInWithPassword({ email, password })
    if (error) {
      const isInvalidCreds = error.message.toLowerCase().includes('invalid') || error.message.toLowerCase().includes('credentials')
      errEl.innerHTML = isInvalidCreds
        ? 'Email ou mot de passe incorrect. <a href="#" onclick="event.preventDefault();switchAuthTab(\'inscription\')" style="color:var(--orange);text-decoration:underline;">Créer un compte →</a>'
        : error.message
      errEl.style.display = 'block'
      return
    }
    closeModal('modalInscription')
  }

  // ---- Connexion Google ----
  function loginWithGoogle() {
    supabase.auth.signInWithOAuth({
      provider: 'google',
      options: { redirectTo: window.location.href.split('#')[0] }
    })
  }

  // ---- Déconnexion ----
  function logoutUser() {
    supabase.auth.signOut()
  }

  // ---- Mettre à jour l'UI nav selon la session ----
  function updateNavUI(session) {
    const out = document.getElementById('navLoggedOut')
    const inn = document.getElementById('navLoggedIn')
    if (!out || !inn) return

    const heroOut = document.getElementById('heroCtaLoggedOut')
    const heroIn  = document.getElementById('heroCtaLoggedIn')
    const ctaOut  = document.getElementById('ctaLoggedOut')
    const ctaIn   = document.getElementById('ctaLoggedIn')

    const navMes = document.getElementById('navMesEvents')
    const mobMes = document.getElementById('mobileMesEvents')
    if (session && session.user) {
      out.style.display = 'none'
      inn.style.display = 'flex'
      if (heroOut) heroOut.style.display = 'none'
      if (heroIn)  heroIn.style.display  = 'flex'
      if (ctaOut)  ctaOut.style.display  = 'none'
      if (ctaIn)   ctaIn.style.display   = 'flex'
      if (navMes)  navMes.style.display  = 'list-item'
      if (mobMes)  mobMes.style.display  = 'block'

      const meta = session.user.user_metadata || {}
      const fullName = meta.full_name || meta.name || ''
      const prenom = meta.given_name || fullName.split(' ')[0] || session.user.email?.split('@')[0] || ''
      document.getElementById('navPrenom').textContent = prenom

      const avatarEl = document.getElementById('navAvatar')
      const initialEl = document.getElementById('navAvatarInitial')
      const avatarUrl = meta.avatar_url || meta.picture || ''
      if (avatarUrl) {
        avatarEl.src = avatarUrl
        avatarEl.style.display = 'block'
        if (initialEl) initialEl.style.display = 'none'
      } else {
        avatarEl.style.display = 'none'
        if (initialEl) {
          initialEl.style.display = 'flex'
          initialEl.textContent = (prenom[0] || '?').toUpperCase()
        }
      }
    } else {
      out.style.display = 'block'
      inn.style.display = 'none'
      if (heroOut) heroOut.style.display = 'flex'
      if (heroIn)  heroIn.style.display  = 'none'
      if (ctaOut)  ctaOut.style.display  = 'flex'
      if (ctaIn)   ctaIn.style.display   = 'none'
      if (navMes)  navMes.style.display  = 'none'
      if (mobMes)  mobMes.style.display  = 'none'
    }
  }

  // ---- Upsert profil (Google ou email) au premier login ----
  async function upsertProfile(user) {
    const meta = user.user_metadata || {}
    const fullName = meta.full_name || meta.name || ''
    const parts = fullName.split(' ')
    const payload = {
      id: user.id,
      prenom: meta.given_name || parts[0] || '',
      nom: meta.family_name || parts.slice(1).join(' ') || '',
    }
    if (meta.profile_type) payload.type = meta.profile_type
    if (meta.ville) payload.ville = meta.ville
    if (meta.date_naissance) payload.date_naissance = meta.date_naissance
    if (meta.nom_structure) payload.nom_structure = meta.nom_structure
    if (meta.siret) payload.siret = meta.siret
    if (meta.description) payload.description = meta.description
    const { error } = await supabase.from('profiles').upsert(payload, { onConflict: 'id' })
    if (error) console.warn('Profile upsert:', error.message)
  }

  // ---- Écouter les changements d'état auth ----
  supabase.auth.onAuthStateChange(async (event, session) => {
    _currentUserId = session?.user?.id || null
    updateNavUI(session)
    if (event === 'SIGNED_IN') {
      const user = session.user
      // Récupérer le profil en attente (créé via inscription email avant confirmation)
      const pendingKey = 'pendingProfile_' + user.id
      const pending = localStorage.getItem(pendingKey)
      if (pending) {
        try {
          await _upsertFullProfile(user.id, JSON.parse(pending))
          localStorage.removeItem(pendingKey)
        } catch(e) { console.warn('Pending profile restore error:', e) }
      } else {
        upsertProfile(user)
      }
      loadHomeEvents()
      loadExplorer()
    }
    if (event === 'SIGNED_OUT') { showView('home'); loadHomeEvents() }
  })

  // ---- Initialiser l'UI au chargement de la page ----
  supabase.auth.getSession().then(({ data: { session } }) => {
    _currentUserId = session?.user?.id || null
    updateNavUI(session)
    loadHomeEvents()
  })

  // ---- Afficher le pane de succès (bypass inscNext pour éviter les problèmes de scope) ----
  function showSuccessPane(msg) {
    const p3 = document.getElementById('iPane3')
    if (!p3) return
    const pTag = p3.querySelector('p')
    if (pTag && msg) pTag.textContent = msg
    document.querySelectorAll('#modalInscription .modal-pane').forEach(p => p.classList.remove('active'))
    p3.classList.add('active')
    ;[1,2,3].forEach(i => {
      const dot = document.getElementById('isd' + i)
      if (!dot) return
      dot.classList.remove('active', 'done')
      if (i < 3) dot.classList.add('done')
      else dot.classList.add('active')
    })
    ;[1,2].forEach(i => { const l = document.getElementById('isl' + i); if (l) l.classList.add('done') })
  }

  // ---- Soumettre le formulaire d'inscription → profiles ----
  async function submitInscription() {
    const btn = document.querySelector('#iPane2 button.btn-primary')
    if (btn) { btn.disabled = true; btn.textContent = 'Création…' }

    const restore = () => { if (btn) { btn.disabled = false; btn.innerHTML = 'Créer mon compte <i class="fa-solid fa-check"></i>' } }
    const showErr = (msg) => {
      restore()
      const el = document.getElementById('inscError')
      if (el) { el.textContent = msg; el.style.display = 'block' }
    }

    const errEl = document.getElementById('inscError')
    if (errEl) errEl.style.display = 'none'

    const email    = document.getElementById('inscEmail')?.value.trim() || ''
    const password = document.getElementById('inscPassword')?.value || ''
    const prenom   = document.getElementById('inscPrenom')?.value.trim() || ''
    const nom      = document.getElementById('inscNom')?.value.trim() || ''
    const dateNaiss = document.getElementById('inscDate')?.value || null
    const ville    = document.getElementById('inscVille')?.value.trim() || ''
    const rawType  = document.querySelector('.profile-card.selected')?.getAttribute('data-profile') || 'particulier'
    const safeType = ['particulier','association','pro'].includes(rawType) ? rawType : 'particulier'
    const structure = document.getElementById('inscStructure')?.value.trim() || ''
    const siret     = document.getElementById('inscSiret')?.value.trim() || ''
    const desc      = document.getElementById('inscDesc')?.value.trim() || ''

    if (!email || !email.includes('@')) { showErr('Entre une adresse email valide.'); return }
    if (password.length < 6) { showErr('Mot de passe : 6 caractères minimum.'); return }

    try {
      const { data: authData, error: authError } = await supabase.auth.signUp({
        email,
        password,
        options: {
          data: {
            given_name: prenom,
            family_name: nom,
            profile_type: safeType,
            ville: ville,
            date_naissance: dateNaiss,
            nom_structure: structure,
            siret: siret,
            description: desc
          },
          emailRedirectTo: window.location.origin + window.location.pathname
        }
      })

      if (authError) {
        const m = authError.message.toLowerCase()
        if (m.includes('already') || m.includes('registered') || m.includes('exists') || m.includes('taken')) {
          showErr('Cet email est déjà utilisé. Connecte-toi via l\'onglet Connexion.')
        } else {
          showErr(authError.message)
        }
        return
      }

      const user = authData?.user
      if (!user) { showErr('Erreur lors de la création du compte. Réessaie.'); return }

      // Sauvegarder les données du profil pour les récupérer après confirmation email
      const pendingProfile = { type: safeType, prenom, nom, ville, date_naissance: dateNaiss, nom_structure: structure, siret, description: desc }
      localStorage.setItem('pendingProfile_' + user.id, JSON.stringify(pendingProfile))

      if (authData.session) {
        // Confirmation email désactivée → upsert direct
        await _upsertFullProfile(user.id, pendingProfile)
        localStorage.removeItem('pendingProfile_' + user.id)
        restore()
        showSuccessPane(null)
      } else {
        // Confirmation email requise
        restore()
        showSuccessPane('Compte créé ! Un email de confirmation a été envoyé à ' + email + '. Clique sur le lien pour activer ton compte puis connecte-toi.')
      }

    } catch (e) {
      showErr('Erreur : ' + e.message)
    }
  }

  async function _upsertFullProfile(userId, data) {
    const payload = {
      id: userId,
      type: data.type || 'particulier',
      prenom: (data.prenom || '').slice(0, 80),
      nom: (data.nom || '').slice(0, 80),
      ville: (data.ville || '').slice(0, 100),
      date_naissance: data.date_naissance || null,
    }
    if (data.nom_structure) payload.nom_structure = data.nom_structure.slice(0, 200)
    if (data.siret) payload.siret = data.siret.slice(0, 20)
    if (data.description) payload.description = data.description.slice(0, 500)
    const { error } = await supabase.from('profiles').upsert(payload, { onConflict: 'id' })
    if (error) console.warn('Profile upsert error:', error.message)
  }

  // ---- Publier un événement → events (override la version statique) ----
  async function publishEvent() {
    const { data: { session } } = await supabase.auth.getSession()
    if (!session) {
      closeModal('modalEvent')
      openAuthModal('connexion')
      return
    }

    const title = sanitizeInput(document.getElementById('evTitle').value || selectedSport.name + ' — mon event', 150)
    const date = document.getElementById('evDate').value.slice(0, 10)   // YYYY-MM-DD only
    const time = document.getElementById('evTime').value.slice(0, 5)    // HH:MM only
    const location = sanitizeInput(document.getElementById('evLocation').value || '', 200)
    const participants = document.getElementById('evParticipants').value
    const recurrence = document.getElementById('evRecurrence').value
    const desc = sanitizeInput(document.getElementById('evDesc').value, 500)
    const carpool = document.getElementById('evCarpool').checked
    const ville = sanitizeInput(document.getElementById('evVille').value || '', 100)

    // Validate & convert local time → UTC (fix fuseau horaire)
    let dateHeure = null
    if (/^\d{4}-\d{2}-\d{2}$/.test(date) && /^\d{2}:\d{2}$/.test(time)) {
      dateHeure = new Date(date + 'T' + time + ':00').toISOString()
    }

    // Whitelist recurrence values
    const allowedRecurrences = ['aucune', 'hebdomadaire', 'mensuelle']
    const safeRecurrence = allowedRecurrences.includes(recurrence) ? recurrence : 'aucune'

    const allowedParticipants = ['5', '10', '15', '20', '30', '50', 'illimité']
    const maxPart = allowedParticipants.includes(participants) && participants !== 'illimité'
      ? parseInt(participants, 10)
      : null

    const { error } = await supabase.from('events').insert({
      creator_id: session.user.id,
      titre: title,
      activite: selectedSport.name,
      niveau: null,
      date_heure: dateHeure,
      lieu: location,
      ville: ville || null,
      max_participants: maxPart,
      recurrence: safeRecurrence,
      description: desc,
      covoiturage: Boolean(carpool),
    })

    if (error) {
      alert('Erreur lors de la création : ' + error.message)
      return
    }

    document.getElementById('evPane3').innerHTML = `
      <div class="success-screen">
        <div class="success-icon">${selectedSport.icon}</div>
        <h3>Event publié !</h3>
        <p>Ton événement <strong style="color:var(--white);">${selectedSport.name}</strong> est maintenant en ligne. Les membres peuvent le rejoindre.</p>
        <div style="background:var(--dark3);border:1px solid rgba(52,145,136,0.15);border-radius:12px;padding:14px 18px;font-size:13px;color:var(--grey2);margin-bottom:24px;text-align:left;">
          <div style="display:flex;align-items:center;gap:8px;margin-bottom:6px;color:var(--orange);font-weight:600;">
            <i class="fa-solid fa-trophy"></i> +3 points à la clé
          </div>
          Valide l'event après avec une photo de groupe pour recevoir tes points de création.
        </div>
        <button class="btn btn-primary btn-large" onclick="closeModal('modalEvent')">
          <i class="fa-solid fa-check"></i> Parfait !
        </button>
      </div>`
  }
</script>

<!-- MODAL AVATAR PICKER -->
<div class="avatar-modal-overlay" id="avatarModalOverlay" onclick="if(event.target===this)closeAvatarPicker()">
  <div class="avatar-modal-box">
    <div class="avatar-modal-title">Choisis ton avatar</div>
    <div class="avatar-picker-grid" id="avatarPickerGrid"></div>
    <div style="text-align:right;margin-top:16px;">
      <button class="btn btn-outline" onclick="closeAvatarPicker()">Fermer</button>
    </div>
  </div>
</div>

<!-- MODAL CONFIRM DELETE -->
<div class="confirm-overlay" id="confirmOverlay">
  <div class="confirm-box">
    <div class="confirm-icon">🗑️</div>
    <div class="confirm-title">Supprimer l'événement ?</div>
    <p class="confirm-text">Cette action est irréversible. L'événement et tous ses participants seront supprimés.</p>
    <div class="confirm-btns">
      <button class="btn btn-outline" onclick="confirmCancel()">Annuler</button>
      <button class="btn btn-primary" id="confirmOkBtn" style="background:var(--orange);border-color:var(--orange);">
        <i class="fa-solid fa-trash"></i> Supprimer
      </button>
    </div>
  </div>
</div>

<!-- ===================== MODAL CGU ===================== -->
<div class="modal-overlay" id="modalCGU">
  <div class="modal-box" style="max-width:640px;max-height:85vh;overflow-y:auto;">
    <div class="modal-header" style="position:sticky;top:0;background:var(--dark2);z-index:1;">
      <div class="modal-title">Conditions Générales d'Utilisation</div>
      <button class="modal-close" onclick="closeModal('modalCGU')"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <div class="modal-body" style="padding:24px;font-size:13px;color:var(--grey2);line-height:1.8;">
      <p style="color:var(--grey);font-size:12px;margin-bottom:20px;">Dernière mise à jour : janvier 2026</p>

      <h3 style="color:var(--white);font-size:15px;margin:0 0 8px;">1. Objet</h3>
      <p>Les présentes Conditions Générales d'Utilisation (CGU) régissent l'accès et l'utilisation de la plateforme <strong>+1Life</strong>, service de mise en relation pour la pratique d'activités sportives entre particuliers.</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">2. Inscription et compte</h3>
      <p>L'accès aux fonctionnalités de +1Life nécessite la création d'un compte. L'utilisateur s'engage à fournir des informations exactes et à maintenir la confidentialité de ses identifiants. Tout utilisateur doit être âgé d'au moins 16 ans.</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">3. Création et participation aux événements</h3>
      <p>Les utilisateurs peuvent créer des événements sportifs et inviter d'autres membres à y participer. Le créateur est responsable de l'organisation, du lieu et du bon déroulement de l'événement. +1Life n'est pas organisateur des événements publiés sur la plateforme et ne saurait être tenu responsable des incidents survenant lors de leur déroulement.</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">4. Système de points et rangs</h3>
      <p>Un système de points est attribué aux utilisateurs selon leur activité (création d'événements, participation). Ce système est fourni à titre indicatif et peut être modifié sans préavis. Les points n'ont aucune valeur monétaire.</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">5. Système d'avis</h3>
      <p>Les utilisateurs peuvent laisser un avis sur un créateur d'événement uniquement s'ils ont participé à l'un de ses événements. Les avis doivent être sincères, respectueux et ne pas contenir de contenu diffamatoire, haineux ou contraire à la loi. +1Life se réserve le droit de supprimer tout avis non conforme.</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">6. Comportement des utilisateurs</h3>
      <p>Il est interdit d'utiliser la plateforme pour des activités illégales, de publier des contenus offensants, de harceler d'autres membres ou de créer de faux événements. Tout manquement peut entraîner la suspension ou la suppression définitive du compte.</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">7. Responsabilité</h3>
      <p>+1Life fournit la plateforme « en l'état » sans garantie de disponibilité permanente. L'utilisateur reconnaît que la pratique sportive comporte des risques inhérents et qu'il lui appartient de souscrire les assurances adaptées.</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">8. Propriété intellectuelle</h3>
      <p>Les contenus publiés par les utilisateurs restent leur propriété. En les publiant sur +1Life, ils accordent à la plateforme une licence non exclusive d'affichage et de diffusion dans le cadre du service.</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">9. Modification des CGU</h3>
      <p>+1Life se réserve le droit de modifier les présentes CGU. Les utilisateurs seront informés de tout changement significatif. La poursuite de l'utilisation après modification vaut acceptation des nouvelles conditions.</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">10. Droit applicable</h3>
      <p>Les présentes CGU sont soumises au droit français. Tout litige sera soumis à la juridiction compétente du ressort du siège social de +1Life.</p>
    </div>
  </div>
</div>

<!-- ===================== MODAL MENTIONS LÉGALES ===================== -->
<div class="modal-overlay" id="modalMentions">
  <div class="modal-box" style="max-width:560px;max-height:85vh;overflow-y:auto;">
    <div class="modal-header" style="position:sticky;top:0;background:var(--dark2);z-index:1;">
      <div class="modal-title">Mentions légales</div>
      <button class="modal-close" onclick="closeModal('modalMentions')"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <div class="modal-body" style="padding:24px;font-size:13px;color:var(--grey2);line-height:1.8;">
      <h3 style="color:var(--white);font-size:15px;margin:0 0 8px;">Éditeur</h3>
      <p>+1Life est un service édité par <strong>KLUB</strong>.<br>
      Adresse : 158 Bis, Route de Kerdurand, 56670 Riantec<br>
      Email de contact : rudy.leny@hotmail.fr</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">Hébergement</h3>
      <p>Le site est hébergé par <strong>Vercel Inc.</strong>, 340 Pine Street, Suite 701, San Francisco, CA 94104, États-Unis.<br>
      La base de données est hébergée par <strong>Supabase</strong>, conformément à la réglementation RGPD.</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">Directeur de publication</h3>
      <p>Brandon F</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">Propriété intellectuelle</h3>
      <p>L'ensemble des éléments constituant le site (logo, charte graphique, textes, code) est protégé par le droit d'auteur. Toute reproduction sans autorisation est interdite.</p>
    </div>
  </div>
</div>

<!-- ===================== MODAL CONFIDENTIALITÉ ===================== -->
<div class="modal-overlay" id="modalConfidentialite">
  <div class="modal-box" style="max-width:640px;max-height:85vh;overflow-y:auto;">
    <div class="modal-header" style="position:sticky;top:0;background:var(--dark2);z-index:1;">
      <div class="modal-title">Politique de confidentialité</div>
      <button class="modal-close" onclick="closeModal('modalConfidentialite')"><i class="fa-solid fa-xmark"></i></button>
    </div>
    <div class="modal-body" style="padding:24px;font-size:13px;color:var(--grey2);line-height:1.8;">
      <p style="color:var(--grey);font-size:12px;margin-bottom:20px;">Conforme au RGPD — Dernière mise à jour : janvier 2026</p>

      <h3 style="color:var(--white);font-size:15px;margin:0 0 8px;">1. Données collectées</h3>
      <p>+1Life collecte les données suivantes lors de votre inscription : prénom, nom, email, date de naissance, ville, et optionnellement votre numéro SIRET si vous êtes professionnel. Lors de la création d'événements : titre, activité, lieu, ville, date, description.</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">2. Finalité du traitement</h3>
      <p>Les données sont utilisées pour : la gestion de votre compte, l'affichage de votre profil public, la mise en relation avec d'autres sportifs, et l'envoi de notifications relatives aux événements auxquels vous participez.</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">3. Données partagées</h3>
      <p>Votre prénom, première lettre du nom, ville et activités sont visibles par les autres utilisateurs connectés. Votre email n'est jamais affiché publiquement. Aucune donnée n'est vendue à des tiers.</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">4. Durée de conservation</h3>
      <p>Vos données sont conservées pendant toute la durée d'activité de votre compte. En cas de suppression du compte, vos données sont effacées dans un délai de 30 jours.</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">5. Vos droits</h3>
      <p>Conformément au RGPD, vous disposez d'un droit d'accès, de rectification, d'effacement, de portabilité et d'opposition sur vos données. Pour exercer ces droits : <strong>rudy.leny@hotmail.fr</strong></p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">6. Cookies</h3>
      <p>+1Life utilise uniquement des cookies techniques nécessaires au fonctionnement de l'authentification (session Supabase). Aucun cookie publicitaire ou de tracking tiers n'est utilisé.</p>

      <h3 style="color:var(--white);font-size:15px;margin:20px 0 8px;">7. Contact DPO</h3>
      <p>Pour toute question relative à la protection de vos données : <strong>contact@plusonelife.fr</strong><br>
      Vous pouvez également adresser une réclamation à la <strong>CNIL</strong> : cnil.fr</p>
    </div>
  </div>
</div>

<div id="toast"></div>

</body>
</html>
